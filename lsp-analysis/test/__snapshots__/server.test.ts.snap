// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`run test 'api' with location '../../api' 1`] = `
{
  "errorCount": 0,
  "results": [
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "src/routes/app-routes.ts@1138",
          "method": "get",
          "path": "/v0/app-routes",
          "sources": [
            {
              "character": 26,
              "content": "async (ctx) => {
  const db = ctx.get("db");
  const routes = await db.select().from(appRoutes);
  const baseUrl = resolveServiceArg(
    env(ctx).FPX_SERVICE_TARGET as string,
    "http://localhost:8787",
  );
  return ctx.json({
    baseUrl,
    routes,
  });
}",
              "fileName": "src/routes/app-routes.ts",
              "id": "src/routes/app-routes.ts@1164",
              "line": 41,
              "modules": {
                "hono": [
                  {
                    "import": "env",
                    "importPath": "hono/adapter",
                    "name": "hono",
                    "version": "4.6.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 0,
                  "content": "export function resolveServiceArg(
  serviceArg: string | number | undefined,
  fallback = "http://localhost:8787",
) {
  if (!serviceArg) {
    return fallback;
  }
  if (typeof serviceArg === "string" && serviceArg.startsWith("http")) {
    return serviceArg;
  }
  if (typeof serviceArg === "number") {
    return \`http://localhost:\${serviceArg}\`;
  }
  const targetPort = Number.parseInt(serviceArg, 10);
  if (!targetPort) {
    logger.error(
      \`Invalid service argument \${serviceArg}. Using default \${fallback}.\`,
    );
    return fallback;
  }
  return \`http://localhost:\${targetPort}\`;
}",
                  "fileName": "src/probe-routes.ts",
                  "id": "src/probe-routes.ts@3988",
                  "line": 127,
                  "modules": {},
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/app-routes.ts@1494",
          "method": "post",
          "path": "/v0/refresh-app-routes",
          "sources": [
            {
              "character": 35,
              "content": "async (ctx) => {
  const serviceTargetArgument = process.env.FPX_SERVICE_TARGET;
  const serviceUrl = resolveServiceArg(serviceTargetArgument);
  await routerProbe(serviceUrl);
  return ctx.text("OK");
}",
              "fileName": "src/routes/app-routes.ts",
              "id": "src/routes/app-routes.ts@1529",
              "line": 57,
              "modules": {},
              "references": [
                {
                  "character": 0,
                  "content": "export function resolveServiceArg(
  serviceArg: string | number | undefined,
  fallback = "http://localhost:8787",
) {
  if (!serviceArg) {
    return fallback;
  }
  if (typeof serviceArg === "string" && serviceArg.startsWith("http")) {
    return serviceArg;
  }
  if (typeof serviceArg === "number") {
    return \`http://localhost:\${serviceArg}\`;
  }
  const targetPort = Number.parseInt(serviceArg, 10);
  if (!targetPort) {
    logger.error(
      \`Invalid service argument \${serviceArg}. Using default \${fallback}.\`,
    );
    return fallback;
  }
  return \`http://localhost:\${targetPort}\`;
}",
                  "fileName": "src/probe-routes.ts",
                  "id": "src/probe-routes.ts@3988",
                  "line": 127,
                  "modules": {},
                  "references": [],
                },
                {
                  "character": 0,
                  "content": "export async function routerProbe(target: string) {
  const headers = new Headers();
  headers.append("X-Fpx-Route-Inspector", "enabled");
  return await fetch(target, {
    method: "GET",
    headers,
  });
}",
                  "fileName": "src/probe-routes.ts",
                  "id": "src/probe-routes.ts@3211",
                  "line": 107,
                  "modules": {},
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/app-routes.ts@1736",
          "method": "post",
          "path": "/v0/app-routes",
          "sources": [
            {
              "character": 2,
              "content": "zValidator(
    "json",
    z.union([appRoutesInsertSchema, z.array(appRoutesInsertSchema)]),
  )",
              "fileName": "src/routes/app-routes.ts",
              "id": "src/routes/app-routes.ts@1768",
              "line": 66,
              "modules": {
                "@hono/zod-validator": [
                  {
                    "import": "zValidator",
                    "importPath": "@hono/zod-validator",
                    "name": "@hono/zod-validator",
                    "version": "0.2.2",
                  },
                ],
                "zod": [
                  {
                    "import": "z",
                    "importPath": "zod",
                    "name": "zod",
                    "version": "3.23.8",
                  },
                ],
              },
              "references": [
                {
                  "character": 37,
                  "content": "const appRoutesInsertSchema = createInsertSchema(appRoutes)",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@1544",
                  "line": 35,
                  "modules": {
                    "drizzle-zod": [
                      {
                        "import": "createInsertSchema",
                        "importPath": "drizzle-zod",
                        "name": "drizzle-zod",
                        "version": "0.5.1",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 13,
                      "content": "const appRoutes = sqliteTable("app_routes", {
  id: integer("id", { mode: "number" }).primaryKey(),
  path: text("path", { mode: "text" }),
  method: text("method", { mode: "text" }),
  // The text of the function serving the request
  handler: text("handler", { mode: "text" }),
  // In practice, handler_type is either "route" or "middleware" - I didn't feel like defining an enum
  handlerType: text("handler_type", { mode: "text" }),
  // A flag that indicates if this route is currently registered or the result of an old probe
  currentlyRegistered: integer("currentlyRegistered", {
    mode: "boolean",
  }).default(false),
  registrationOrder: integer("registration_order", {
    mode: "number",
  }).default(-1),
  // A flag for route type that indicated if the route was added manually by user or by probe
  routeOrigin: text("route_origin", {
    mode: "text",
    enum: ["discovered", "custom", "open_api"],
  }).default("discovered"),
  // serialized OpenAPI spec for AI prompting
  openApiSpec: text("openapi_spec", { mode: "text" }),
  requestType: text("request_type", {
    mode: "text",
    enum: ["http", "websocket"],
  }).default("http"),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@280",
                      "line": 6,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "sqliteTable",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
                {
                  "character": 37,
                  "content": "const appRoutesInsertSchema = createInsertSchema(appRoutes)",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@1544",
                  "line": 35,
                  "modules": {
                    "drizzle-zod": [
                      {
                        "import": "createInsertSchema",
                        "importPath": "drizzle-zod",
                        "name": "drizzle-zod",
                        "version": "0.5.1",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 13,
                      "content": "const appRoutes = sqliteTable("app_routes", {
  id: integer("id", { mode: "number" }).primaryKey(),
  path: text("path", { mode: "text" }),
  method: text("method", { mode: "text" }),
  // The text of the function serving the request
  handler: text("handler", { mode: "text" }),
  // In practice, handler_type is either "route" or "middleware" - I didn't feel like defining an enum
  handlerType: text("handler_type", { mode: "text" }),
  // A flag that indicates if this route is currently registered or the result of an old probe
  currentlyRegistered: integer("currentlyRegistered", {
    mode: "boolean",
  }).default(false),
  registrationOrder: integer("registration_order", {
    mode: "number",
  }).default(-1),
  // A flag for route type that indicated if the route was added manually by user or by probe
  routeOrigin: text("route_origin", {
    mode: "text",
    enum: ["discovered", "custom", "open_api"],
  }).default("discovered"),
  // serialized OpenAPI spec for AI prompting
  openApiSpec: text("openapi_spec", { mode: "text" }),
  requestType: text("request_type", {
    mode: "text",
    enum: ["http", "websocket"],
  }).default("http"),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@280",
                      "line": 6,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "sqliteTable",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
              ],
            },
            {
              "character": 2,
              "content": "async (ctx) => {
    const db = ctx.get("db");
    const submitted = ctx.req.valid("json");
    // NOTE: drizzle should handle this for us, but it doesn't seem to be working...
    if (Array.isArray(submitted)) {
      const createdRoutes = await db
        .insert(appRoutes)
        .values(submitted)
        .returning();
      return ctx.json(createdRoutes);
    }

    const createdRoute = await db
      .insert(appRoutes)
      .values(submitted)
      .returning();
    return ctx.json(createdRoute?.[0]);
  }",
              "fileName": "src/routes/app-routes.ts",
              "id": "src/routes/app-routes.ts@1869",
              "line": 70,
              "modules": {},
              "references": [
                {
                  "character": 25,
                  "content": "const appRoutes = sqliteTable("app_routes", {
  id: integer("id", { mode: "number" }).primaryKey(),
  path: text("path", { mode: "text" }),
  method: text("method", { mode: "text" }),
  // The text of the function serving the request
  handler: text("handler", { mode: "text" }),
  // In practice, handler_type is either "route" or "middleware" - I didn't feel like defining an enum
  handlerType: text("handler_type", { mode: "text" }),
  // A flag that indicates if this route is currently registered or the result of an old probe
  currentlyRegistered: integer("currentlyRegistered", {
    mode: "boolean",
  }).default(false),
  registrationOrder: integer("registration_order", {
    mode: "number",
  }).default(-1),
  // A flag for route type that indicated if the route was added manually by user or by probe
  routeOrigin: text("route_origin", {
    mode: "text",
    enum: ["discovered", "custom", "open_api"],
  }).default("discovered"),
  // serialized OpenAPI spec for AI prompting
  openApiSpec: text("openapi_spec", { mode: "text" }),
  requestType: text("request_type", {
    mode: "text",
    enum: ["http", "websocket"],
  }).default("http"),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@292",
                  "line": 6,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "sqliteTable",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 25,
                  "content": "const appRoutes = sqliteTable("app_routes", {
  id: integer("id", { mode: "number" }).primaryKey(),
  path: text("path", { mode: "text" }),
  method: text("method", { mode: "text" }),
  // The text of the function serving the request
  handler: text("handler", { mode: "text" }),
  // In practice, handler_type is either "route" or "middleware" - I didn't feel like defining an enum
  handlerType: text("handler_type", { mode: "text" }),
  // A flag that indicates if this route is currently registered or the result of an old probe
  currentlyRegistered: integer("currentlyRegistered", {
    mode: "boolean",
  }).default(false),
  registrationOrder: integer("registration_order", {
    mode: "number",
  }).default(-1),
  // A flag for route type that indicated if the route was added manually by user or by probe
  routeOrigin: text("route_origin", {
    mode: "text",
    enum: ["discovered", "custom", "open_api"],
  }).default("discovered"),
  // serialized OpenAPI spec for AI prompting
  openApiSpec: text("openapi_spec", { mode: "text" }),
  requestType: text("request_type", {
    mode: "text",
    enum: ["http", "websocket"],
  }).default("http"),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@292",
                  "line": 6,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "sqliteTable",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/app-routes.ts@2393",
          "method": "post",
          "path": "/v0/probed-routes",
          "sources": [
            {
              "character": 2,
              "content": "zValidator("json", schemaProbedRoutes)",
              "fileName": "src/routes/app-routes.ts",
              "id": "src/routes/app-routes.ts@2428",
              "line": 92,
              "modules": {
                "@hono/zod-validator": [
                  {
                    "import": "zValidator",
                    "importPath": "@hono/zod-validator",
                    "name": "@hono/zod-validator",
                    "version": "0.2.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 34,
                  "content": "const schemaProbedRoutes = z.object({
  routes: z.array(
    z.object({
      method: z.string(),
      path: z.string(),
      handler: z.string(),
      handlerType: z.string(),
    }),
  ),
})",
                  "fileName": "src/lib/app-routes.ts",
                  "id": "src/lib/app-routes.ts@231",
                  "line": 7,
                  "modules": {
                    "zod": [
                      {
                        "import": "z",
                        "importPath": "zod",
                        "name": "zod",
                        "version": "3.23.8",
                      },
                    ],
                  },
                  "references": [],
                },
              ],
            },
            {
              "character": 2,
              "content": "async (ctx) => {
    const db = ctx.get("db");
    const { routes } = ctx.req.valid("json");

    try {
      if (routes.length > 0) {
        // "Re-register" all current app routes in a database transaction
        await reregisterRoutes(db, { routes });

        // TODO - Detect if anything actually changed before invalidating the query on the frontend
        //        This would be more of an optimization, but is friendlier to the frontend
        const wsConnections = ctx.get("wsConnections");

        if (wsConnections) {
          for (const ws of wsConnections) {
            ws.send(
              JSON.stringify({
                event: "trace_created",
                payload: ["appRoutes"],
              }),
            );
          }
        }
      }

      return ctx.text("OK");
    } catch (err) {
      if (err instanceof Error) {
        logger.error("Error processing probed routes", err);
      }
      return ctx.json({ error: "Error processing probed routes" }, 500);
    }
  }",
              "fileName": "src/routes/app-routes.ts",
              "id": "src/routes/app-routes.ts@2470",
              "line": 93,
              "modules": {},
              "references": [],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/app-routes.ts@3485",
          "method": "delete",
          "path": "/v0/app-routes/:method/:path",
          "sources": [
            {
              "character": 43,
              "content": "async (ctx) => {
  const db = ctx.get("db");
  const { method, path } = ctx.req.param();
  const decodedPath = decodeURIComponent(path);
  const createdRoute = await db
    .delete(appRoutes)
    .where(
      and(
        eq(appRoutes.method, method),
        eq(appRoutes.path, decodedPath),
        eq(appRoutes.handlerType, "route"),
        // Only allow deleting routes that were NOT auto-detected
        eq(appRoutes.currentlyRegistered, false),
      ),
    )
    .returning();
  return ctx.json(createdRoute?.[0]);
}",
              "fileName": "src/routes/app-routes.ts",
              "id": "src/routes/app-routes.ts@3528",
              "line": 128,
              "modules": {
                "drizzle-orm": [
                  {
                    "import": "and",
                    "importPath": "drizzle-orm",
                    "name": "drizzle-orm",
                    "version": "0.33.0",
                  },
                  {
                    "import": "eq",
                    "importPath": "drizzle-orm",
                    "name": "drizzle-orm",
                    "version": "0.33.0",
                  },
                ],
              },
              "references": [
                {
                  "character": 25,
                  "content": "const appRoutes = sqliteTable("app_routes", {
  id: integer("id", { mode: "number" }).primaryKey(),
  path: text("path", { mode: "text" }),
  method: text("method", { mode: "text" }),
  // The text of the function serving the request
  handler: text("handler", { mode: "text" }),
  // In practice, handler_type is either "route" or "middleware" - I didn't feel like defining an enum
  handlerType: text("handler_type", { mode: "text" }),
  // A flag that indicates if this route is currently registered or the result of an old probe
  currentlyRegistered: integer("currentlyRegistered", {
    mode: "boolean",
  }).default(false),
  registrationOrder: integer("registration_order", {
    mode: "number",
  }).default(-1),
  // A flag for route type that indicated if the route was added manually by user or by probe
  routeOrigin: text("route_origin", {
    mode: "text",
    enum: ["discovered", "custom", "open_api"],
  }).default("discovered"),
  // serialized OpenAPI spec for AI prompting
  openApiSpec: text("openapi_spec", { mode: "text" }),
  requestType: text("request_type", {
    mode: "text",
    enum: ["http", "websocket"],
  }).default("http"),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@292",
                  "line": 6,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "sqliteTable",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 25,
                  "content": "const appRoutes = sqliteTable("app_routes", {
  id: integer("id", { mode: "number" }).primaryKey(),
  path: text("path", { mode: "text" }),
  method: text("method", { mode: "text" }),
  // The text of the function serving the request
  handler: text("handler", { mode: "text" }),
  // In practice, handler_type is either "route" or "middleware" - I didn't feel like defining an enum
  handlerType: text("handler_type", { mode: "text" }),
  // A flag that indicates if this route is currently registered or the result of an old probe
  currentlyRegistered: integer("currentlyRegistered", {
    mode: "boolean",
  }).default(false),
  registrationOrder: integer("registration_order", {
    mode: "number",
  }).default(-1),
  // A flag for route type that indicated if the route was added manually by user or by probe
  routeOrigin: text("route_origin", {
    mode: "text",
    enum: ["discovered", "custom", "open_api"],
  }).default("discovered"),
  // serialized OpenAPI spec for AI prompting
  openApiSpec: text("openapi_spec", { mode: "text" }),
  requestType: text("request_type", {
    mode: "text",
    enum: ["http", "websocket"],
  }).default("http"),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@292",
                  "line": 6,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "sqliteTable",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 25,
                  "content": "const appRoutes = sqliteTable("app_routes", {
  id: integer("id", { mode: "number" }).primaryKey(),
  path: text("path", { mode: "text" }),
  method: text("method", { mode: "text" }),
  // The text of the function serving the request
  handler: text("handler", { mode: "text" }),
  // In practice, handler_type is either "route" or "middleware" - I didn't feel like defining an enum
  handlerType: text("handler_type", { mode: "text" }),
  // A flag that indicates if this route is currently registered or the result of an old probe
  currentlyRegistered: integer("currentlyRegistered", {
    mode: "boolean",
  }).default(false),
  registrationOrder: integer("registration_order", {
    mode: "number",
  }).default(-1),
  // A flag for route type that indicated if the route was added manually by user or by probe
  routeOrigin: text("route_origin", {
    mode: "text",
    enum: ["discovered", "custom", "open_api"],
  }).default("discovered"),
  // serialized OpenAPI spec for AI prompting
  openApiSpec: text("openapi_spec", { mode: "text" }),
  requestType: text("request_type", {
    mode: "text",
    enum: ["http", "websocket"],
  }).default("http"),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@292",
                  "line": 6,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "sqliteTable",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 25,
                  "content": "const appRoutes = sqliteTable("app_routes", {
  id: integer("id", { mode: "number" }).primaryKey(),
  path: text("path", { mode: "text" }),
  method: text("method", { mode: "text" }),
  // The text of the function serving the request
  handler: text("handler", { mode: "text" }),
  // In practice, handler_type is either "route" or "middleware" - I didn't feel like defining an enum
  handlerType: text("handler_type", { mode: "text" }),
  // A flag that indicates if this route is currently registered or the result of an old probe
  currentlyRegistered: integer("currentlyRegistered", {
    mode: "boolean",
  }).default(false),
  registrationOrder: integer("registration_order", {
    mode: "number",
  }).default(-1),
  // A flag for route type that indicated if the route was added manually by user or by probe
  routeOrigin: text("route_origin", {
    mode: "text",
    enum: ["discovered", "custom", "open_api"],
  }).default("discovered"),
  // serialized OpenAPI spec for AI prompting
  openApiSpec: text("openapi_spec", { mode: "text" }),
  requestType: text("request_type", {
    mode: "text",
    enum: ["http", "websocket"],
  }).default("http"),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@292",
                  "line": 6,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "sqliteTable",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 25,
                  "content": "const appRoutes = sqliteTable("app_routes", {
  id: integer("id", { mode: "number" }).primaryKey(),
  path: text("path", { mode: "text" }),
  method: text("method", { mode: "text" }),
  // The text of the function serving the request
  handler: text("handler", { mode: "text" }),
  // In practice, handler_type is either "route" or "middleware" - I didn't feel like defining an enum
  handlerType: text("handler_type", { mode: "text" }),
  // A flag that indicates if this route is currently registered or the result of an old probe
  currentlyRegistered: integer("currentlyRegistered", {
    mode: "boolean",
  }).default(false),
  registrationOrder: integer("registration_order", {
    mode: "number",
  }).default(-1),
  // A flag for route type that indicated if the route was added manually by user or by probe
  routeOrigin: text("route_origin", {
    mode: "text",
    enum: ["discovered", "custom", "open_api"],
  }).default("discovered"),
  // serialized OpenAPI spec for AI prompting
  openApiSpec: text("openapi_spec", { mode: "text" }),
  requestType: text("request_type", {
    mode: "text",
    enum: ["http", "websocket"],
  }).default("http"),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@292",
                  "line": 6,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "sqliteTable",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/app-routes.ts@4058",
          "method": "delete",
          "path": "/v0/app-requests/",
          "sources": [
            {
              "character": 32,
              "content": "async (ctx) => {
  const db = ctx.get("db");
  await db.delete(appResponses);
  await db.delete(appRequests);
  return ctx.text("OK");
}",
              "fileName": "src/routes/app-routes.ts",
              "id": "src/routes/app-routes.ts@4090",
              "line": 147,
              "modules": {},
              "references": [
                {
                  "character": 28,
                  "content": "const appResponses = sqliteTable("app_responses", {
  id: integer("id", { mode: "number" }).primaryKey(),
  traceId: text("trace_id", { mode: "text" }).notNull(),
  responseStatusCode: integer("response_status_code", { mode: "number" }),
  responseTime: integer("response_time", { mode: "number" }),
  responseHeaders: text("response_headers", { mode: "json" }).$type<{
    [key: string]: string;
  }>(),
  responseBody: text("response_body", { mode: "text" }),
  failureReason: text("failure_reason"),
  failureDetails: text("failure_details", { mode: "json" }).$type<{
    [key: string]: string;
  }>(),
  isFailure: integer("is_failure", { mode: "boolean" }).default(false),
  createdAt: text("created_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  updatedAt: text("updated_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  requestId: integer("request_id").references(() => appRequests.id),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@2752",
                  "line": 70,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "sqliteTable",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "sql",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 13,
                      "content": "const appRequests = sqliteTable("app_requests", {
  id: integer("id", { mode: "number" }).primaryKey(),
  requestMethod: text("request_method", {
    mode: "text",
    enum: [
      "GET",
      "POST",
      "PATCH",
      "PUT",
      "DELETE",
      "HEAD",
      "OPTIONS",
      "CONNECT",
      "TRACE",
    ],
  }).notNull(),
  requestUrl: text("request_url", { mode: "text" }).notNull(),
  requestHeaders: text("request_headers", { mode: "json" }).$type<
    Record<string, string>
  >(),
  requestQueryParams: text("request_query_params", { mode: "json" }),
  requestPathParams: text("request_path_params", { mode: "json" }),
  requestBody: text("request_body", { mode: "json" }),
  // The hono route corresponding to this request
  requestRoute: text("request_route"),
  createdAt: text("created_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  updatedAt: text("updated_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  // responseId: integer("response_id").references(() => appResponses.id),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@1717",
                      "line": 40,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "sqliteTable",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "sql",
                            "importPath": "drizzle-orm",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
                {
                  "character": 27,
                  "content": "const appRequests = sqliteTable("app_requests", {
  id: integer("id", { mode: "number" }).primaryKey(),
  requestMethod: text("request_method", {
    mode: "text",
    enum: [
      "GET",
      "POST",
      "PATCH",
      "PUT",
      "DELETE",
      "HEAD",
      "OPTIONS",
      "CONNECT",
      "TRACE",
    ],
  }).notNull(),
  requestUrl: text("request_url", { mode: "text" }).notNull(),
  requestHeaders: text("request_headers", { mode: "json" }).$type<
    Record<string, string>
  >(),
  requestQueryParams: text("request_query_params", { mode: "json" }),
  requestPathParams: text("request_path_params", { mode: "json" }),
  requestBody: text("request_body", { mode: "json" }),
  // The hono route corresponding to this request
  requestRoute: text("request_route"),
  createdAt: text("created_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  updatedAt: text("updated_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  // responseId: integer("response_id").references(() => appResponses.id),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@1731",
                  "line": 40,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "sqliteTable",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "sql",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/app-routes.ts@4230",
          "method": "get",
          "path": "/v0/all-requests",
          "sources": [
            {
              "character": 28,
              "content": "async (ctx) => {
  const db = ctx.get("db");
  const requests = await db
    .select()
    .from(appResponses)
    .rightJoin(appRequests, eq(appResponses.requestId, appRequests.id))
    .limit(1000);
  return ctx.json(requests);
}",
              "fileName": "src/routes/app-routes.ts",
              "id": "src/routes/app-routes.ts@4258",
              "line": 154,
              "modules": {
                "drizzle-orm": [
                  {
                    "import": "eq",
                    "importPath": "drizzle-orm",
                    "name": "drizzle-orm",
                    "version": "0.33.0",
                  },
                ],
              },
              "references": [
                {
                  "character": 28,
                  "content": "const appResponses = sqliteTable("app_responses", {
  id: integer("id", { mode: "number" }).primaryKey(),
  traceId: text("trace_id", { mode: "text" }).notNull(),
  responseStatusCode: integer("response_status_code", { mode: "number" }),
  responseTime: integer("response_time", { mode: "number" }),
  responseHeaders: text("response_headers", { mode: "json" }).$type<{
    [key: string]: string;
  }>(),
  responseBody: text("response_body", { mode: "text" }),
  failureReason: text("failure_reason"),
  failureDetails: text("failure_details", { mode: "json" }).$type<{
    [key: string]: string;
  }>(),
  isFailure: integer("is_failure", { mode: "boolean" }).default(false),
  createdAt: text("created_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  updatedAt: text("updated_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  requestId: integer("request_id").references(() => appRequests.id),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@2752",
                  "line": 70,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "sqliteTable",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "sql",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 13,
                      "content": "const appRequests = sqliteTable("app_requests", {
  id: integer("id", { mode: "number" }).primaryKey(),
  requestMethod: text("request_method", {
    mode: "text",
    enum: [
      "GET",
      "POST",
      "PATCH",
      "PUT",
      "DELETE",
      "HEAD",
      "OPTIONS",
      "CONNECT",
      "TRACE",
    ],
  }).notNull(),
  requestUrl: text("request_url", { mode: "text" }).notNull(),
  requestHeaders: text("request_headers", { mode: "json" }).$type<
    Record<string, string>
  >(),
  requestQueryParams: text("request_query_params", { mode: "json" }),
  requestPathParams: text("request_path_params", { mode: "json" }),
  requestBody: text("request_body", { mode: "json" }),
  // The hono route corresponding to this request
  requestRoute: text("request_route"),
  createdAt: text("created_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  updatedAt: text("updated_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  // responseId: integer("response_id").references(() => appResponses.id),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@1717",
                      "line": 40,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "sqliteTable",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "sql",
                            "importPath": "drizzle-orm",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
                {
                  "character": 27,
                  "content": "const appRequests = sqliteTable("app_requests", {
  id: integer("id", { mode: "number" }).primaryKey(),
  requestMethod: text("request_method", {
    mode: "text",
    enum: [
      "GET",
      "POST",
      "PATCH",
      "PUT",
      "DELETE",
      "HEAD",
      "OPTIONS",
      "CONNECT",
      "TRACE",
    ],
  }).notNull(),
  requestUrl: text("request_url", { mode: "text" }).notNull(),
  requestHeaders: text("request_headers", { mode: "json" }).$type<
    Record<string, string>
  >(),
  requestQueryParams: text("request_query_params", { mode: "json" }),
  requestPathParams: text("request_path_params", { mode: "json" }),
  requestBody: text("request_body", { mode: "json" }),
  // The hono route corresponding to this request
  requestRoute: text("request_route"),
  createdAt: text("created_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  updatedAt: text("updated_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  // responseId: integer("response_id").references(() => appResponses.id),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@1731",
                  "line": 40,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "sqliteTable",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "sql",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 28,
                  "content": "const appResponses = sqliteTable("app_responses", {
  id: integer("id", { mode: "number" }).primaryKey(),
  traceId: text("trace_id", { mode: "text" }).notNull(),
  responseStatusCode: integer("response_status_code", { mode: "number" }),
  responseTime: integer("response_time", { mode: "number" }),
  responseHeaders: text("response_headers", { mode: "json" }).$type<{
    [key: string]: string;
  }>(),
  responseBody: text("response_body", { mode: "text" }),
  failureReason: text("failure_reason"),
  failureDetails: text("failure_details", { mode: "json" }).$type<{
    [key: string]: string;
  }>(),
  isFailure: integer("is_failure", { mode: "boolean" }).default(false),
  createdAt: text("created_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  updatedAt: text("updated_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  requestId: integer("request_id").references(() => appRequests.id),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@2752",
                  "line": 70,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "sqliteTable",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "sql",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 13,
                      "content": "const appRequests = sqliteTable("app_requests", {
  id: integer("id", { mode: "number" }).primaryKey(),
  requestMethod: text("request_method", {
    mode: "text",
    enum: [
      "GET",
      "POST",
      "PATCH",
      "PUT",
      "DELETE",
      "HEAD",
      "OPTIONS",
      "CONNECT",
      "TRACE",
    ],
  }).notNull(),
  requestUrl: text("request_url", { mode: "text" }).notNull(),
  requestHeaders: text("request_headers", { mode: "json" }).$type<
    Record<string, string>
  >(),
  requestQueryParams: text("request_query_params", { mode: "json" }),
  requestPathParams: text("request_path_params", { mode: "json" }),
  requestBody: text("request_body", { mode: "json" }),
  // The hono route corresponding to this request
  requestRoute: text("request_route"),
  createdAt: text("created_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  updatedAt: text("updated_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  // responseId: integer("response_id").references(() => appResponses.id),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@1717",
                      "line": 40,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "sqliteTable",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "sql",
                            "importPath": "drizzle-orm",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
                {
                  "character": 27,
                  "content": "const appRequests = sqliteTable("app_requests", {
  id: integer("id", { mode: "number" }).primaryKey(),
  requestMethod: text("request_method", {
    mode: "text",
    enum: [
      "GET",
      "POST",
      "PATCH",
      "PUT",
      "DELETE",
      "HEAD",
      "OPTIONS",
      "CONNECT",
      "TRACE",
    ],
  }).notNull(),
  requestUrl: text("request_url", { mode: "text" }).notNull(),
  requestHeaders: text("request_headers", { mode: "json" }).$type<
    Record<string, string>
  >(),
  requestQueryParams: text("request_query_params", { mode: "json" }),
  requestPathParams: text("request_path_params", { mode: "json" }),
  requestBody: text("request_body", { mode: "json" }),
  // The hono route corresponding to this request
  requestRoute: text("request_route"),
  createdAt: text("created_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  updatedAt: text("updated_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  // responseId: integer("response_id").references(() => appResponses.id),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@1731",
                  "line": 40,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "sqliteTable",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "sql",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/app-routes.ts@5752",
          "method": undefined,
          "path": "/v0/proxy-request/*",
          "sources": [
            {
              "character": 2,
              "content": "zValidator("header", ProxyRequestHeadersSchema)",
              "fileName": "src/routes/app-routes.ts",
              "id": "src/routes/app-routes.ts@5869",
              "line": 207,
              "modules": {
                "@hono/zod-validator": [
                  {
                    "import": "zValidator",
                    "importPath": "@hono/zod-validator",
                    "name": "@hono/zod-validator",
                    "version": "0.2.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 13,
                  "content": "const ProxyRequestHeadersSchema = z.object({
  "x-fpx-trace-id": fallback(
    z.string().regex(OTEL_TRACE_ID_REGEX),
    generateOtelTraceId,
  ).describe("The otel trace id to use for the request"),
  "x-fpx-headers-json": z
    .string()
    .optional()
    .describe("The headers to use for the request, serialized as JSON"),
  "x-fpx-route": z
    .string()
    .optional()
    .describe("The Hono route pattern associated with the request"),
  "x-fpx-path-params": z
    .string()
    .optional()
    .describe("The path params to use for the request, if any"),
  "x-fpx-proxy-to": z
    .string()
    .describe(
      "The url to proxy to, this is the url we execute a request against",
    ),
})",
                  "fileName": "src/routes/app-routes.ts",
                  "id": "src/routes/app-routes.ts@4506",
                  "line": 164,
                  "modules": {
                    "zod": [
                      {
                        "import": "z",
                        "importPath": "zod",
                        "name": "zod",
                        "version": "3.23.8",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 0,
                      "content": "export function fallback<T extends Schema<any>, U>(
  schema: T,
  valueOrFn: U | (() => U),
): T | Schema<U> {
  return any().transform((val) => {
    const safe = schema.safeParse(val);
    if (safe.success) {
      return safe.data;
    }
    if (typeof valueOrFn === "function") {
      return (valueOrFn as () => U)();
    }
    return valueOrFn;
  });
}",
                      "fileName": "src/lib/utils.ts",
                      "id": "src/lib/utils.ts@3358",
                      "line": 124,
                      "modules": {
                        "zod": [
                          {
                            "import": "Schema",
                            "importPath": "zod",
                            "name": "zod",
                            "version": "3.23.8",
                          },
                          {
                            "import": "any",
                            "importPath": "zod",
                            "name": "zod",
                            "version": "3.23.8",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 0,
                      "content": "export function generateOtelTraceId(): string {
  return randomBytes(16).toString("hex");
}",
                      "fileName": "src/lib/otel/index.ts",
                      "id": "src/lib/otel/index.ts@720",
                      "line": 27,
                      "modules": {
                        "node:crypto": [
                          {
                            "import": "randomBytes",
                            "importPath": "node:crypto",
                            "name": "node:crypto",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
              ],
            },
            {
              "character": 2,
              "content": "async (ctx) => {
    const {
      "x-fpx-trace-id": traceIdHeader,
      "x-fpx-proxy-to": proxyToHeader,
      "x-fpx-path-params": pathParamsHeader,
      "x-fpx-route": routeHeader,
      "x-fpx-headers-json": headersJsonHeader,
    } = ctx.req.valid("header");
    // Try to extract the trace id from the header, otherwise generate a new one
    const shouldUseHeaderTraceId = isValidOtelTraceId(traceIdHeader ?? "");
    const traceId: string =
      traceIdHeader && shouldUseHeaderTraceId
        ? traceIdHeader
        : generateOtelTraceId();

    if (!shouldUseHeaderTraceId) {
      logger.debug(
        \`Invalid trace id in header: \${traceIdHeader}, generating new trace id: \${traceId}\`,
      );
    }

    const db = ctx.get("db");

    const requestRoute = routeHeader ?? null;
    const requestPathParams = pathParamsHeader
      ? safeParseJson(pathParamsHeader)
      : null;

    const requestMethod = ctx.req.method;
    const requestUrlHeader = proxyToHeader;

    // NOTE - These are the headers that will be used in the request to the service
    const requestHeaders: Record<string, string> =
      constructProxiedRequestHeaders(ctx, headersJsonHeader ?? "", traceId);

    // Construct the url we want to proxy to, using the query params from the original request
    const requestQueryParams = {
      ...ctx.req.query(),
    };
    const requestUrl = resolveUrlQueryParams(
      requestUrlHeader,
      requestQueryParams,
    );
    logger.debug("Proxying request to:", requestUrl);
    logger.debug("Proxying request with headers:", requestHeaders);

    // Create a new request object
    // Clone the incoming request, so we can make a proxy Request object
    const clonedReq = ctx.req.raw.clone();
    const proxiedReq = new Request(requestUrl, {
      method: requestMethod,
      headers: new Headers(requestHeaders),
      body: clonedReq.body ? clonedReq.body.tee()[0] : null,
    });

    // Extract the request body based on content type
    // *The whole point of this is to serialize the request body into the database, for future reference*
    //
    let requestBody:
      | null
      | string
      | {
          [x: string]: string | SerializedFile | (string | SerializedFile)[];
        } = null;
    try {
      requestBody = await serializeRequestBodyForFpxDb(ctx);
    } catch (error) {
      requestBody = "<failed to parse>";
      logger.error("Failed to serialize request body", error);
    }

    // Record request details
    const newRequest: NewAppRequest = {
      // @ts-expect-error - Trust me, the request method is correct, and it's a string
      requestMethod,
      requestUrl,
      requestHeaders,
      requestPathParams,
      requestQueryParams,
      requestBody,
      requestRoute,
      updatedAt: new Date().toISOString(),
      createdAt: new Date().toISOString(),
    };

    const insertResult = await db
      .insert(appRequests)
      .values(newRequest)
      .returning({ requestId: appRequests.id });

    const requestId = insertResult[0].requestId;

    const startTime = Date.now();
    try {
      // Proxy the request
      const response = await executeProxyRequest(proxiedReq);

      // Clone the response and prepare to return it
      const clonedResponse = response.clone();

      const newHeaders = new Headers(clonedResponse.headers);

      // HACK - Frontend often couldn't parse the body because of encoding mismatch
      newHeaders.delete("content-encoding");
      // HACK - Having an explicit content length could mess up the frontend
      //        when the body is a stream ((this happened when running a hono app on Deno))
      newHeaders.delete("content-length");

      const proxiedResponse = new Response(clonedResponse.body, {
        status: response.status,
        statusText: response.statusText,
        headers: newHeaders,
      });
      const duration = Date.now() - startTime;

      await handleSuccessfulRequest(db, requestId, duration, response, traceId);

      proxiedResponse.headers.set("x-fpx-trace-id", traceId);

      return proxiedResponse;
    } catch (fetchError) {
      logger.debug("Error executing proxied request (fetchError):", fetchError);
      const responseTime = Date.now() - startTime;
      const { failureDetails, failureReason, isFailure } =
        await handleFailedRequest(
          db,
          requestId,
          traceId,
          responseTime,
          fetchError,
        );

      ctx.header("x-fpx-trace-id", traceId);
      ctx.status(500);
      return ctx.json({
        isFailure,
        responseTime,
        failureDetails,
        failureReason,
        traceId,
        requestId,
      });
    }
  }",
              "fileName": "src/routes/app-routes.ts",
              "id": "src/routes/app-routes.ts@5920",
              "line": 208,
              "modules": {},
              "references": [
                {
                  "character": 0,
                  "content": "export function isValidOtelTraceId(traceId: string): boolean {
  return OTEL_TRACE_ID_REGEX.test(traceId);
}",
                  "fileName": "src/lib/otel/index.ts",
                  "id": "src/lib/otel/index.ts@452",
                  "line": 19,
                  "modules": {},
                  "references": [
                    {
                      "character": 13,
                      "content": "const OTEL_TRACE_ID_REGEX = /^[0-9a-f]{32}$/i",
                      "fileName": "src/lib/otel/index.ts",
                      "id": "src/lib/otel/index.ts@354",
                      "line": 14,
                      "modules": {},
                      "references": [],
                    },
                  ],
                },
                {
                  "character": 0,
                  "content": "export function generateOtelTraceId(): string {
  return randomBytes(16).toString("hex");
}",
                  "fileName": "src/lib/otel/index.ts",
                  "id": "src/lib/otel/index.ts@720",
                  "line": 27,
                  "modules": {
                    "node:crypto": [
                      {
                        "import": "randomBytes",
                        "importPath": "node:crypto",
                        "name": "node:crypto",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 0,
                  "content": "export function safeParseJson(str: string | null | undefined) {
  if (!str) {
    return null;
  }
  try {
    return JSON.parse(str);
  } catch {
    return str;
  }
}",
                  "fileName": "src/lib/utils.ts",
                  "id": "src/lib/utils.ts@3106",
                  "line": 112,
                  "modules": {},
                  "references": [],
                },
                {
                  "character": 0,
                  "content": "function constructProxiedRequestHeaders(
  ctx: Context,
  fpxRequestorUiHeaders: string,
  traceId: string,
) {
  // NOTE - These are the headers that were set in the FPX ui itself
  const requestHeadersFromRequestorUi: Record<string, string> = isJson(
    fpxRequestorUiHeaders,
  )
    ? safeParseJson(fpxRequestorUiHeaders)
    : {};

  // NOTE - These are the headers that will be used in the request to the service
  const requestHeaders: Record<string, string> = {};

  // NOTE - We don't want to copy over the headers that were set by the browser fetch client
  //        This is because the browser fetch client sets some headers that we don't want to pass through
  //        to the service, such as the referer header, and several sec-fetch headers, etc
  //        See: FP-3930
  //
  // ctx.req.raw.headers.forEach((value, key) => {
  //   if (ignoreTheseHeaders.includes(key.toLowerCase())) {
  //     return;
  //   }
  //   requestHeaders[key] = value;
  // });

  for (const [key, value] of Object.entries(requestHeadersFromRequestorUi)) {
    // If a header is in this list, we don't want to pass it through to the service
    if (PROXY_HEADERS_IGNORE.includes(key.toLowerCase())) {
      continue;
    }
    requestHeaders[key] = value;
  }

  const alreadyHasContentType = Object.keys(requestHeaders).some(
    (key) => key.toLowerCase() === "content-type",
  );

  // Give the user's content type preference priority,
  // Otherwise, use the content type from the original request
  // This is important for multipart form data, for which we want to preserve the form boundary
  if (!alreadyHasContentType) {
    const rawContentType = ctx.req.raw.headers.get("content-type");
    if (rawContentType) {
      requestHeaders["Content-Type"] = rawContentType;
    }
  }

  // Ensure the trace id is present
  if (!requestHeaders["x-fpx-trace-id"]) {
    requestHeaders["x-fpx-trace-id"] = traceId;
  }

  return requestHeaders;
}",
                  "fileName": "src/routes/app-routes.ts",
                  "id": "src/routes/app-routes.ts@11180",
                  "line": 373,
                  "modules": {
                    "hono": [
                      {
                        "import": "Context",
                        "importPath": "hono",
                        "name": "hono",
                        "version": "4.6.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 0,
                      "content": "export function isJson(str: unknown) {
  if (typeof str !== "string") {
    return false;
  }
  try {
    JSON.parse(str);
    return true;
  } catch {
    return false;
  }
}",
                      "fileName": "src/lib/utils.ts",
                      "id": "src/lib/utils.ts@208",
                      "line": 7,
                      "modules": {},
                      "references": [],
                    },
                    {
                      "character": 0,
                      "content": "export function safeParseJson(str: string | null | undefined) {
  if (!str) {
    return null;
  }
  try {
    return JSON.parse(str);
  } catch {
    return str;
  }
}",
                      "fileName": "src/lib/utils.ts",
                      "id": "src/lib/utils.ts@3106",
                      "line": 112,
                      "modules": {},
                      "references": [],
                    },
                    {
                      "character": 6,
                      "content": "const PROXY_HEADERS_IGNORE = [
  "x-fpx-route",
  "x-fpx-path-params",
  "x-fpx-proxy-to",
]",
                      "fileName": "src/routes/app-routes.ts",
                      "id": "src/routes/app-routes.ts@5212",
                      "line": 188,
                      "modules": {},
                      "references": [],
                    },
                  ],
                },
                {
                  "character": 27,
                  "content": "const appRequests = sqliteTable("app_requests", {
  id: integer("id", { mode: "number" }).primaryKey(),
  requestMethod: text("request_method", {
    mode: "text",
    enum: [
      "GET",
      "POST",
      "PATCH",
      "PUT",
      "DELETE",
      "HEAD",
      "OPTIONS",
      "CONNECT",
      "TRACE",
    ],
  }).notNull(),
  requestUrl: text("request_url", { mode: "text" }).notNull(),
  requestHeaders: text("request_headers", { mode: "json" }).$type<
    Record<string, string>
  >(),
  requestQueryParams: text("request_query_params", { mode: "json" }),
  requestPathParams: text("request_path_params", { mode: "json" }),
  requestBody: text("request_body", { mode: "json" }),
  // The hono route corresponding to this request
  requestRoute: text("request_route"),
  createdAt: text("created_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  updatedAt: text("updated_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  // responseId: integer("response_id").references(() => appResponses.id),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@1731",
                  "line": 40,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "sqliteTable",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "sql",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 27,
                  "content": "const appRequests = sqliteTable("app_requests", {
  id: integer("id", { mode: "number" }).primaryKey(),
  requestMethod: text("request_method", {
    mode: "text",
    enum: [
      "GET",
      "POST",
      "PATCH",
      "PUT",
      "DELETE",
      "HEAD",
      "OPTIONS",
      "CONNECT",
      "TRACE",
    ],
  }).notNull(),
  requestUrl: text("request_url", { mode: "text" }).notNull(),
  requestHeaders: text("request_headers", { mode: "json" }).$type<
    Record<string, string>
  >(),
  requestQueryParams: text("request_query_params", { mode: "json" }),
  requestPathParams: text("request_path_params", { mode: "json" }),
  requestBody: text("request_body", { mode: "json" }),
  // The hono route corresponding to this request
  requestRoute: text("request_route"),
  createdAt: text("created_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  updatedAt: text("updated_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  // responseId: integer("response_id").references(() => appResponses.id),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@1731",
                  "line": 40,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "sqliteTable",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/sqlite-core",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "sql",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 0,
                  "content": "export async function executeProxyRequest(
  reqOrAppReq: NewAppRequest | Request,
) {
  const proxiedReq =
    reqOrAppReq instanceof Request
      ? reqOrAppReq
      : createProxyRequestFromNewAppRequest(reqOrAppReq);

  try {
    const response = await fetch(proxiedReq);
    return response;
  } catch (err) {
    logger.error("executeProxyRequest fetchError:", err);
    throw err;
  }
}",
                  "fileName": "src/lib/proxy-request/index.ts",
                  "id": "src/lib/proxy-request/index.ts@535",
                  "line": 18,
                  "modules": {},
                  "references": [
                    {
                      "character": 0,
                      "content": "function createProxyRequestFromNewAppRequest(
  requestDescription: NewAppRequest,
) {
  const { requestUrl, requestMethod, requestBody } = requestDescription;

  let { requestHeaders } = requestDescription;

  if (!requestHeaders) {
    requestHeaders = {};
  }

  let validBody: BodyInit | null = null;
  if (requestBody != null) {
    if (
      requestBody instanceof Blob ||
      requestBody instanceof ArrayBuffer ||
      requestBody instanceof FormData ||
      requestBody instanceof URLSearchParams ||
      requestBody instanceof ReadableStream ||
      typeof requestBody === "string"
    ) {
      validBody = requestBody;
    } else if (requestBody && typeof requestBody === "object") {
      logger.debug(
        "executeProxyRequest requestBody is an object, stringifying it",
      );
      validBody = JSON.stringify(requestBody);
    } else {
      logger.warn("Invalid requestBody type. Setting to null.");
    }
  }

  const proxiedReq = new Request(requestUrl, {
    method: requestMethod,
    headers: new Headers(requestHeaders),
    body: validBody,
  });

  return proxiedReq;
}",
                      "fileName": "src/lib/proxy-request/index.ts",
                      "id": "src/lib/proxy-request/index.ts@930",
                      "line": 35,
                      "modules": {},
                      "references": [],
                    },
                  ],
                },
                {
                  "character": 0,
                  "content": "export async function handleSuccessfulRequest(
  db: DbType,
  requestId: RequestIdType,
  duration: number,
  response: Awaited<ReturnType<typeof fetch>>,
  traceId: string,
) {
  const { responseBody, responseTime, responseHeaders, responseStatusCode } =
    await appResponseInsertSchema
      .extend({
        headers: z.instanceof(Headers),
        status: z.number(),
        body: z.instanceof(ReadableStream).nullable(),
        traceId: z.string().optional(),
      })
      .transform(async ({ headers, status }) => {
        const responseHeaders: Record<string, string> = {};
        // NOTE - Order of arguments when you do \`forEach\` on a Headers object is (headerValue, headerName)
        headers.forEach((headerValue, headerName) => {
          responseHeaders[headerName] = headerValue;
        });

        return {
          responseHeaders,
          responseStatusCode: status,
          responseBody: await safeReadTextBody(response),
          responseTime: duration,
        };
      })
      .parseAsync(response);

  await db.insert(appResponses).values([
    {
      isFailure: false,
      responseStatusCode,
      responseTime,
      responseHeaders,
      responseBody,
      traceId,
      requestId,
    },
  ]);

  return {
    isFailure: false,
    responseStatusCode,
    responseTime,
    responseHeaders,
    responseBody,
    traceId,
  };
}",
                  "fileName": "src/lib/proxy-request/index.ts",
                  "id": "src/lib/proxy-request/index.ts@3164",
                  "line": 130,
                  "modules": {
                    "zod": [
                      {
                        "import": "z",
                        "importPath": "zod",
                        "name": "zod",
                        "version": "3.23.8",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 0,
                      "content": "type DbType = LibSQLDatabase<typeof schema>;",
                      "fileName": "src/lib/proxy-request/index.ts",
                      "id": "src/lib/proxy-request/index.ts@392",
                      "line": 13,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "LibSQLDatabase",
                            "importPath": "drizzle-orm/libsql",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 0,
                      "content": "type RequestIdType = schema.AppResponse["requestId"];",
                      "fileName": "src/lib/proxy-request/index.ts",
                      "id": "src/lib/proxy-request/index.ts@338",
                      "line": 12,
                      "modules": {},
                      "references": [],
                    },
                    {
                      "character": 39,
                      "content": "const appResponseInsertSchema = createInsertSchema(appResponses)",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@4716",
                      "line": 127,
                      "modules": {
                        "drizzle-zod": [
                          {
                            "import": "createInsertSchema",
                            "importPath": "drizzle-zod",
                            "name": "drizzle-zod",
                            "version": "0.5.1",
                          },
                        ],
                      },
                      "references": [
                        {
                          "character": 13,
                          "content": "const appResponses = sqliteTable("app_responses", {
  id: integer("id", { mode: "number" }).primaryKey(),
  traceId: text("trace_id", { mode: "text" }).notNull(),
  responseStatusCode: integer("response_status_code", { mode: "number" }),
  responseTime: integer("response_time", { mode: "number" }),
  responseHeaders: text("response_headers", { mode: "json" }).$type<{
    [key: string]: string;
  }>(),
  responseBody: text("response_body", { mode: "text" }),
  failureReason: text("failure_reason"),
  failureDetails: text("failure_details", { mode: "json" }).$type<{
    [key: string]: string;
  }>(),
  isFailure: integer("is_failure", { mode: "boolean" }).default(false),
  createdAt: text("created_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  updatedAt: text("updated_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  requestId: integer("request_id").references(() => appRequests.id),
})",
                          "fileName": "src/db/schema.ts",
                          "id": "src/db/schema.ts@2737",
                          "line": 70,
                          "modules": {
                            "drizzle-orm": [
                              {
                                "import": "sqliteTable",
                                "importPath": "drizzle-orm/sqlite-core",
                                "name": "drizzle-orm",
                                "version": "0.33.0",
                              },
                              {
                                "import": "integer",
                                "importPath": "drizzle-orm/sqlite-core",
                                "name": "drizzle-orm",
                                "version": "0.33.0",
                              },
                              {
                                "import": "text",
                                "importPath": "drizzle-orm/sqlite-core",
                                "name": "drizzle-orm",
                                "version": "0.33.0",
                              },
                              {
                                "import": "sql",
                                "importPath": "drizzle-orm",
                                "name": "drizzle-orm",
                                "version": "0.33.0",
                              },
                            ],
                          },
                          "references": [
                            {
                              "character": 13,
                              "content": "const appRequests = sqliteTable("app_requests", {
  id: integer("id", { mode: "number" }).primaryKey(),
  requestMethod: text("request_method", {
    mode: "text",
    enum: [
      "GET",
      "POST",
      "PATCH",
      "PUT",
      "DELETE",
      "HEAD",
      "OPTIONS",
      "CONNECT",
      "TRACE",
    ],
  }).notNull(),
  requestUrl: text("request_url", { mode: "text" }).notNull(),
  requestHeaders: text("request_headers", { mode: "json" }).$type<
    Record<string, string>
  >(),
  requestQueryParams: text("request_query_params", { mode: "json" }),
  requestPathParams: text("request_path_params", { mode: "json" }),
  requestBody: text("request_body", { mode: "json" }),
  // The hono route corresponding to this request
  requestRoute: text("request_route"),
  createdAt: text("created_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  updatedAt: text("updated_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  // responseId: integer("response_id").references(() => appResponses.id),
})",
                              "fileName": "src/db/schema.ts",
                              "id": "src/db/schema.ts@1717",
                              "line": 40,
                              "modules": {
                                "drizzle-orm": [
                                  {
                                    "import": "sqliteTable",
                                    "importPath": "drizzle-orm/sqlite-core",
                                    "name": "drizzle-orm",
                                    "version": "0.33.0",
                                  },
                                  {
                                    "import": "integer",
                                    "importPath": "drizzle-orm/sqlite-core",
                                    "name": "drizzle-orm",
                                    "version": "0.33.0",
                                  },
                                  {
                                    "import": "text",
                                    "importPath": "drizzle-orm/sqlite-core",
                                    "name": "drizzle-orm",
                                    "version": "0.33.0",
                                  },
                                  {
                                    "import": "sql",
                                    "importPath": "drizzle-orm",
                                    "name": "drizzle-orm",
                                    "version": "0.33.0",
                                  },
                                ],
                              },
                              "references": [],
                            },
                          ],
                        },
                      ],
                    },
                  ],
                },
                {
                  "character": 0,
                  "content": "export async function handleFailedRequest(
  db: DbType,
  requestId: RequestIdType,
  traceId: string,
  responseTime: number,
  error: unknown,
) {
  let failureReason = "unknown";
  if (hasMessage(error)) {
    failureReason = error.message;
  }
  let failureDetails: Record<string, string> = {};
  if (error instanceof Error) {
    failureDetails = errorToJson(error);
  }

  await db.insert(appResponses).values([
    {
      isFailure: true,
      responseTime,
      traceId,
      requestId,
      failureReason,
      failureDetails,
    },
  ]);

  return {
    isFailure: true,
    responseTime,
    traceId,
    requestId,
    failureReason,
    failureDetails,
  };
}",
                  "fileName": "src/lib/proxy-request/index.ts",
                  "id": "src/lib/proxy-request/index.ts@2157",
                  "line": 80,
                  "modules": {},
                  "references": [
                    {
                      "character": 0,
                      "content": "type DbType = LibSQLDatabase<typeof schema>;",
                      "fileName": "src/lib/proxy-request/index.ts",
                      "id": "src/lib/proxy-request/index.ts@392",
                      "line": 13,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "LibSQLDatabase",
                            "importPath": "drizzle-orm/libsql",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 0,
                      "content": "type RequestIdType = schema.AppResponse["requestId"];",
                      "fileName": "src/lib/proxy-request/index.ts",
                      "id": "src/lib/proxy-request/index.ts@338",
                      "line": 12,
                      "modules": {},
                      "references": [],
                    },
                    {
                      "character": 0,
                      "content": "function hasMessage(error: unknown): error is { message: string } {
  return (
    !!error &&
    typeof error === "object" &&
    "message" in error &&
    typeof error?.message === "string"
  );
}",
                      "fileName": "src/lib/proxy-request/index.ts",
                      "id": "src/lib/proxy-request/index.ts@2839",
                      "line": 117,
                      "modules": {},
                      "references": [],
                    },
                    {
                      "character": 0,
                      "content": "export function errorToJson(error: Error) {
  return {
    name: error.name, // Includes the name of the error, e.g., 'TypeError'
    message: error.message, // The message string of the error
    stack: error.stack ?? "", // Stack trace of where the error occurred (useful for debugging)
    // Optionally add more properties here if needed
  };
}",
                      "fileName": "src/lib/utils.ts",
                      "id": "src/lib/utils.ts@940",
                      "line": 42,
                      "modules": {},
                      "references": [],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/app-routes.ts@10611",
          "method": "get",
          "path": "/v0/webhonc",
          "sources": [
            {
              "character": 23,
              "content": "async (ctx) => {
  const db = ctx.get("db");
  const connectionId = await getWebHoncConnectionId(db);
  const baseUrl = resolveWebhoncUrl();
  const protocol = baseUrl.startsWith("localhost") ? "http" : "https";
  return ctx.json({ webhoncUrl: \`\${protocol}://\${baseUrl}/\${connectionId}\` });
}",
              "fileName": "src/routes/app-routes.ts",
              "id": "src/routes/app-routes.ts@10634",
              "line": 354,
              "modules": {},
              "references": [
                {
                  "character": 0,
                  "content": "export async function getWebHoncConnectionId(
  db: LibSQLDatabase<typeof schema>,
) {
  return ((await getSetting(db, "webhoncConnectionId")) ?? false) as string;
}",
                  "fileName": "src/lib/webhonc/store.ts",
                  "id": "src/lib/webhonc/store.ts@338",
                  "line": 11,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "LibSQLDatabase",
                        "importPath": "drizzle-orm/libsql",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 0,
                      "content": "export async function getSetting<T extends SettingsKey>(
  db: LibSQLDatabase<typeof schema>,
  key: T,
): Promise<Settings[T] | undefined> {
  const result = await db.query.settings.findFirst({
    where: eq(settings.key, String(key)),
  });

  if (!result?.value) {
    return;
  }

  return safeParseJson(result.value);
}",
                      "fileName": "src/lib/settings/index.ts",
                      "id": "src/lib/settings/index.ts@1283",
                      "line": 53,
                      "modules": {
                        "@fiberplane/fpx-types": [
                          {
                            "import": "SettingsKey",
                            "importPath": "@fiberplane/fpx-types",
                            "name": "@fiberplane/fpx-types",
                            "version": "0.0.9",
                          },
                          {
                            "import": "Settings",
                            "importPath": "@fiberplane/fpx-types",
                            "name": "@fiberplane/fpx-types",
                            "version": "0.0.9",
                          },
                        ],
                        "drizzle-orm": [
                          {
                            "import": "LibSQLDatabase",
                            "importPath": "drizzle-orm/libsql",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "eq",
                            "importPath": "drizzle-orm",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                        ],
                      },
                      "references": [
                        {
                          "character": 24,
                          "content": "const settings = sqliteTable("settings", {
  id: integer("id", { mode: "number" }).primaryKey({ autoIncrement: true }),
  key: text("key").notNull().unique(),
  value: text("value").notNull().default(""),
  createdAt: text("created_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  updatedAt: text("updated_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
})",
                          "fileName": "src/db/schema.ts",
                          "id": "src/db/schema.ts@6483",
                          "line": 172,
                          "modules": {
                            "drizzle-orm": [
                              {
                                "import": "sqliteTable",
                                "importPath": "drizzle-orm/sqlite-core",
                                "name": "drizzle-orm",
                                "version": "0.33.0",
                              },
                              {
                                "import": "integer",
                                "importPath": "drizzle-orm/sqlite-core",
                                "name": "drizzle-orm",
                                "version": "0.33.0",
                              },
                              {
                                "import": "text",
                                "importPath": "drizzle-orm/sqlite-core",
                                "name": "drizzle-orm",
                                "version": "0.33.0",
                              },
                              {
                                "import": "sql",
                                "importPath": "drizzle-orm",
                                "name": "drizzle-orm",
                                "version": "0.33.0",
                              },
                            ],
                          },
                          "references": [],
                        },
                        {
                          "character": 0,
                          "content": "export function safeParseJson(str: string | null | undefined) {
  if (!str) {
    return null;
  }
  try {
    return JSON.parse(str);
  } catch {
    return str;
  }
}",
                          "fileName": "src/lib/utils.ts",
                          "id": "src/lib/utils.ts@3106",
                          "line": 112,
                          "modules": {},
                          "references": [],
                        },
                      ],
                    },
                  ],
                },
                {
                  "character": 0,
                  "content": "export function resolveWebhoncUrl() {
  const fallbackUrl = "webhonc.mies.workers.dev";
  if (!process.env.FPX_WEBHONC_BASE_URL) {
    return fallbackUrl;
  }
  const customUrl = new URL(process.env.FPX_WEBHONC_BASE_URL);
  return customUrl.host;
}",
                  "fileName": "src/lib/utils.ts",
                  "id": "src/lib/utils.ts@8151",
                  "line": 285,
                  "modules": {},
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
      ],
      "fileName": "src/routes/app-routes.ts",
      "id": "src/routes/app-routes.ts@1073",
      "name": "app",
    },
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "src/routes/auth.ts@637",
          "method": "get",
          "path": "/v0/auth/user",
          "sources": [
            {
              "character": 25,
              "content": "cors()",
              "fileName": "src/routes/auth.ts",
              "id": "src/routes/auth.ts@662",
              "line": 16,
              "modules": {
                "hono": [
                  {
                    "import": "cors",
                    "importPath": "hono/cors",
                    "name": "hono",
                    "version": "4.6.2",
                  },
                ],
              },
              "references": [],
            },
            {
              "character": 33,
              "content": "async (ctx) => {
  const db = ctx.get("db");
  const [token] = await db
    .select()
    .from(schema.tokens)
    .orderBy(desc(schema.tokens.createdAt))
    .limit(1);

  if (!token) {
    return ctx.json(null);
  }

  try {
    const user = await getUser(token.value);

    if (!user) {
      await db
        .delete(schema.tokens)
        .where(eq(schema.tokens.value, token.value))
        .catch((error) => {
          const errorMessage =
            error instanceof Error ? error.message : "Unknown error";
          logger.error(
            "Error deleting token for user that was not found",
            errorMessage,
          );
        });
      return ctx.json(null);
    }

    return ctx.json({
      ...user,
      token: token.value,
      expiresAt: token.expiresAt,
    });
  } catch (error) {
    if (error instanceof TokenExpiredError) {
      logger.debug("Token expired, deleting from database");
      // NOTE - We catch errors so as not to throw if deletion fails
      await db
        .delete(schema.tokens)
        .where(eq(schema.tokens.value, token.value))
        .catch((error) => {
          const errorMessage =
            error instanceof Error ? error.message : "Unknown error";
          logger.error("Error deleting expired token:", errorMessage);
        });
    }
    return ctx.json(null);
  }
}",
              "fileName": "src/routes/auth.ts",
              "id": "src/routes/auth.ts@670",
              "line": 16,
              "modules": {
                "drizzle-orm": [
                  {
                    "import": "desc",
                    "importPath": "drizzle-orm",
                    "name": "drizzle-orm",
                    "version": "0.33.0",
                  },
                  {
                    "import": "eq",
                    "importPath": "drizzle-orm",
                    "name": "drizzle-orm",
                    "version": "0.33.0",
                  },
                ],
              },
              "references": [],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/auth.ts@2241",
          "method": "delete",
          "path": "/v0/auth/user",
          "sources": [
            {
              "character": 28,
              "content": "cors()",
              "fileName": "src/routes/auth.ts",
              "id": "src/routes/auth.ts@2269",
              "line": 73,
              "modules": {
                "hono": [
                  {
                    "import": "cors",
                    "importPath": "hono/cors",
                    "name": "hono",
                    "version": "4.6.2",
                  },
                ],
              },
              "references": [],
            },
            {
              "character": 36,
              "content": "async (ctx) => {
  logger.debug("Deleting user details");
  const db = ctx.get("db");
  await db.delete(schema.tokens);
  // TODO - Make a request to Fiberplane Services to remove user from our D1 db
  return ctx.body(null, 204);
}",
              "fileName": "src/routes/auth.ts",
              "id": "src/routes/auth.ts@2277",
              "line": 73,
              "modules": {},
              "references": [],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/auth.ts@2539",
          "method": "post",
          "path": "/v0/auth/verify",
          "sources": [
            {
              "character": 28,
              "content": "cors()",
              "fileName": "src/routes/auth.ts",
              "id": "src/routes/auth.ts@2567",
              "line": 84,
              "modules": {
                "hono": [
                  {
                    "import": "cors",
                    "importPath": "hono/cors",
                    "name": "hono",
                    "version": "4.6.2",
                  },
                ],
              },
              "references": [],
            },
            {
              "character": 36,
              "content": "async (ctx) => {
  const token = ctx.req.header("Authorization")?.split(" ")?.[1];

  if (!token) {
    return ctx.json({ error: "No token provided" }, 400);
  }

  try {
    await verifyToken(token);
    logger.debug("Auth token verification successful");
    return ctx.json(true);
  } catch (error) {
    if (error instanceof TokenExpiredError) {
      return ctx.json({ error: "Token expired", type: error.name }, 401);
    }
    logger.error("Verification failed", error);
    return ctx.json({ error: "Verification failed" }, 401);
  }
}",
              "fileName": "src/routes/auth.ts",
              "id": "src/routes/auth.ts@2575",
              "line": 84,
              "modules": {},
              "references": [],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/auth.ts@3212",
          "method": "post",
          "path": "/v0/auth/success",
          "sources": [
            {
              "character": 2,
              "content": "cors()",
              "fileName": "src/routes/auth.ts",
              "id": "src/routes/auth.ts@3246",
              "line": 109,
              "modules": {
                "hono": [
                  {
                    "import": "cors",
                    "importPath": "hono/cors",
                    "name": "hono",
                    "version": "4.6.2",
                  },
                ],
              },
              "references": [],
            },
            {
              "character": 2,
              "content": "zValidator("json", TokenPayloadSchema)",
              "fileName": "src/routes/auth.ts",
              "id": "src/routes/auth.ts@3256",
              "line": 110,
              "modules": {
                "@hono/zod-validator": [
                  {
                    "import": "zValidator",
                    "importPath": "@hono/zod-validator",
                    "name": "@hono/zod-validator",
                    "version": "0.2.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 34,
                  "content": "const TokenPayloadSchema = z.object({
  token: z.string(),
  expiresAt: z.string(),
})",
                  "fileName": "src/lib/fp-services/types.ts",
                  "id": "src/lib/fp-services/types.ts@107",
                  "line": 3,
                  "modules": {
                    "zod": [
                      {
                        "import": "z",
                        "importPath": "zod",
                        "name": "zod",
                        "version": "3.23.8",
                      },
                    ],
                  },
                  "references": [],
                },
              ],
            },
            {
              "character": 2,
              "content": "async (ctx) => {
    const { token, expiresAt } = ctx.req.valid("json");

    const db = ctx.get("db");
    const wsConnections = ctx.get("wsConnections");

    try {
      await db.insert(schema.tokens).values({
        value: token,
        expiresAt,
      });

      // Force the UI to refresh user information,
      // effectively logging the user in.
      if (wsConnections) {
        for (const ws of wsConnections) {
          ws.send(
            JSON.stringify({
              event: "login_success",
              payload: ["userInfo"],
            }),
          );
        }
      }

      return ctx.text("OK");
    } catch (error) {
      logger.error("Error handling auth success message:", error);
      return ctx.text("Unknown error", 500);
    }
  }",
              "fileName": "src/routes/auth.ts",
              "id": "src/routes/auth.ts@3298",
              "line": 111,
              "modules": {},
              "references": [],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
      ],
      "fileName": "src/routes/auth.ts",
      "id": "src/routes/auth.ts@497",
      "name": "app",
    },
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "src/routes/inference/inference.ts@790",
          "method": "post",
          "path": "/v0/expand-function",
          "sources": [
            {
              "character": 32,
              "content": "cors()",
              "fileName": "src/routes/inference/inference.ts",
              "id": "src/routes/inference/inference.ts@822",
              "line": 19,
              "modules": {
                "hono": [
                  {
                    "import": "cors",
                    "importPath": "hono/cors",
                    "name": "hono",
                    "version": "4.6.2",
                  },
                ],
              },
              "references": [],
            },
            {
              "character": 40,
              "content": "async (ctx) => {
  const { handler } = await ctx.req.json();
  const projectRoot = USER_PROJECT_ROOT_DIR;

  const expandedFunction = await expandFunction(projectRoot, handler);
  return ctx.json({ expandedFunction });
}",
              "fileName": "src/routes/inference/inference.ts",
              "id": "src/routes/inference/inference.ts@830",
              "line": 19,
              "modules": {},
              "references": [
                {
                  "character": 37,
                  "content": "const USER_PROJECT_ROOT_DIR = path.resolve(
  process.env.FPX_WATCH_DIR ?? process.cwd(),
)",
                  "fileName": "src/constants.ts",
                  "id": "src/constants.ts@120",
                  "line": 4,
                  "modules": {
                    "node:path": [
                      {
                        "import": "path",
                        "importPath": "node:path",
                        "name": "node:path",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 2,
                  "content": "export { expandFunction } from "./expand-function.js"",
                  "fileName": "src/lib/expand-function/index.ts",
                  "id": "src/lib/expand-function/index.ts@11",
                  "line": 1,
                  "modules": {},
                  "references": [
                    {
                      "character": 0,
                      "content": "export async function expandFunction(
  projectRoot: string,
  compiledFunction: string,
  options: ExpandFunctionOptions = {},
): Promise<ExpandedFunctionResult | null> {
  const searchResult = await searchFunction(
    projectRoot,
    compiledFunction,
    options,
  );
  if (!searchResult) {
    const truncatedFunc = compiledFunction.slice(0, 100);
    logger.warn(
      \`[expandFunction] No search result found for \${truncatedFunc}...\`,
    );
    return null;
  }

  const identifiers = analyzeOutOfScopeIdentifiers(
    searchResult.node,
    searchResult.sourceFile,
  );

  const context = await extractContext(
    projectRoot,
    searchResult.file,
    identifiers,
  );

  return {
    ...searchResult,
    context,
  };
}",
                      "fileName": "src/lib/expand-function/expand-function.ts",
                      "id": "src/lib/expand-function/expand-function.ts@4200",
                      "line": 111,
                      "modules": {},
                      "references": [
                        {
                          "character": 0,
                          "content": "type ExpandFunctionOptions = {
  skipSourceMap?: boolean;
  debug?: boolean;
  hints?: { sourceFunction?: string | null; sourceFile?: string | null };
};",
                          "fileName": "src/lib/expand-function/expand-function.ts",
                          "id": "src/lib/expand-function/expand-function.ts@2427",
                          "line": 77,
                          "modules": {},
                          "references": [],
                        },
                        {
                          "character": 0,
                          "content": "export type ExpandedFunctionResult = {
  /** The file in which the function was found */
  file: string;
  /** The line on which the function definition starts */
  startLine: number;
  /** The column on which the function definition starts */
  startColumn: number;
  /** The line on which the function definition ends */
  endLine: number;
  /** The column on which the function definition ends */
  endColumn: number;
  context: ExpandedFunctionContext;
};",
                          "fileName": "src/lib/expand-function/expand-function.ts",
                          "id": "src/lib/expand-function/expand-function.ts@1966",
                          "line": 63,
                          "modules": {},
                          "references": [
                            {
                              "character": 0,
                              "content": "export type ExpandedFunctionContext = Array<ExpandedFunctionContextEntry>;",
                              "fileName": "src/lib/expand-function/expand-function.ts",
                              "id": "src/lib/expand-function/expand-function.ts@1890",
                              "line": 61,
                              "modules": {},
                              "references": [
                                {
                                  "character": 0,
                                  "content": "type ExpandedFunctionContextEntry = {
  /** The name of the constant or utility in the code */
  name: string;
  /**
   * The type of the constant or utility.
   * This will be used to help determine whether or not to recursively comb
   * helper utilities to expand context of their utilities, etc.
   *
   * For now, "unknown" is a placeholder for other ast nodes we do not want to want to expand.
   */
  type: FunctionContextType;
  /** The position of the constant or utility in the code */
  position: { line: number; character: number };
  definition?: {
    uri: string;
    range: {
      start: { line: number; character: number };
      end: { line: number; character: number };
    };
    /** The text of the definition (utility function, constant value, etc.) */
    text: string | undefined;
  };
  /** The package (in node_modules) that the constant or utility is defined in */
  package?: string;
  /**
   * Hurrah for recursive types!
   *
   * The child context of the constant or utility.
   * That is, if the constant or utility is a function,
   * this will contain definitions for any of the function's out-of-scope identifiers.
   */
  context?: ExpandedFunctionContext;
};",
                                  "fileName": "src/lib/expand-function/expand-function.ts",
                                  "id": "src/lib/expand-function/expand-function.ts@692",
                                  "line": 27,
                                  "modules": {},
                                  "references": [
                                    {
                                      "character": 0,
                                      "content": "export type FunctionContextType = "unknown" | "function" | "type" | "variable";",
                                      "fileName": "src/lib/expand-function/types.ts",
                                      "id": "src/lib/expand-function/types.ts@138",
                                      "line": 7,
                                      "modules": {},
                                      "references": [],
                                    },
                                    [Circular],
                                  ],
                                },
                              ],
                            },
                          ],
                        },
                        {
                          "character": 9,
                          "content": "export { searchFunction } from "./search-function.js"",
                          "fileName": "src/lib/expand-function/search-function/index.ts",
                          "id": "src/lib/expand-function/search-function/index.ts@9",
                          "line": 0,
                          "modules": {},
                          "references": [
                            {
                              "character": 0,
                              "content": "export async function searchFunction(
  projectPath: string,
  functionString: string,
  options: SearchFunctionOptions = {},
): Promise<SearchFunctionResult | null> {
  const debug = options.debug || false;

  // HACK - Allows us to run tests without source maps
  if (options.skipSourceMap) {
    // Attempt to search the function directly in the source.
    const searchString = options.hints?.sourceFunction ?? functionString;
    try {
      const directResult = await searchSourceFunction(
        projectPath,
        searchString,
        {
          debug,
          hints: {
            sourceFile: options.hints?.sourceFile ?? undefined,
          },
        },
      );
      if (directResult) {
        return directResult;
      }
    } catch (error) {
      logger.error(\`Error searching for function directly in source: \${error}\`);
    }
    return null;
  }

  // Attempt to retrieve the source function text via a source map and search.
  try {
    const sourceFunction = await getSourceFunctionText(
      projectPath,
      functionString,
    );
    if (sourceFunction?.text) {
      if (debug) {
        logger.debug(
          \`[searchFunction] Searching for function via source mapping: \${sourceFunction}\`,
        );
      }
      try {
        const mappedResult = await searchSourceFunction(
          projectPath,
          sourceFunction?.text,
          {
            hints: {
              sourceFile: sourceFunction?.sourceFile ?? undefined,
            },
          },
        );
        if (mappedResult) {
          return mappedResult;
        }
        if (debug) {
          logger.debug(
            "no mapped result found for source function",
            sourceFunction,
          );
        }
      } catch (error) {
        logger.error(
          \`Error searching for function via source mapping: \${error}\`,
        );
      }
    }
  } catch (error) {
    logger.error(\`Error retrieving source function text: \${error}\`);
  }

  // If the function was not found in either search, return null.
  return null;
}",
                              "fileName": "src/lib/expand-function/search-function/search-function.ts",
                              "id": "src/lib/expand-function/search-function/search-function.ts@1194",
                              "line": 28,
                              "modules": {},
                              "references": [
                                {
                                  "character": 0,
                                  "content": "type SearchFunctionOptions = {
  skipSourceMap?: boolean;
  debug?: boolean;
  hints?: { sourceFunction?: string | null; sourceFile?: string | null };
};",
                                  "fileName": "src/lib/expand-function/search-function/search-function.ts",
                                  "id": "src/lib/expand-function/search-function/search-function.ts@243",
                                  "line": 5,
                                  "modules": {},
                                  "references": [],
                                },
                                {
                                  "character": 0,
                                  "content": "export type SearchFunctionResult = {
  /** The file in which the function was found */
  file: string;
  /** The line on which the function definition starts */
  startLine: number;
  /** The column on which the function definition starts */
  startColumn: number;
  /** The line on which the function definition ends */
  endLine: number;
  /** The column on which the function definition ends */
  endColumn: number;

  /** The node that was found */
  node: FunctionNode;
  /** The source file that was found */
  sourceFile: ts.SourceFile;
};",
                                  "fileName": "src/lib/expand-function/search-function/search-file.ts",
                                  "id": "src/lib/expand-function/search-function/search-file.ts@156",
                                  "line": 5,
                                  "modules": {
                                    "typescript": [
                                      {
                                        "import": "ts",
                                        "importPath": "typescript",
                                        "name": "typescript",
                                        "version": "5.6.2",
                                      },
                                    ],
                                  },
                                  "references": [
                                    {
                                      "character": 0,
                                      "content": "export type FunctionNode =
  | ts.FunctionDeclaration
  | ts.ArrowFunction
  | ts.FunctionExpression;",
                                      "fileName": "src/lib/expand-function/types.ts",
                                      "id": "src/lib/expand-function/types.ts@35",
                                      "line": 2,
                                      "modules": {
                                        "typescript": [
                                          {
                                            "import": "ts",
                                            "importPath": "typescript",
                                            "name": "typescript",
                                            "version": "5.6.2",
                                          },
                                        ],
                                      },
                                      "references": [],
                                    },
                                  ],
                                },
                              ],
                            },
                          ],
                        },
                        {
                          "character": 0,
                          "content": "async function extractContext(
  projectRoot: string,
  filePath: string,
  identifiers: OutOfScopeIdentifier[],
  options: { debug?: boolean } = { debug: false },
): Promise<ExpandedFunctionContext> {
  const { debug } = options;
  const context: ExpandedFunctionContext = [];

  if (!identifiers?.length) {
    if (debug) {
      logger.debug(
        "[debug] No out of scope identifiers found in function, skipping context extraction",
      );
    }
    return context;
  }

  try {
    const { connection } = await getTSServer(projectRoot);

    // Open the document containing the function
    // This makes the TSServer aware of the codebase, and allows us to execute requests
    // We do this to get more information on the definitions of the function's out-of-scope identifiers
    //
    await openFile(connection, filePath);

    const funcFileUri = getFileUri(filePath);

    // Loop through each identifier in the function and find its definition
    for (const identifier of identifiers) {
      const [sourceDefinition, textDocumentDefinition] = await Promise.all([
        getTsSourceDefinition(connection, funcFileUri, identifier.position),
        getTextDocumentDefinition(connection, funcFileUri, identifier.position),
        getDiagnostics(connection, funcFileUri),
      ]);

      // Here we can filter out standard globals that are defined in the runtime
      //   (e.g., \`console\`, \`URL\`, \`Number\`, etc.)
      // We can do this because the textDocumentDefinition will be a .d.ts file, while the sourceDefinition will not be present
      // This is a bit of a hack, but it works for now
      const isStandardGlobal =
        !sourceDefinition && textDocumentDefinition?.uri?.endsWith(".d.ts");
      if (isStandardGlobal) {
        if (debug) {
          logger.debug(
            \`[debug] Skipping expansion of \${identifier.name} as it is likely a standard global in the runtime\`,
          );
        }
        continue;
      }

      if (sourceDefinition) {
        // Find the node at the definition position
        const { node, sourceFile, definitionFilePath } =
          definitionToNode(sourceDefinition);

        // If there's a node, we can try to extract the value of the definition
        if (node) {
          // First, handle the case where it was imported from another file.
          // As of writing, we will hit this case when you do \`import * as schema from "./db"\`
          //
          const parentImportDeclaration = getParentImportDeclaration(node);
          if (
            parentImportDeclaration &&
            ts.isImportDeclaration(parentImportDeclaration)
          ) {
            const importClause = parentImportDeclaration.importClause;

            // Check if it's a namespace import (e.g., import * as schema from "./db")
            if (
              importClause?.namedBindings &&
              ts.isNamespaceImport(importClause.namedBindings)
            ) {
              const namespaceName = importClause.namedBindings.name.text;
              const moduleSpecifier = parentImportDeclaration.moduleSpecifier
                .getText()
                .replace(/['"]/g, "");

              // Resolve the imported module's file path using a utility that can account for TypeScript path aliases
              const importedFilePath = resolveModulePath(
                moduleSpecifier,
                filePath,
                projectRoot,
              );

              if (!importedFilePath) {
                logger.warn(
                  \`[extractContext] Failed to resolve imported file path for \${identifier.name}\`,
                );
                continue;
              }

              // Read the contents of the imported file
              let importedFileContent: string;
              try {
                importedFileContent = await fs.promises.readFile(
                  importedFilePath,
                  "utf-8",
                );
              } catch (readError) {
                logger.warn(
                  \`[extractContext] Failed to read imported file at \${importedFilePath} for namespace import \${namespaceName}\`,
                  readError,
                );
                continue;
              }

              // Create a context entry with the entire file's contents
              const contextEntry: ExpandedFunctionContextEntry = {
                name: namespaceName,
                type: "unknown",
                position: identifier.position,
                definition: {
                  uri: getFileUri(importedFilePath),
                  range: {
                    start: { line: 0, character: 0 },
                    end: {
                      line: Number.MAX_SAFE_INTEGER,
                      character: Number.MAX_SAFE_INTEGER,
                    },
                  },
                  text: importedFileContent,
                },
                // Optionally include package information if applicable
                package: extractPackageName(sourceDefinition.uri) ?? undefined,
              };

              context.push(contextEntry);
              continue;
            }

            const contextEntry = await contextForImport(
              connection,
              projectRoot,
              definitionFilePath,
              parentImportDeclaration,
              node,
              identifier,
            );

            // TODO - Recurse definition from imported files (not implemented yet)
            if (contextEntry) {
              context.push(contextEntry);
              continue;
            }

            logger.warn(
              \`[extractContext] Failed to follow import for \${identifier.name}\`,
            );
          }

          // HACK - If we resolved the definition to node_modules,
          //        we can skip any recursive expansion and just add the import as context for now
          if (isDependency(sourceDefinition?.uri)) {
            if (debug) {
              logger.debug(
                \`[debug] \${identifier.name} is likely an installed dependency\`,
              );
            }

            const contextEntry: ExpandedFunctionContextEntry = {
              name: identifier.name,
              // HACK - \`unknown\` just means "do not expand this"
              type: "unknown",
              position: identifier.position,
              definition: {
                uri: sourceDefinition.uri,
                range: sourceDefinition.range,
                // NOTE - We do not include definition text here, since it can be huge (since this is from a node_modules package)
                text: "#third-party-library-code",
              },
              package: extractPackageName(sourceDefinition.uri) ?? undefined,
            };
            context.push(contextEntry);
            continue;
          }

          const valueText = getDefinitionText(node, sourceFile);

          const contextEntry: ExpandedFunctionContextEntry = {
            name: identifier.name,
            type: valueText?.type ?? "unknown",
            position: identifier.position,
            definition: {
              uri: sourceDefinition.uri,
              range: sourceDefinition.range,
              text: valueText?.text,
            },
          };

          if (debug) {
            logger.debug(
              \`[debug] [extractContext] Context entry for \${identifier.name}\`,
              contextEntry,
            );
          }

          // Recursively expand context if the identifier is a function
          if (contextEntry?.type === "function") {
            const functionNode = valueText?.definitionNode ?? node;
            if (!functionNode) {
              logger.warn(
                \`[extractContext] No function body found for \${identifier.name}\`,
              );
              continue;
            }

            // Do type narrowing on the result to appease the call to analyzeOutOfScopeIdentifiers
            if (
              !ts.isFunctionDeclaration(functionNode) &&
              !ts.isArrowFunction(functionNode) &&
              !ts.isFunctionExpression(functionNode)
            ) {
              logger.warn(
                \`[extractContext] An unexpected node was returned for \${identifier.name}\`,
              );
              continue;
            }

            const functionIdentifiers = analyzeOutOfScopeIdentifiers(
              functionNode,
              sourceFile,
            );

            if (debug) {
              logger.debug(
                \`[debug] [extractContext] Analyzed NESTED out of scope identifiers for \${identifier.name}\`,
                functionIdentifiers,
              );
            }

            const subContext = await extractContext(
              projectRoot,
              sourceDefinition.uri.replace(/^file:\\/\\//, ""),
              functionIdentifiers,
            );
            contextEntry.context = subContext;
          }

          context.push(contextEntry);
        } else {
          logger.warn(
            \`[extractContext] AST parsing found no definition found for \${identifier.name} in \${definitionFilePath}\`,
          );
        }
      } else {
        logger.warn(
          \`[extractContext] TSServer found no definition found for \${identifier.name}\`,
        );
        logger.warn(\`[extractContext] Originating file: \${filePath}\`);
      }
    }
  } catch (error) {
    logger.error("[extractContext] Error querying TSServer:", error);
  }

  return context;
}",
                          "fileName": "src/lib/expand-function/expand-function.ts",
                          "id": "src/lib/expand-function/expand-function.ts@6099",
                          "line": 164,
                          "modules": {
                            "node:fs": [
                              {
                                "import": "fs",
                                "importPath": "node:fs",
                                "name": "node:fs",
                              },
                            ],
                            "typescript": [
                              {
                                "import": "ts",
                                "importPath": "typescript",
                                "name": "typescript",
                                "version": "5.6.2",
                              },
                            ],
                          },
                          "references": [
                            {
                              "character": 0,
                              "content": "export type ExpandedFunctionContext = Array<ExpandedFunctionContextEntry>;",
                              "fileName": "src/lib/expand-function/expand-function.ts",
                              "id": "src/lib/expand-function/expand-function.ts@1890",
                              "line": 61,
                              "modules": {},
                              "references": [
                                {
                                  "character": 0,
                                  "content": "type ExpandedFunctionContextEntry = {
  /** The name of the constant or utility in the code */
  name: string;
  /**
   * The type of the constant or utility.
   * This will be used to help determine whether or not to recursively comb
   * helper utilities to expand context of their utilities, etc.
   *
   * For now, "unknown" is a placeholder for other ast nodes we do not want to want to expand.
   */
  type: FunctionContextType;
  /** The position of the constant or utility in the code */
  position: { line: number; character: number };
  definition?: {
    uri: string;
    range: {
      start: { line: number; character: number };
      end: { line: number; character: number };
    };
    /** The text of the definition (utility function, constant value, etc.) */
    text: string | undefined;
  };
  /** The package (in node_modules) that the constant or utility is defined in */
  package?: string;
  /**
   * Hurrah for recursive types!
   *
   * The child context of the constant or utility.
   * That is, if the constant or utility is a function,
   * this will contain definitions for any of the function's out-of-scope identifiers.
   */
  context?: ExpandedFunctionContext;
};",
                                  "fileName": "src/lib/expand-function/expand-function.ts",
                                  "id": "src/lib/expand-function/expand-function.ts@692",
                                  "line": 27,
                                  "modules": {},
                                  "references": [
                                    {
                                      "character": 0,
                                      "content": "export type FunctionContextType = "unknown" | "function" | "type" | "variable";",
                                      "fileName": "src/lib/expand-function/types.ts",
                                      "id": "src/lib/expand-function/types.ts@138",
                                      "line": 7,
                                      "modules": {},
                                      "references": [],
                                    },
                                    [Circular],
                                  ],
                                },
                              ],
                            },
                            {
                              "character": 0,
                              "content": "export type ExpandedFunctionContext = Array<ExpandedFunctionContextEntry>;",
                              "fileName": "src/lib/expand-function/expand-function.ts",
                              "id": "src/lib/expand-function/expand-function.ts@1890",
                              "line": 61,
                              "modules": {},
                              "references": [
                                {
                                  "character": 0,
                                  "content": "type ExpandedFunctionContextEntry = {
  /** The name of the constant or utility in the code */
  name: string;
  /**
   * The type of the constant or utility.
   * This will be used to help determine whether or not to recursively comb
   * helper utilities to expand context of their utilities, etc.
   *
   * For now, "unknown" is a placeholder for other ast nodes we do not want to want to expand.
   */
  type: FunctionContextType;
  /** The position of the constant or utility in the code */
  position: { line: number; character: number };
  definition?: {
    uri: string;
    range: {
      start: { line: number; character: number };
      end: { line: number; character: number };
    };
    /** The text of the definition (utility function, constant value, etc.) */
    text: string | undefined;
  };
  /** The package (in node_modules) that the constant or utility is defined in */
  package?: string;
  /**
   * Hurrah for recursive types!
   *
   * The child context of the constant or utility.
   * That is, if the constant or utility is a function,
   * this will contain definitions for any of the function's out-of-scope identifiers.
   */
  context?: ExpandedFunctionContext;
};",
                                  "fileName": "src/lib/expand-function/expand-function.ts",
                                  "id": "src/lib/expand-function/expand-function.ts@692",
                                  "line": 27,
                                  "modules": {},
                                  "references": [
                                    {
                                      "character": 0,
                                      "content": "export type FunctionContextType = "unknown" | "function" | "type" | "variable";",
                                      "fileName": "src/lib/expand-function/types.ts",
                                      "id": "src/lib/expand-function/types.ts@138",
                                      "line": 7,
                                      "modules": {},
                                      "references": [],
                                    },
                                    [Circular],
                                  ],
                                },
                              ],
                            },
                            {
                              "character": 9,
                              "content": "export { getTSServer } from "./server.js"",
                              "fileName": "src/lib/expand-function/tsserver/index.ts",
                              "id": "src/lib/expand-function/tsserver/index.ts@9",
                              "line": 0,
                              "modules": {},
                              "references": [
                                {
                                  "character": 0,
                                  "content": "export async function getTSServer(pathToProject: string) {
  const resolvedPath = resolve(pathToProject);

  if (tsServerInstance) {
    // logger.debug(
    //   chalk.dim(
    //     \`[debug] Reusing existing TS Server instance for project: \${resolvedPath}\`,
    //   ),
    // );
    return tsServerInstance;
  }

  tsServerInstance = await initializeTSServer(resolvedPath);
  return tsServerInstance;
}",
                                  "fileName": "src/lib/expand-function/tsserver/server.ts",
                                  "id": "src/lib/expand-function/tsserver/server.ts@1410",
                                  "line": 35,
                                  "modules": {
                                    "node:path": [
                                      {
                                        "import": "resolve",
                                        "importPath": "node:path",
                                        "name": "node:path",
                                      },
                                    ],
                                  },
                                  "references": [
                                    {
                                      "character": 4,
                                      "content": "let tsServerInstance: {
  connection: MessageConnection;
  tsServer: ChildProcessWithoutNullStreams;
} | null = null",
                                      "fileName": "src/lib/expand-function/tsserver/server.ts",
                                      "id": "src/lib/expand-function/tsserver/server.ts@906",
                                      "line": 23,
                                      "modules": {
                                        "node:child_process": [
                                          {
                                            "import": "ChildProcessWithoutNullStreams",
                                            "importPath": "node:child_process",
                                            "name": "node:child_process",
                                          },
                                        ],
                                        "vscode-jsonrpc": [
                                          {
                                            "import": "MessageConnection",
                                            "importPath": "vscode-jsonrpc/node.js",
                                            "name": "vscode-jsonrpc",
                                            "version": "8.2.1",
                                          },
                                        ],
                                      },
                                      "references": [],
                                    },
                                    {
                                      "character": 4,
                                      "content": "let tsServerInstance: {
  connection: MessageConnection;
  tsServer: ChildProcessWithoutNullStreams;
} | null = null",
                                      "fileName": "src/lib/expand-function/tsserver/server.ts",
                                      "id": "src/lib/expand-function/tsserver/server.ts@906",
                                      "line": 23,
                                      "modules": {
                                        "node:child_process": [
                                          {
                                            "import": "ChildProcessWithoutNullStreams",
                                            "importPath": "node:child_process",
                                            "name": "node:child_process",
                                          },
                                        ],
                                        "vscode-jsonrpc": [
                                          {
                                            "import": "MessageConnection",
                                            "importPath": "vscode-jsonrpc/node.js",
                                            "name": "vscode-jsonrpc",
                                            "version": "8.2.1",
                                          },
                                        ],
                                      },
                                      "references": [],
                                    },
                                    {
                                      "character": 4,
                                      "content": "let tsServerInstance: {
  connection: MessageConnection;
  tsServer: ChildProcessWithoutNullStreams;
} | null = null",
                                      "fileName": "src/lib/expand-function/tsserver/server.ts",
                                      "id": "src/lib/expand-function/tsserver/server.ts@906",
                                      "line": 23,
                                      "modules": {
                                        "node:child_process": [
                                          {
                                            "import": "ChildProcessWithoutNullStreams",
                                            "importPath": "node:child_process",
                                            "name": "node:child_process",
                                          },
                                        ],
                                        "vscode-jsonrpc": [
                                          {
                                            "import": "MessageConnection",
                                            "importPath": "vscode-jsonrpc/node.js",
                                            "name": "vscode-jsonrpc",
                                            "version": "8.2.1",
                                          },
                                        ],
                                      },
                                      "references": [],
                                    },
                                    {
                                      "character": 0,
                                      "content": "async function initializeTSServer(pathToProject: string) {
  logger.debug(
    chalk.dim(\`[debug] Initializing TS Server for project: \${pathToProject}\`),
  );

  const tsServer = spawn("npx", ["typescript-language-server", "--stdio"], {
    // NOTE - This will add quite a bit of startup time if the user has not yet downloaded typescript-language-server dependency before via npx...
    //        And I haven't tested what that overhead is...
    // NOTE - We *could* run the language server in the project root (via cwd switch), but I think we handle this by initializing the language server
    //        and pointing it to the project root below anyhow.
    // cwd: pathToProject,
    shell: true,
  });

  // Terminate the language server when the Node.js process exits
  process.on("exit", () => {
    logger.debug(
      chalk.dim(
        \`[debug] Terminating TS Server instance for project: \${pathToProject}\`,
      ),
    );
    tsServer.kill();
  });

  // NOTE - Uncomment to debug raw output of ts-language-server
  //
  // tsServer.stdout.on("data", (data) => {
  //   console.log("<TS-SERVER-DATA>")
  //   console.log(\`tsServer stdout: \${data.toString()}\`);
  //   console.log("</TS-SERVER-DATA>")
  // });

  tsServer.stderr.on("data", (data) => {
    logger.error(\`tsserver stderr: \${data.toString()}\`);
  });

  const connection = createMessageConnection(
    new StreamMessageReader(tsServer.stdout),
    new StreamMessageWriter(tsServer.stdin),
  );

  tsServer.stderr.on("data", (data) => {
    logger.error(\`tsserver stderr: \${data.toString()}\`);
  });
  tsServer.stdout.on("data", (data) => {
    logger.info("tsserver stdout:", data.toString());
  });

  // Handle notifications and errors
  connection.onError((error) => logger.error("Connection error:", error));
  connection.onClose(() => logger.info("Connection closed."));
  connection.onUnhandledNotification((notification) =>
    logger.error("Unhandled notification:", notification),
  );

  connection.listen();

  tsServer.on("close", (code) => {
    logger.debug(\`typescript-language-server process exited with code \${code}\`);
  });

  try {
    const rootUri = getFileUri(pathToProject);
    logger.debug(
      chalk.dim(
        \`[debug] Initializing typescript language server with rootUri: \${rootUri}\`,
      ),
    );

    const _response = await connection.sendRequest("initialize", {
      processId: process.pid,
      rootUri: rootUri,
      capabilities: {},
      workspaceFolders: [{ uri: rootUri, name: "app" }],
      initializationOptions: {
        preferences: {
          allowIncompleteCompletions: true,
          includeCompletionsForModuleExports: true,
          includeCompletionsWithInsertText: true,
        },
      },
    });

    logger.debug(chalk.dim("[debug] Initialized typescript language server"));
    // logger.debug('Initialization response:', JSON.stringify(_response, null, 2));

    await connection.sendNotification("initialized");

    registerNotificationHandlers(connection);

    return { connection, tsServer };
  } catch (error) {
    logger.error(chalk.red("Error initializing TS Server:"), error);
    throw error;
  }
}",
                                      "fileName": "src/lib/expand-function/tsserver/server.ts",
                                      "id": "src/lib/expand-function/tsserver/server.ts@1818",
                                      "line": 51,
                                      "modules": {
                                        "chalk": [
                                          {
                                            "import": "chalk",
                                            "importPath": "chalk",
                                            "name": "chalk",
                                            "version": "5.3.0",
                                          },
                                        ],
                                        "node:child_process": [
                                          {
                                            "import": "spawn",
                                            "importPath": "node:child_process",
                                            "name": "node:child_process",
                                          },
                                        ],
                                        "vscode-jsonrpc": [
                                          {
                                            "import": "createMessageConnection",
                                            "importPath": "vscode-jsonrpc/node.js",
                                            "name": "vscode-jsonrpc",
                                            "version": "8.2.1",
                                          },
                                          {
                                            "import": "StreamMessageReader",
                                            "importPath": "vscode-jsonrpc/node.js",
                                            "name": "vscode-jsonrpc",
                                            "version": "8.2.1",
                                          },
                                          {
                                            "import": "StreamMessageWriter",
                                            "importPath": "vscode-jsonrpc/node.js",
                                            "name": "vscode-jsonrpc",
                                            "version": "8.2.1",
                                          },
                                        ],
                                      },
                                      "references": [
                                        {
                                          "character": 0,
                                          "content": "export function getFileUri(filePath: string) {
  if (isFileUri(filePath)) {
    return filePath;
  }
  return \`file://\${escapeFilePath(filePath)}\`;
}",
                                          "fileName": "src/lib/expand-function/tsserver/utils.ts",
                                          "id": "src/lib/expand-function/tsserver/utils.ts@254",
                                          "line": 8,
                                          "modules": {},
                                          "references": [
                                            {
                                              "character": 0,
                                              "content": "function isFileUri(uri: string) {
  return uri.startsWith("file://");
}",
                                              "fileName": "src/lib/expand-function/tsserver/utils.ts",
                                              "id": "src/lib/expand-function/tsserver/utils.ts@602",
                                              "line": 23,
                                              "modules": {},
                                              "references": [],
                                            },
                                            {
                                              "character": 0,
                                              "content": "function escapeFilePath(filePath: string) {
  return filePath.replace(/\\\\/g, "/");
}",
                                              "fileName": "src/lib/expand-function/tsserver/utils.ts",
                                              "id": "src/lib/expand-function/tsserver/utils.ts@516",
                                              "line": 19,
                                              "modules": {},
                                              "references": [],
                                            },
                                          ],
                                        },
                                        {
                                          "character": 0,
                                          "content": "function registerNotificationHandlers(connection: MessageConnection) {
  // Listen for diagnostics
  connection.onNotification("textDocument/publishDiagnostics", (params) => {
    if (!isPublishDiagnosticsParams(params)) {
      logger.debug(
        "[debug] Received unexpected params for \`textDocument/publishDiagnostics\`",
      );
      return;
    }
    const { uri, diagnostics } = params;
    if (diagnostics.length > 0) {
      logger.info(\`[textDocument/publishDiagnostics] Diagnostics for \${uri}:\`);
      for (const diag of diagnostics) {
        logger.info(
          \`- [\${diag.severity}] \${diag.message} at \${diag.range.start.line}:\${diag.range.start.character}\`,
        );
      }
    } else {
      logger.debug(
        \`[textDocument/publishDiagnostics] No diagnostics for \${uri}.\`,
      );
    }
  });

  // Listen for log messages
  connection.onNotification("window/logMessage", (params) => {
    const { type, message } = params;
    logger.info(\`[window/logMessage] Log Message [\${type}]: \${message}\`);
  });

  // Listen for show messages
  connection.onNotification("window/showMessage", (params) => {
    const { type, message } = params;
    logger.info(\`[window/showMessage] Show Message [\${type}]: \${message}\`);
  });
}",
                                          "fileName": "src/lib/expand-function/tsserver/server.ts",
                                          "id": "src/lib/expand-function/tsserver/server.ts@5166",
                                          "line": 153,
                                          "modules": {
                                            "vscode-jsonrpc": [
                                              {
                                                "import": "MessageConnection",
                                                "importPath": "vscode-jsonrpc/node.js",
                                                "name": "vscode-jsonrpc",
                                                "version": "8.2.1",
                                              },
                                            ],
                                          },
                                          "references": [
                                            {
                                              "character": 42,
                                              "content": "(
  data: unknown,
): data is PublishDiagnosticsParams => {
  return PublishDiagnosticsParamsSchema.safeParse(data).success;
}",
                                              "fileName": "src/lib/expand-function/tsserver/types.ts",
                                              "id": "src/lib/expand-function/tsserver/types.ts@1641",
                                              "line": 69,
                                              "modules": {},
                                              "references": [
                                                {
                                                  "character": 0,
                                                  "content": "export type PublishDiagnosticsParams = z.infer<
  typeof PublishDiagnosticsParamsSchema
>;",
                                                  "fileName": "src/lib/expand-function/tsserver/types.ts",
                                                  "id": "src/lib/expand-function/tsserver/types.ts@1507",
                                                  "line": 65,
                                                  "modules": {
                                                    "zod": [
                                                      {
                                                        "import": "z",
                                                        "importPath": "zod",
                                                        "name": "zod",
                                                        "version": "3.23.8",
                                                      },
                                                    ],
                                                  },
                                                  "references": [
                                                    {
                                                      "character": 6,
                                                      "content": "const PublishDiagnosticsParamsSchema = z.object({
  uri: z.string(),
  diagnostics: z.array(DiagnosticSchema),
})",
                                                      "fileName": "src/lib/expand-function/tsserver/types.ts",
                                                      "id": "src/lib/expand-function/tsserver/types.ts@1323",
                                                      "line": 56,
                                                      "modules": {
                                                        "zod": [
                                                          {
                                                            "import": "z",
                                                            "importPath": "zod",
                                                            "name": "zod",
                                                            "version": "3.23.8",
                                                          },
                                                        ],
                                                      },
                                                      "references": [
                                                        {
                                                          "character": 6,
                                                          "content": "const DiagnosticSchema = z.object({
  severity: z.number().optional(),
  message: z.string(),
  range: z.object({
    start: z.object({
      line: z.number(),
      character: z.number(),
    }),
    end: z.object({
      line: z.number(),
      character: z.number(),
    }),
  }),
  source: z.string().optional(),
  code: z.union([z.string(), z.number()]).optional(),
})",
                                                          "fileName": "src/lib/expand-function/tsserver/types.ts",
                                                          "id": "src/lib/expand-function/tsserver/types.ts@947",
                                                          "line": 39,
                                                          "modules": {
                                                            "zod": [
                                                              {
                                                                "import": "z",
                                                                "importPath": "zod",
                                                                "name": "zod",
                                                                "version": "3.23.8",
                                                              },
                                                            ],
                                                          },
                                                          "references": [],
                                                        },
                                                      ],
                                                    },
                                                  ],
                                                },
                                                {
                                                  "character": 6,
                                                  "content": "const PublishDiagnosticsParamsSchema = z.object({
  uri: z.string(),
  diagnostics: z.array(DiagnosticSchema),
})",
                                                  "fileName": "src/lib/expand-function/tsserver/types.ts",
                                                  "id": "src/lib/expand-function/tsserver/types.ts@1323",
                                                  "line": 56,
                                                  "modules": {
                                                    "zod": [
                                                      {
                                                        "import": "z",
                                                        "importPath": "zod",
                                                        "name": "zod",
                                                        "version": "3.23.8",
                                                      },
                                                    ],
                                                  },
                                                  "references": [
                                                    {
                                                      "character": 6,
                                                      "content": "const DiagnosticSchema = z.object({
  severity: z.number().optional(),
  message: z.string(),
  range: z.object({
    start: z.object({
      line: z.number(),
      character: z.number(),
    }),
    end: z.object({
      line: z.number(),
      character: z.number(),
    }),
  }),
  source: z.string().optional(),
  code: z.union([z.string(), z.number()]).optional(),
})",
                                                      "fileName": "src/lib/expand-function/tsserver/types.ts",
                                                      "id": "src/lib/expand-function/tsserver/types.ts@947",
                                                      "line": 39,
                                                      "modules": {
                                                        "zod": [
                                                          {
                                                            "import": "z",
                                                            "importPath": "zod",
                                                            "name": "zod",
                                                            "version": "3.23.8",
                                                          },
                                                        ],
                                                      },
                                                      "references": [],
                                                    },
                                                  ],
                                                },
                                              ],
                                            },
                                          ],
                                        },
                                      ],
                                    },
                                    {
                                      "character": 4,
                                      "content": "let tsServerInstance: {
  connection: MessageConnection;
  tsServer: ChildProcessWithoutNullStreams;
} | null = null",
                                      "fileName": "src/lib/expand-function/tsserver/server.ts",
                                      "id": "src/lib/expand-function/tsserver/server.ts@906",
                                      "line": 23,
                                      "modules": {
                                        "node:child_process": [
                                          {
                                            "import": "ChildProcessWithoutNullStreams",
                                            "importPath": "node:child_process",
                                            "name": "node:child_process",
                                          },
                                        ],
                                        "vscode-jsonrpc": [
                                          {
                                            "import": "MessageConnection",
                                            "importPath": "vscode-jsonrpc/node.js",
                                            "name": "vscode-jsonrpc",
                                            "version": "8.2.1",
                                          },
                                        ],
                                      },
                                      "references": [],
                                    },
                                  ],
                                },
                              ],
                            },
                            {
                              "character": 2,
                              "content": "export { openFile } from "./commands.js"",
                              "fileName": "src/lib/expand-function/tsserver/index.ts",
                              "id": "src/lib/expand-function/tsserver/index.ts@54",
                              "line": 2,
                              "modules": {},
                              "references": [
                                {
                                  "character": 0,
                                  "content": "export async function openFile(
  connection: MessageConnection,
  filePath: string,
) {
  const fileUri = getFileUri(filePath);
  const fileContent = fs.readFileSync(filePath, "utf-8");

  const existingFile = openedFiles.get(filePath);
  if (existingFile && existingFile.content === fileContent) {
    // logger.debug("[debug] [openFile] File already opened:", filePath);
    return;
  }

  const version = (existingFile?.version ?? 0) + 1;

  await connection.sendNotification("textDocument/didOpen", {
    textDocument: {
      uri: fileUri,
      languageId: "typescript",
      version: version,
      text: fileContent,
    },
  });
  openedFiles.set(filePath, { content: fileContent, version });
}",
                                  "fileName": "src/lib/expand-function/tsserver/commands.ts",
                                  "id": "src/lib/expand-function/tsserver/commands.ts@402",
                                  "line": 10,
                                  "modules": {
                                    "node:fs": [
                                      {
                                        "import": "fs",
                                        "importPath": "node:fs",
                                        "name": "node:fs",
                                      },
                                    ],
                                    "vscode-jsonrpc": [
                                      {
                                        "import": "MessageConnection",
                                        "importPath": "vscode-jsonrpc",
                                        "name": "vscode-jsonrpc",
                                        "version": "8.2.1",
                                      },
                                    ],
                                  },
                                  "references": [
                                    {
                                      "character": 6,
                                      "content": "const openedFiles = new Map<string, { content: string; version: number }>()",
                                      "fileName": "src/lib/expand-function/tsserver/commands.ts",
                                      "id": "src/lib/expand-function/tsserver/commands.ts@330",
                                      "line": 8,
                                      "modules": {},
                                      "references": [],
                                    },
                                    {
                                      "character": 6,
                                      "content": "const openedFiles = new Map<string, { content: string; version: number }>()",
                                      "fileName": "src/lib/expand-function/tsserver/commands.ts",
                                      "id": "src/lib/expand-function/tsserver/commands.ts@330",
                                      "line": 8,
                                      "modules": {},
                                      "references": [],
                                    },
                                  ],
                                },
                              ],
                            },
                            {
                              "character": 9,
                              "content": "export { getFileUri } from "./utils.js"",
                              "fileName": "src/lib/expand-function/tsserver/index.ts",
                              "id": "src/lib/expand-function/tsserver/index.ts@197",
                              "line": 7,
                              "modules": {},
                              "references": [
                                {
                                  "character": 0,
                                  "content": "export function getFileUri(filePath: string) {
  if (isFileUri(filePath)) {
    return filePath;
  }
  return \`file://\${escapeFilePath(filePath)}\`;
}",
                                  "fileName": "src/lib/expand-function/tsserver/utils.ts",
                                  "id": "src/lib/expand-function/tsserver/utils.ts@254",
                                  "line": 8,
                                  "modules": {},
                                  "references": [
                                    {
                                      "character": 0,
                                      "content": "function isFileUri(uri: string) {
  return uri.startsWith("file://");
}",
                                      "fileName": "src/lib/expand-function/tsserver/utils.ts",
                                      "id": "src/lib/expand-function/tsserver/utils.ts@602",
                                      "line": 23,
                                      "modules": {},
                                      "references": [],
                                    },
                                    {
                                      "character": 0,
                                      "content": "function escapeFilePath(filePath: string) {
  return filePath.replace(/\\\\/g, "/");
}",
                                      "fileName": "src/lib/expand-function/tsserver/utils.ts",
                                      "id": "src/lib/expand-function/tsserver/utils.ts@516",
                                      "line": 19,
                                      "modules": {},
                                      "references": [],
                                    },
                                  ],
                                },
                              ],
                            },
                            {
                              "character": 2,
                              "content": "export { getTsSourceDefinition } from "./commands.js"",
                              "fileName": "src/lib/expand-function/tsserver/index.ts",
                              "id": "src/lib/expand-function/tsserver/index.ts@95",
                              "line": 4,
                              "modules": {},
                              "references": [
                                {
                                  "character": 0,
                                  "content": "export async function getTsSourceDefinition(
  connection: MessageConnection,
  filePath: string,
  position: ts.LineAndCharacter,
): Promise<Definition | null> {
  const fileUri = getFileUri(filePath);

  const sourceDefinition = await executeCommand(
    connection,
    "_typescript.goToSourceDefinition",
    [fileUri, position],
  );

  // INVESTIGATE - When is definitionResponse longer than 1?
  if (isDefinitionsArray(sourceDefinition)) {
    return sourceDefinition[0] ?? null;
  }

  logger.warn(
    \`[warning] getTsSourceDefinition returned an unexpected, unparseable response: \${sourceDefinition}\`,
  );

  return null;
}",
                                  "fileName": "src/lib/expand-function/tsserver/commands.ts",
                                  "id": "src/lib/expand-function/tsserver/commands.ts@3297",
                                  "line": 102,
                                  "modules": {
                                    "typescript": [
                                      {
                                        "import": "ts",
                                        "importPath": "typescript",
                                        "name": "typescript",
                                        "version": "5.6.2",
                                      },
                                    ],
                                    "vscode-jsonrpc": [
                                      {
                                        "import": "MessageConnection",
                                        "importPath": "vscode-jsonrpc",
                                        "name": "vscode-jsonrpc",
                                        "version": "8.2.1",
                                      },
                                    ],
                                  },
                                  "references": [
                                    {
                                      "character": 0,
                                      "content": "export function getFileUri(filePath: string) {
  if (isFileUri(filePath)) {
    return filePath;
  }
  return \`file://\${escapeFilePath(filePath)}\`;
}",
                                      "fileName": "src/lib/expand-function/tsserver/utils.ts",
                                      "id": "src/lib/expand-function/tsserver/utils.ts@254",
                                      "line": 8,
                                      "modules": {},
                                      "references": [
                                        {
                                          "character": 0,
                                          "content": "function isFileUri(uri: string) {
  return uri.startsWith("file://");
}",
                                          "fileName": "src/lib/expand-function/tsserver/utils.ts",
                                          "id": "src/lib/expand-function/tsserver/utils.ts@602",
                                          "line": 23,
                                          "modules": {},
                                          "references": [],
                                        },
                                        {
                                          "character": 0,
                                          "content": "function escapeFilePath(filePath: string) {
  return filePath.replace(/\\\\/g, "/");
}",
                                          "fileName": "src/lib/expand-function/tsserver/utils.ts",
                                          "id": "src/lib/expand-function/tsserver/utils.ts@516",
                                          "line": 19,
                                          "modules": {},
                                          "references": [],
                                        },
                                      ],
                                    },
                                    {
                                      "character": 0,
                                      "content": "export async function executeCommand(
  connection: MessageConnection,
  command: string,
  args: unknown[],
) {
  try {
    const response = await connection.sendRequest("workspace/executeCommand", {
      command: command,
      arguments: args,
    });
    return response;
  } catch (error) {
    logger.error(
      \`Error with 'workspace/executeCommand' for command: \${command} with args: \${JSON.stringify(args, null, 2)}\`,
      error,
    );
    return null;
  }
}",
                                      "fileName": "src/lib/expand-function/tsserver/commands.ts",
                                      "id": "src/lib/expand-function/tsserver/commands.ts@4334",
                                      "line": 138,
                                      "modules": {
                                        "vscode-jsonrpc": [
                                          {
                                            "import": "MessageConnection",
                                            "importPath": "vscode-jsonrpc",
                                            "name": "vscode-jsonrpc",
                                            "version": "8.2.1",
                                          },
                                        ],
                                      },
                                      "references": [],
                                    },
                                    {
                                      "character": 0,
                                      "content": "export function isDefinitionsArray(data: unknown): data is DefinitionsArray {
  return DefinitionsArraySchema.safeParse(data).success;
}",
                                      "fileName": "src/lib/expand-function/tsserver/types.ts",
                                      "id": "src/lib/expand-function/tsserver/types.ts@749",
                                      "line": 34,
                                      "modules": {},
                                      "references": [
                                        {
                                          "character": 0,
                                          "content": "export type DefinitionsArray = z.infer<typeof DefinitionsArraySchema>;",
                                          "fileName": "src/lib/expand-function/tsserver/types.ts",
                                          "id": "src/lib/expand-function/tsserver/types.ts@484",
                                          "line": 24,
                                          "modules": {
                                            "zod": [
                                              {
                                                "import": "z",
                                                "importPath": "zod",
                                                "name": "zod",
                                                "version": "3.23.8",
                                              },
                                            ],
                                          },
                                          "references": [
                                            {
                                              "character": 13,
                                              "content": "const DefinitionsArraySchema = z.array(DefinitionSchema)",
                                              "fileName": "src/lib/expand-function/tsserver/types.ts",
                                              "id": "src/lib/expand-function/tsserver/types.ts@295",
                                              "line": 17,
                                              "modules": {
                                                "zod": [
                                                  {
                                                    "import": "z",
                                                    "importPath": "zod",
                                                    "name": "zod",
                                                    "version": "3.23.8",
                                                  },
                                                ],
                                              },
                                              "references": [
                                                {
                                                  "character": 6,
                                                  "content": "const DefinitionSchema = z.object({
  uri: z.string().url(),
  range: RangeSchema,
})",
                                                  "fileName": "src/lib/expand-function/tsserver/types.ts",
                                                  "id": "src/lib/expand-function/tsserver/types.ts@200",
                                                  "line": 12,
                                                  "modules": {
                                                    "zod": [
                                                      {
                                                        "import": "z",
                                                        "importPath": "zod",
                                                        "name": "zod",
                                                        "version": "3.23.8",
                                                      },
                                                    ],
                                                  },
                                                  "references": [
                                                    {
                                                      "character": 6,
                                                      "content": "const RangeSchema = z.object({
  start: PositionSchema,
  end: PositionSchema,
})",
                                                      "fileName": "src/lib/expand-function/tsserver/types.ts",
                                                      "id": "src/lib/expand-function/tsserver/types.ts@116",
                                                      "line": 7,
                                                      "modules": {
                                                        "zod": [
                                                          {
                                                            "import": "z",
                                                            "importPath": "zod",
                                                            "name": "zod",
                                                            "version": "3.23.8",
                                                          },
                                                        ],
                                                      },
                                                      "references": [
                                                        {
                                                          "character": 6,
                                                          "content": "const PositionSchema = z.object({
  line: z.number(),
  character: z.number(),
})",
                                                          "fileName": "src/lib/expand-function/tsserver/types.ts",
                                                          "id": "src/lib/expand-function/tsserver/types.ts@32",
                                                          "line": 2,
                                                          "modules": {
                                                            "zod": [
                                                              {
                                                                "import": "z",
                                                                "importPath": "zod",
                                                                "name": "zod",
                                                                "version": "3.23.8",
                                                              },
                                                            ],
                                                          },
                                                          "references": [],
                                                        },
                                                        {
                                                          "character": 6,
                                                          "content": "const PositionSchema = z.object({
  line: z.number(),
  character: z.number(),
})",
                                                          "fileName": "src/lib/expand-function/tsserver/types.ts",
                                                          "id": "src/lib/expand-function/tsserver/types.ts@32",
                                                          "line": 2,
                                                          "modules": {
                                                            "zod": [
                                                              {
                                                                "import": "z",
                                                                "importPath": "zod",
                                                                "name": "zod",
                                                                "version": "3.23.8",
                                                              },
                                                            ],
                                                          },
                                                          "references": [],
                                                        },
                                                      ],
                                                    },
                                                  ],
                                                },
                                              ],
                                            },
                                          ],
                                        },
                                        {
                                          "character": 13,
                                          "content": "const DefinitionsArraySchema = z.array(DefinitionSchema)",
                                          "fileName": "src/lib/expand-function/tsserver/types.ts",
                                          "id": "src/lib/expand-function/tsserver/types.ts@295",
                                          "line": 17,
                                          "modules": {
                                            "zod": [
                                              {
                                                "import": "z",
                                                "importPath": "zod",
                                                "name": "zod",
                                                "version": "3.23.8",
                                              },
                                            ],
                                          },
                                          "references": [
                                            {
                                              "character": 6,
                                              "content": "const DefinitionSchema = z.object({
  uri: z.string().url(),
  range: RangeSchema,
})",
                                              "fileName": "src/lib/expand-function/tsserver/types.ts",
                                              "id": "src/lib/expand-function/tsserver/types.ts@200",
                                              "line": 12,
                                              "modules": {
                                                "zod": [
                                                  {
                                                    "import": "z",
                                                    "importPath": "zod",
                                                    "name": "zod",
                                                    "version": "3.23.8",
                                                  },
                                                ],
                                              },
                                              "references": [
                                                {
                                                  "character": 6,
                                                  "content": "const RangeSchema = z.object({
  start: PositionSchema,
  end: PositionSchema,
})",
                                                  "fileName": "src/lib/expand-function/tsserver/types.ts",
                                                  "id": "src/lib/expand-function/tsserver/types.ts@116",
                                                  "line": 7,
                                                  "modules": {
                                                    "zod": [
                                                      {
                                                        "import": "z",
                                                        "importPath": "zod",
                                                        "name": "zod",
                                                        "version": "3.23.8",
                                                      },
                                                    ],
                                                  },
                                                  "references": [
                                                    {
                                                      "character": 6,
                                                      "content": "const PositionSchema = z.object({
  line: z.number(),
  character: z.number(),
})",
                                                      "fileName": "src/lib/expand-function/tsserver/types.ts",
                                                      "id": "src/lib/expand-function/tsserver/types.ts@32",
                                                      "line": 2,
                                                      "modules": {
                                                        "zod": [
                                                          {
                                                            "import": "z",
                                                            "importPath": "zod",
                                                            "name": "zod",
                                                            "version": "3.23.8",
                                                          },
                                                        ],
                                                      },
                                                      "references": [],
                                                    },
                                                    {
                                                      "character": 6,
                                                      "content": "const PositionSchema = z.object({
  line: z.number(),
  character: z.number(),
})",
                                                      "fileName": "src/lib/expand-function/tsserver/types.ts",
                                                      "id": "src/lib/expand-function/tsserver/types.ts@32",
                                                      "line": 2,
                                                      "modules": {
                                                        "zod": [
                                                          {
                                                            "import": "z",
                                                            "importPath": "zod",
                                                            "name": "zod",
                                                            "version": "3.23.8",
                                                          },
                                                        ],
                                                      },
                                                      "references": [],
                                                    },
                                                  ],
                                                },
                                              ],
                                            },
                                          ],
                                        },
                                      ],
                                    },
                                  ],
                                },
                              ],
                            },
                            {
                              "character": 2,
                              "content": "export { getTextDocumentDefinition } from "./commands.js"",
                              "fileName": "src/lib/expand-function/tsserver/index.ts",
                              "id": "src/lib/expand-function/tsserver/index.ts@66",
                              "line": 3,
                              "modules": {},
                              "references": [],
                            },
                            {
                              "character": 0,
                              "content": "export async function getDiagnostics(
  connection: MessageConnection,
  filePath: string,
) {
  // const fileUri = getFileUri(filePath);

  // connection.d
  // const diagnostics = await connection.sendRequest(
  //   "textDocument/publishDiagnostics",
  //   {
  //     uri: fileUri,
  //   },
  // );
  // console.log("diagnostics", diagnostics);
  // return diagnostics;
  return {};
}",
                              "fileName": "src/lib/expand-function/tsserver/commands.ts",
                              "id": "src/lib/expand-function/tsserver/commands.ts@2125",
                              "line": 70,
                              "modules": {
                                "vscode-jsonrpc": [
                                  {
                                    "import": "MessageConnection",
                                    "importPath": "vscode-jsonrpc",
                                    "name": "vscode-jsonrpc",
                                    "version": "8.2.1",
                                  },
                                ],
                              },
                              "references": [],
                            },
                            {
                              "character": 9,
                              "content": "export { resolveModulePath } from "./resolve-imports.js"",
                              "fileName": "src/lib/expand-function/imports/index.ts",
                              "id": "src/lib/expand-function/imports/index.ts@50",
                              "line": 1,
                              "modules": {},
                              "references": [
                                {
                                  "character": 0,
                                  "content": "export function resolveModulePath(
  moduleSpecifier: string,
  containingFile: string,
  projectRoot: string,
): string | null {
  // Path to tsconfig.json
  const tsconfigPath = ts.findConfigFile(
    projectRoot,
    ts.sys.fileExists,
    "tsconfig.json",
  );

  if (!tsconfigPath) {
    logger.warn(
      \`[resolveModulePath] tsconfig.json not found in project root: \${projectRoot}\`,
    );
    return null;
  }

  // Parse tsconfig.json
  const configFile = ts.readConfigFile(tsconfigPath, ts.sys.readFile);
  if (configFile.error) {
    logger.warn(
      "[resolveModulePath] Error reading tsconfig.json:",
      configFile.error.messageText,
    );
    return null;
  }

  const parsedConfig = ts.parseJsonConfigFileContent(
    configFile.config,
    ts.sys,
    path.dirname(tsconfigPath),
  );

  if (parsedConfig.errors.length > 0) {
    logger.warn(
      "[resolveModulePath] Error parsing tsconfig.json:",
      parsedConfig.errors.map((e) => e.messageText).join(", "),
    );
    return null;
  }

  // Resolve the module name
  const resolvedModule = ts.resolveModuleName(
    moduleSpecifier,
    containingFile,
    parsedConfig.options,
    ts.sys,
  );

  if (resolvedModule.resolvedModule?.resolvedFileName) {
    return resolvedModule.resolvedModule.resolvedFileName;
  }

  logger.warn(
    \`[resolveModulePath] Unable to resolve module: \${moduleSpecifier} from \${containingFile}\`,
  );
  return null;
}",
                                  "fileName": "src/lib/expand-function/imports/resolve-imports.ts",
                                  "id": "src/lib/expand-function/imports/resolve-imports.ts@536",
                                  "line": 12,
                                  "modules": {
                                    "node:path": [
                                      {
                                        "import": "path",
                                        "importPath": "node:path",
                                        "name": "node:path",
                                      },
                                    ],
                                    "typescript": [
                                      {
                                        "import": "ts",
                                        "importPath": "typescript",
                                        "name": "typescript",
                                        "version": "5.6.2",
                                      },
                                    ],
                                  },
                                  "references": [],
                                },
                              ],
                            },
                            {
                              "character": 0,
                              "content": "type ExpandedFunctionContextEntry = {
  /** The name of the constant or utility in the code */
  name: string;
  /**
   * The type of the constant or utility.
   * This will be used to help determine whether or not to recursively comb
   * helper utilities to expand context of their utilities, etc.
   *
   * For now, "unknown" is a placeholder for other ast nodes we do not want to want to expand.
   */
  type: FunctionContextType;
  /** The position of the constant or utility in the code */
  position: { line: number; character: number };
  definition?: {
    uri: string;
    range: {
      start: { line: number; character: number };
      end: { line: number; character: number };
    };
    /** The text of the definition (utility function, constant value, etc.) */
    text: string | undefined;
  };
  /** The package (in node_modules) that the constant or utility is defined in */
  package?: string;
  /**
   * Hurrah for recursive types!
   *
   * The child context of the constant or utility.
   * That is, if the constant or utility is a function,
   * this will contain definitions for any of the function's out-of-scope identifiers.
   */
  context?: ExpandedFunctionContext;
};",
                              "fileName": "src/lib/expand-function/expand-function.ts",
                              "id": "src/lib/expand-function/expand-function.ts@692",
                              "line": 27,
                              "modules": {},
                              "references": [
                                {
                                  "character": 0,
                                  "content": "export type FunctionContextType = "unknown" | "function" | "type" | "variable";",
                                  "fileName": "src/lib/expand-function/types.ts",
                                  "id": "src/lib/expand-function/types.ts@138",
                                  "line": 7,
                                  "modules": {},
                                  "references": [],
                                },
                                {
                                  "character": 0,
                                  "content": "export type ExpandedFunctionContext = Array<ExpandedFunctionContextEntry>;",
                                  "fileName": "src/lib/expand-function/expand-function.ts",
                                  "id": "src/lib/expand-function/expand-function.ts@1890",
                                  "line": 61,
                                  "modules": {},
                                  "references": [
                                    [Circular],
                                  ],
                                },
                              ],
                            },
                            {
                              "character": 9,
                              "content": "export { getFileUri } from "./utils.js"",
                              "fileName": "src/lib/expand-function/tsserver/index.ts",
                              "id": "src/lib/expand-function/tsserver/index.ts@197",
                              "line": 7,
                              "modules": {},
                              "references": [
                                {
                                  "character": 0,
                                  "content": "export function getFileUri(filePath: string) {
  if (isFileUri(filePath)) {
    return filePath;
  }
  return \`file://\${escapeFilePath(filePath)}\`;
}",
                                  "fileName": "src/lib/expand-function/tsserver/utils.ts",
                                  "id": "src/lib/expand-function/tsserver/utils.ts@254",
                                  "line": 8,
                                  "modules": {},
                                  "references": [
                                    {
                                      "character": 0,
                                      "content": "function isFileUri(uri: string) {
  return uri.startsWith("file://");
}",
                                      "fileName": "src/lib/expand-function/tsserver/utils.ts",
                                      "id": "src/lib/expand-function/tsserver/utils.ts@602",
                                      "line": 23,
                                      "modules": {},
                                      "references": [],
                                    },
                                    {
                                      "character": 0,
                                      "content": "function escapeFilePath(filePath: string) {
  return filePath.replace(/\\\\/g, "/");
}",
                                      "fileName": "src/lib/expand-function/tsserver/utils.ts",
                                      "id": "src/lib/expand-function/tsserver/utils.ts@516",
                                      "line": 19,
                                      "modules": {},
                                      "references": [],
                                    },
                                  ],
                                },
                              ],
                            },
                            {
                              "character": 9,
                              "content": "export { extractPackageName } from "./extract-package-name.js"",
                              "fileName": "src/lib/expand-function/imports/index.ts",
                              "id": "src/lib/expand-function/imports/index.ts@108",
                              "line": 2,
                              "modules": {},
                              "references": [],
                            },
                            {
                              "character": 9,
                              "content": "export { isDependency } from "./is-dependency.js"",
                              "fileName": "src/lib/expand-function/imports/index.ts",
                              "id": "src/lib/expand-function/imports/index.ts@172",
                              "line": 3,
                              "modules": {},
                              "references": [],
                            },
                            {
                              "character": 0,
                              "content": "type ExpandedFunctionContextEntry = {
  /** The name of the constant or utility in the code */
  name: string;
  /**
   * The type of the constant or utility.
   * This will be used to help determine whether or not to recursively comb
   * helper utilities to expand context of their utilities, etc.
   *
   * For now, "unknown" is a placeholder for other ast nodes we do not want to want to expand.
   */
  type: FunctionContextType;
  /** The position of the constant or utility in the code */
  position: { line: number; character: number };
  definition?: {
    uri: string;
    range: {
      start: { line: number; character: number };
      end: { line: number; character: number };
    };
    /** The text of the definition (utility function, constant value, etc.) */
    text: string | undefined;
  };
  /** The package (in node_modules) that the constant or utility is defined in */
  package?: string;
  /**
   * Hurrah for recursive types!
   *
   * The child context of the constant or utility.
   * That is, if the constant or utility is a function,
   * this will contain definitions for any of the function's out-of-scope identifiers.
   */
  context?: ExpandedFunctionContext;
};",
                              "fileName": "src/lib/expand-function/expand-function.ts",
                              "id": "src/lib/expand-function/expand-function.ts@692",
                              "line": 27,
                              "modules": {},
                              "references": [
                                {
                                  "character": 0,
                                  "content": "export type FunctionContextType = "unknown" | "function" | "type" | "variable";",
                                  "fileName": "src/lib/expand-function/types.ts",
                                  "id": "src/lib/expand-function/types.ts@138",
                                  "line": 7,
                                  "modules": {},
                                  "references": [],
                                },
                                {
                                  "character": 0,
                                  "content": "export type ExpandedFunctionContext = Array<ExpandedFunctionContextEntry>;",
                                  "fileName": "src/lib/expand-function/expand-function.ts",
                                  "id": "src/lib/expand-function/expand-function.ts@1890",
                                  "line": 61,
                                  "modules": {},
                                  "references": [
                                    [Circular],
                                  ],
                                },
                              ],
                            },
                            {
                              "character": 9,
                              "content": "export { extractPackageName } from "./extract-package-name.js"",
                              "fileName": "src/lib/expand-function/imports/index.ts",
                              "id": "src/lib/expand-function/imports/index.ts@108",
                              "line": 2,
                              "modules": {},
                              "references": [],
                            },
                            {
                              "character": 0,
                              "content": "type ExpandedFunctionContextEntry = {
  /** The name of the constant or utility in the code */
  name: string;
  /**
   * The type of the constant or utility.
   * This will be used to help determine whether or not to recursively comb
   * helper utilities to expand context of their utilities, etc.
   *
   * For now, "unknown" is a placeholder for other ast nodes we do not want to want to expand.
   */
  type: FunctionContextType;
  /** The position of the constant or utility in the code */
  position: { line: number; character: number };
  definition?: {
    uri: string;
    range: {
      start: { line: number; character: number };
      end: { line: number; character: number };
    };
    /** The text of the definition (utility function, constant value, etc.) */
    text: string | undefined;
  };
  /** The package (in node_modules) that the constant or utility is defined in */
  package?: string;
  /**
   * Hurrah for recursive types!
   *
   * The child context of the constant or utility.
   * That is, if the constant or utility is a function,
   * this will contain definitions for any of the function's out-of-scope identifiers.
   */
  context?: ExpandedFunctionContext;
};",
                              "fileName": "src/lib/expand-function/expand-function.ts",
                              "id": "src/lib/expand-function/expand-function.ts@692",
                              "line": 27,
                              "modules": {},
                              "references": [
                                {
                                  "character": 0,
                                  "content": "export type FunctionContextType = "unknown" | "function" | "type" | "variable";",
                                  "fileName": "src/lib/expand-function/types.ts",
                                  "id": "src/lib/expand-function/types.ts@138",
                                  "line": 7,
                                  "modules": {},
                                  "references": [],
                                },
                                {
                                  "character": 0,
                                  "content": "export type ExpandedFunctionContext = Array<ExpandedFunctionContextEntry>;",
                                  "fileName": "src/lib/expand-function/expand-function.ts",
                                  "id": "src/lib/expand-function/expand-function.ts@1890",
                                  "line": 61,
                                  "modules": {},
                                  "references": [
                                    [Circular],
                                  ],
                                },
                              ],
                            },
                          ],
                        },
                      ],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/inference/inference.ts@1427",
          "method": "post",
          "path": "/v0/generate-request",
          "sources": [
            {
              "character": 2,
              "content": "cors()",
              "fileName": "src/routes/inference/inference.ts",
              "id": "src/routes/inference/inference.ts@1465",
              "line": 47,
              "modules": {
                "hono": [
                  {
                    "import": "cors",
                    "importPath": "hono/cors",
                    "name": "hono",
                    "version": "4.6.2",
                  },
                ],
              },
              "references": [],
            },
            {
              "character": 2,
              "content": "zValidator("json", generateRequestSchema)",
              "fileName": "src/routes/inference/inference.ts",
              "id": "src/routes/inference/inference.ts@1475",
              "line": 48,
              "modules": {
                "@hono/zod-validator": [
                  {
                    "import": "zValidator",
                    "importPath": "@hono/zod-validator",
                    "name": "@hono/zod-validator",
                    "version": "0.2.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 6,
                  "content": "const generateRequestSchema = z.object({
  handler: z.string(),
  method: z.string(),
  path: z.string(),
  history: z.array(z.string()).nullish(),
  persona: z.string(),
  openApiSpec: z.string().nullish(),
  middleware: z
    .array(
      z.object({
        handler: z.string(),
        method: z.string(),
        path: z.string(),
      }),
    )
    .nullish(),
})",
                  "fileName": "src/routes/inference/inference.ts",
                  "id": "src/routes/inference/inference.ts@1060",
                  "line": 27,
                  "modules": {
                    "zod": [
                      {
                        "import": "z",
                        "importPath": "zod",
                        "name": "zod",
                        "version": "3.23.8",
                      },
                    ],
                  },
                  "references": [],
                },
              ],
            },
            {
              "character": 2,
              "content": "async (ctx) => {
    const { handler, method, path, history, persona, openApiSpec, middleware } =
      ctx.req.valid("json");

    const db = ctx.get("db");
    const inferenceConfig = await getInferenceConfig(db);

    if (!inferenceConfig) {
      return ctx.json(
        {
          message: "No inference configuration found",
        },
        403,
      );
    }

    const provider = inferenceConfig.aiProvider;

    // Expand out of scope identifiers in the handler function, to add as additional context
    //
    // Uncomment console.time to see how long this takes
    // It should be slow on the first request, but fast-ish on subsequent requests
    //
    // console.time("Handler and Middleware Expansion");
    const [handlerContextPerformant, middlewareContextPerformant] =
      // HACK - Ditch the expand handler for ollama for now, it overwhelms llama 3.1-8b
      provider !== "ollama"
        ? await expandHandler(handler, middleware ?? []).catch((error) => {
            logger.error(\`Error expanding handler and middleware: \${error}\`);
            return [null, null];
          })
        : [null, null];
    // console.timeEnd("Handler and Middleware Expansion");

    // HACK - Get latest token from db
    const [token] = await db
      .select()
      .from(schema.tokens)
      .orderBy(desc(schema.tokens.createdAt))
      .limit(1);

    // Generate the request
    const { data: parsedArgs, error: generateError } =
      await generateRequestWithAiProvider({
        fpApiKey: token?.value,
        inferenceConfig,
        persona,
        method,
        path,
        handler,
        handlerContext: handlerContextPerformant ?? undefined,
        history: history ?? undefined,
        openApiSpec: openApiSpec ?? undefined,
        middleware: middleware ?? undefined,
        middlewareContext: middlewareContextPerformant ?? undefined,
      });

    if (generateError) {
      return ctx.json({ message: generateError.message }, 500);
    }

    return ctx.json({
      request: parsedArgs,
    });
  }",
              "fileName": "src/routes/inference/inference.ts",
              "id": "src/routes/inference/inference.ts@1520",
              "line": 49,
              "modules": {
                "drizzle-orm": [
                  {
                    "import": "desc",
                    "importPath": "drizzle-orm",
                    "name": "drizzle-orm",
                    "version": "0.33.0",
                  },
                ],
              },
              "references": [],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
      ],
      "fileName": "src/routes/inference/inference.ts",
      "id": "src/routes/inference/inference.ts@647",
      "name": "app",
    },
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "src/routes/settings.ts@401",
          "method": "get",
          "path": "/v0/settings",
          "sources": [
            {
              "character": 24,
              "content": "cors()",
              "fileName": "src/routes/settings.ts",
              "id": "src/routes/settings.ts@425",
              "line": 12,
              "modules": {
                "hono": [
                  {
                    "import": "cors",
                    "importPath": "hono/cors",
                    "name": "hono",
                    "version": "4.6.2",
                  },
                ],
              },
              "references": [],
            },
            {
              "character": 32,
              "content": "async (ctx) => {
  const db = ctx.get("db");
  const settingsRecord = await getAllSettings(db);
  return ctx.json(settingsRecord);
}",
              "fileName": "src/routes/settings.ts",
              "id": "src/routes/settings.ts@433",
              "line": 12,
              "modules": {},
              "references": [
                {
                  "character": 0,
                  "content": "export async function getAllSettings(
  db: LibSQLDatabase<typeof schema>,
): Promise<Settings> {
  const results = await db.query.settings.findMany();

  const mappedToSchema = results.reduce<Record<string, string>>(
    (acc, setting) => {
      acc[setting.key] = setting.value
        ? safeParseJson(setting.value)
        : undefined;
      return acc;
    },
    {},
  );

  return SettingsSchema.parse(mappedToSchema);
}",
                  "fileName": "src/lib/settings/index.ts",
                  "id": "src/lib/settings/index.ts@1609",
                  "line": 68,
                  "modules": {
                    "@fiberplane/fpx-types": [
                      {
                        "import": "Settings",
                        "importPath": "@fiberplane/fpx-types",
                        "name": "@fiberplane/fpx-types",
                        "version": "0.0.9",
                      },
                      {
                        "import": "SettingsSchema",
                        "importPath": "@fiberplane/fpx-types",
                        "name": "@fiberplane/fpx-types",
                        "version": "0.0.9",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "LibSQLDatabase",
                        "importPath": "drizzle-orm/libsql",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 0,
                      "content": "export function safeParseJson(str: string | null | undefined) {
  if (!str) {
    return null;
  }
  try {
    return JSON.parse(str);
  } catch {
    return str;
  }
}",
                      "fileName": "src/lib/utils.ts",
                      "id": "src/lib/utils.ts@3106",
                      "line": 112,
                      "modules": {},
                      "references": [],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/settings.ts@698",
          "method": "post",
          "path": "/v0/settings",
          "sources": [
            {
              "character": 25,
              "content": "cors()",
              "fileName": "src/routes/settings.ts",
              "id": "src/routes/settings.ts@723",
              "line": 23,
              "modules": {
                "hono": [
                  {
                    "import": "cors",
                    "importPath": "hono/cors",
                    "name": "hono",
                    "version": "4.6.2",
                  },
                ],
              },
              "references": [],
            },
            {
              "character": 33,
              "content": "async (ctx) => {
  const currentSettings = await getAllSettings(ctx.get("db"));
  const prevProxyUrlEnabled = currentSettings?.proxyRequestsEnabled;

  const { content } = (await ctx.req.json()) as {
    content: Record<string, string>;
  };

  const parsedContent = SettingsSchema.parse(content);
  // Remove the stored api key if the feature is disabled
  // if (!parsedContent.aiEnabled) {
  //   parsedContent.aiProviderConfigurations?.openai?.apiKey = "";
  //   parsedContent.aiProviderConfigurations?.anthropic?.apiKey = "";
  // }

  logger.debug("Updating settings", { content });

  const db = ctx.get("db");
  const webhonc = ctx.get("webhonc");

  const updatedSettings = await upsertSettings(db, parsedContent);

  logger.debug("Configuration updated...");

  // HACK - We should techincally JSON parse the value here, but whatever.
  const proxyUrlEnabled =
    updatedSettings.find((setting) => setting.key === "proxyRequestsEnabled")
      ?.value === "true";

  const shouldStartWebhonc = !prevProxyUrlEnabled && proxyUrlEnabled;
  if (shouldStartWebhonc) {
    logger.debug("Proxy requests enabled in settings update, starting webhonc");
    await webhonc.start();
  }

  const shouldStopWebhonc = prevProxyUrlEnabled && !proxyUrlEnabled;
  if (shouldStopWebhonc) {
    logger.debug(
      "Proxy requests disabled in settings update, stopping webhonc",
    );
    await webhonc.stop();
  }

  return ctx.json(updatedSettings);
}",
              "fileName": "src/routes/settings.ts",
              "id": "src/routes/settings.ts@731",
              "line": 23,
              "modules": {
                "@fiberplane/fpx-types": [
                  {
                    "import": "SettingsSchema",
                    "importPath": "@fiberplane/fpx-types",
                    "name": "@fiberplane/fpx-types",
                    "version": "0.0.9",
                  },
                ],
              },
              "references": [],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
      ],
      "fileName": "src/routes/settings.ts",
      "id": "src/routes/settings.ts@296",
      "name": "app",
    },
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "src/routes/source.ts@435",
          "method": "get",
          "path": "/v0/source",
          "sources": [
            {
              "character": 2,
              "content": "cors()",
              "fileName": "src/routes/source.ts",
              "id": "src/routes/source.ts@462",
              "line": 14,
              "modules": {
                "hono": [
                  {
                    "import": "cors",
                    "importPath": "hono/cors",
                    "name": "hono",
                    "version": "4.6.2",
                  },
                ],
              },
              "references": [],
            },
            {
              "character": 2,
              "content": "zValidator(
    "query",
    z.object({ source: z.string(), line: z.string(), column: z.string() }),
  )",
              "fileName": "src/routes/source.ts",
              "id": "src/routes/source.ts@472",
              "line": 15,
              "modules": {
                "@hono/zod-validator": [
                  {
                    "import": "zValidator",
                    "importPath": "@hono/zod-validator",
                    "name": "@hono/zod-validator",
                    "version": "0.2.2",
                  },
                ],
                "zod": [
                  {
                    "import": "z",
                    "importPath": "zod",
                    "name": "zod",
                    "version": "3.23.8",
                  },
                ],
              },
              "references": [],
            },
            {
              "character": 2,
              "content": "async (ctx) => {
    const { source, line, column } = ctx.req.query();

    try {
      const file = JSON.parse(readFileSync(source, "utf8").toString());
      const consumer = await new SourceMapConsumer(file);
      const pos = consumer.originalPositionFor({
        line: Number.parseInt(line, 10),
        column: Number.parseInt(column, 10),
      });
      consumer.destroy();

      return ctx.json(pos);
    } catch (err) {
      const message = getValueFromObject(err, "message", "Unknown error");
      const name = getValueFromObject(err, "name", "");

      console.error("Could not read source file", message);
      return ctx.json(
        {
          error: "Error reading file",
          name,
          message,
        },
        500,
      );
    }
  }",
              "fileName": "src/routes/source.ts",
              "id": "src/routes/source.ts@580",
              "line": 19,
              "modules": {
                "node:fs": [
                  {
                    "import": "readFileSync",
                    "importPath": "node:fs",
                    "name": "node:fs",
                  },
                ],
                "source-map": [
                  {
                    "import": "SourceMapConsumer",
                    "importPath": "source-map",
                    "name": "source-map",
                    "version": "0.7.4",
                  },
                ],
              },
              "references": [
                {
                  "character": 0,
                  "content": "function getValueFromObject<T>(
  element: unknown,
  key: string,
  defaultValue: T,
): T {
  if (typeof element === "object" && element !== null && key in element) {
    const value = (element as Record<string, unknown>)[key];
    // Rough check to see if the type of the value is the same as the default value
    if (typeof value === typeof defaultValue || value === defaultValue) {
      return (element as Record<string, unknown>)[key] as T;
    }
  }

  return defaultValue;
}",
                  "fileName": "src/routes/source.ts",
                  "id": "src/routes/source.ts@1969",
                  "line": 73,
                  "modules": {},
                  "references": [],
                },
                {
                  "character": 0,
                  "content": "function getValueFromObject<T>(
  element: unknown,
  key: string,
  defaultValue: T,
): T {
  if (typeof element === "object" && element !== null && key in element) {
    const value = (element as Record<string, unknown>)[key];
    // Rough check to see if the type of the value is the same as the default value
    if (typeof value === typeof defaultValue || value === defaultValue) {
      return (element as Record<string, unknown>)[key] as T;
    }
  }

  return defaultValue;
}",
                  "fileName": "src/routes/source.ts",
                  "id": "src/routes/source.ts@1969",
                  "line": 73,
                  "modules": {},
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/source.ts@1359",
          "method": "post",
          "path": "/v0/source-function",
          "sources": [
            {
              "character": 32,
              "content": "cors()",
              "fileName": "src/routes/source.ts",
              "id": "src/routes/source.ts@1391",
              "line": 49,
              "modules": {
                "hono": [
                  {
                    "import": "cors",
                    "importPath": "hono/cors",
                    "name": "hono",
                    "version": "4.6.2",
                  },
                ],
              },
              "references": [],
            },
            {
              "character": 40,
              "content": "async (ctx) => {
  const { handler, source } = ctx.req.query();

  try {
    const result = await findSourceFunctions(source, handler);
    return ctx.json({
      functionText: result?.[0]?.sourceFunction ?? null,
    });
  } catch (err) {
    console.error("Could not find function in source", source);
    const message = getValueFromObject(err, "message", "Unknown error");
    const name = getValueFromObject(err, "name", "");

    return ctx.json(
      {
        error: "Error finding function",
        name,
        message,
      },
      500,
    );
  }
}",
              "fileName": "src/routes/source.ts",
              "id": "src/routes/source.ts@1399",
              "line": 49,
              "modules": {},
              "references": [
                {
                  "character": 2,
                  "content": "export { findSourceFunctions } from "./find-source-function.js"",
                  "fileName": "src/lib/find-source-function/index.ts",
                  "id": "src/lib/find-source-function/index.ts@11",
                  "line": 1,
                  "modules": {},
                  "references": [
                    {
                      "character": 0,
                      "content": "export async function findSourceFunctions(
  jsFilePath: string,
  compiledFunctionText: string | Array<string>,
  returnNullOnMissing = false,
  hints: {
    sourceMapContent?: RawSourceMap | RawIndexMap;
    jsFileContents?: string;
  } = {},
): Promise<Array<SourceFunctionResult>> {
  const mapFile = \`\${jsFilePath}.map\`;
  // OPTIMIZE - This is a hot path, so we should cache the source map content
  //            Each parse takes about 10ms even on a medium sized codebase
  const sourceMapContent =
    hints.sourceMapContent ??
    JSON.parse(await readFileAsync(mapFile, { encoding: "utf8" }));
  const jsFileContents =
    hints.jsFileContents ??
    (await readFileAsync(jsFilePath, { encoding: "utf8" }));

  const functionDefinitions = Array.isArray(compiledFunctionText)
    ? compiledFunctionText
    : [compiledFunctionText];

  const locations = await findFunctionsByDefinition(
    jsFileContents,
    functionDefinitions,
  );

  const results = await Promise.all(
    Object.entries(locations).map(
      async ([compiledFunctionText, { foundLocation }]) => {
        if (!foundLocation) {
          return {
            functionText: compiledFunctionText,
            sourceFile: null,
            sourceFunction: null,
          };
        }
        const lookupResult = await lookUpLocation(foundLocation);
        return {
          functionText: compiledFunctionText,
          sourceFile: lookupResult?.sourceFile ?? null,
          sourceFunction: lookupResult?.sourceFunction ?? null,
        };
      },
    ),
  );

  return results;

  /**
   * Looks up the original source function based on a function's location in the compiled code.
   *
   * @param {FunctionLocation} loc - The location of the function in the compiled JavaScript file.
   * @returns {Promise<{ sourceFunction: string | null; source: string | null } | null>}
   *          A promise that resolves to the original source function and its source file, or null if not found.
   */
  async function lookUpLocation(loc: FunctionLocation) {
    const functionStartLine = loc?.startLine ?? 0;
    const functionStartColumn = loc?.startColumn ?? 0;
    const functionEndLine = loc?.endLine ?? 0;
    const functionEndColumn = loc?.endColumn ?? 0;

    // NOTE - We want to execute these in parallel, time is of the essence
    const [sourceFunctionStart, sourceFunctionEnd] = await Promise.all([
      findOriginalSource(
        sourceMapContent,
        functionStartLine,
        functionStartColumn,
      ),
      findOriginalSource(sourceMapContent, functionEndLine, functionEndColumn),
    ]);

    const sourceFile = sourceFunctionStart.source;
    const sourceContent = sourceFunctionStart.sourceContent ?? "";
    const startLine = sourceFunctionStart.line;
    const startColumn = sourceFunctionStart.column;
    const endLine = sourceFunctionEnd.line;
    const endColumn = sourceFunctionEnd.column;
    // Check if the start/end line are null and otherwise just return sourceContent as is
    if (startLine === null || endLine === null) {
      // TODO decide what the proper behavior should be when
      // we can't find the correct source content.
      // For now: return the source content as is
      return returnNullOnMissing
        ? null
        : { sourceContent, sourceFile, sourceFunction: null };
    }

    const lines = sourceContent.split("\\n").slice(startLine - 1, endLine);

    const sourceFunction = lines
      .map((line, index) => {
        if (index === 0 && startLine === endLine) {
          return line.slice(startColumn ?? 0, endColumn ?? 0);
        }
        if (index === 0) {
          const sliceFrom = startColumn ?? 0;
          return line.slice(sliceFrom);
        }
        if (index === endLine - startLine) {
          // MEGA HACK - Add 1 to the end column only if it ends in a comma
          // I don't know what was causing this issue, but when we parse the source code,
          // we need to account for the fact that the original source code might have
          // trailing commas in functions that are passed as arguments to other functions.
          // In that case, we need to add 1 to the end column to account for something that gets odd when receiving the location back.
          const endsInComma = line.endsWith(",");
          const sliceTo = (endColumn ?? 0) + (endsInComma ? 1 : 0);
          return line.slice(0, sliceTo);
        }
        return line;
      })
      .join("\\n");

    return { sourceFunction, sourceFile };
  }
}",
                      "fileName": "src/lib/find-source-function/find-source-function.ts",
                      "id": "src/lib/find-source-function/find-source-function.ts@6246",
                      "line": 180,
                      "modules": {
                        "source-map": [
                          {
                            "import": "RawSourceMap",
                            "importPath": "source-map",
                            "name": "source-map",
                            "version": "0.7.4",
                          },
                          {
                            "import": "RawIndexMap",
                            "importPath": "source-map",
                            "name": "source-map",
                            "version": "0.7.4",
                          },
                        ],
                      },
                      "references": [
                        {
                          "character": 0,
                          "content": "export type SourceFunctionResult = {
  /** The (compiled) function text that was used to find the source */
  functionText: string;
  /** The source file */
  sourceFile: string | null;
  /** The source code of the function */
  sourceFunction: string | null;
};",
                          "fileName": "src/lib/find-source-function/find-source-function.ts",
                          "id": "src/lib/find-source-function/find-source-function.ts@5142",
                          "line": 160,
                          "modules": {},
                          "references": [],
                        },
                        {
                          "character": 6,
                          "content": "const readFileAsync = promisify(fs.readFile)",
                          "fileName": "src/lib/find-source-function/find-source-function.ts",
                          "id": "src/lib/find-source-function/find-source-function.ts@284",
                          "line": 11,
                          "modules": {
                            "node:fs": [
                              {
                                "import": "fs",
                                "importPath": "node:fs",
                                "name": "node:fs",
                              },
                            ],
                            "node:util": [
                              {
                                "import": "promisify",
                                "importPath": "node:util",
                                "name": "node:util",
                              },
                            ],
                          },
                          "references": [],
                        },
                        {
                          "character": 6,
                          "content": "const readFileAsync = promisify(fs.readFile)",
                          "fileName": "src/lib/find-source-function/find-source-function.ts",
                          "id": "src/lib/find-source-function/find-source-function.ts@284",
                          "line": 11,
                          "modules": {
                            "node:fs": [
                              {
                                "import": "fs",
                                "importPath": "node:fs",
                                "name": "node:fs",
                              },
                            ],
                            "node:util": [
                              {
                                "import": "promisify",
                                "importPath": "node:util",
                                "name": "node:util",
                              },
                            ],
                          },
                          "references": [],
                        },
                        {
                          "character": 0,
                          "content": "async function findFunctionsByDefinition(
  jsFileContents: string,
  functionDefinitions: Array<string>,
): Promise<
  Record<string, { normalized: string; foundLocation: FunctionLocation | null }>
> {
  try {
    // Create a map of function definitions to their normalized form and foundLocation
    const functionMap = functionDefinitions.reduce(
      (acc, def) => {
        acc[def] = {
          normalized: def.replace(/\\s+/g, " ").trim(),
          foundLocation: null,
        };
        return acc;
      },
      {} as Record<
        string,
        { normalized: string; foundLocation: FunctionLocation | null }
      >,
    );

    const ast = parse(jsFileContents, {
      ecmaVersion: "latest",
      locations: true,
      sourceType: "module",
    });

    walkSimple(ast, {
      FunctionDeclaration(node) {
        for (const key in functionMap) {
          if (functionMap[key].foundLocation) {
            continue;
          }
          const funcSource = jsFileContents.substring(node.start, node.end);
          if (
            node.loc &&
            funcSource.replace(/\\s+/g, " ").trim() ===
              functionMap[key].normalized
          ) {
            functionMap[key].foundLocation = {
              startLine: node.loc.start.line,
              startColumn: node.loc.start.column + 1,
              endLine: node.loc.end.line,
              endColumn: node.loc.end.column + 1,
            };
          }
        }
      },
      FunctionExpression(node) {
        for (const key in functionMap) {
          if (functionMap[key].foundLocation) {
            continue;
          }
          const funcSource = jsFileContents.substring(node.start, node.end);
          if (
            node.loc &&
            funcSource.replace(/\\s+/g, " ").trim() ===
              functionMap[key].normalized
          ) {
            functionMap[key].foundLocation = {
              startLine: node.loc.start.line,
              startColumn: node.loc.start.column + 1,
              endLine: node.loc.end.line,
              endColumn: node.loc.end.column + 1,
            };
          }
        }
      },
      ArrowFunctionExpression(node) {
        for (const key in functionMap) {
          if (functionMap[key].foundLocation) {
            continue;
          }
          const funcSource = jsFileContents.substring(node.start, node.end);
          if (
            node.loc &&
            funcSource.replace(/\\s+/g, " ").trim() ===
              functionMap[key].normalized
          ) {
            functionMap[key].foundLocation = {
              startLine: node.loc.start.line,
              startColumn: node.loc.start.column,
              endLine: node.loc.end.line,
              endColumn: node.loc.end.column,
            };
          }
        }
      },
    });

    return functionMap;
  } catch {
    logger.error("[findFunctionByDefinition] Error parsing js file contents");
    return {};
  }
}",
                          "fileName": "src/lib/find-source-function/find-source-function.ts",
                          "id": "src/lib/find-source-function/find-source-function.ts@955",
                          "line": 28,
                          "modules": {
                            "acorn": [
                              {
                                "import": "parse",
                                "importPath": "acorn",
                                "name": "acorn",
                                "version": "8.12.1",
                              },
                            ],
                            "acorn-walk": [
                              {
                                "import": "walkSimple",
                                "importPath": "acorn-walk",
                                "name": "acorn-walk",
                                "version": "8.3.3",
                              },
                            ],
                          },
                          "references": [
                            {
                              "character": 0,
                              "content": "type FunctionLocation = {
  startLine: number;
  startColumn: number;
  endLine: number;
  endColumn: number;
};",
                              "fileName": "src/lib/find-source-function/find-source-function.ts",
                              "id": "src/lib/find-source-function/find-source-function.ts@325",
                              "line": 13,
                              "modules": {},
                              "references": [],
                            },
                            {
                              "character": 0,
                              "content": "type FunctionLocation = {
  startLine: number;
  startColumn: number;
  endLine: number;
  endColumn: number;
};",
                              "fileName": "src/lib/find-source-function/find-source-function.ts",
                              "id": "src/lib/find-source-function/find-source-function.ts@325",
                              "line": 13,
                              "modules": {},
                              "references": [],
                            },
                          ],
                        },
                        {
                          "character": 0,
                          "content": "type FunctionLocation = {
  startLine: number;
  startColumn: number;
  endLine: number;
  endColumn: number;
};",
                          "fileName": "src/lib/find-source-function/find-source-function.ts",
                          "id": "src/lib/find-source-function/find-source-function.ts@325",
                          "line": 13,
                          "modules": {},
                          "references": [],
                        },
                        {
                          "character": 0,
                          "content": "async function findOriginalSource(
  sourceMapContent: RawSourceMap | RawIndexMap,
  line: number,
  column: number,
) {
  return await SourceMapConsumer.with(sourceMapContent, null, (consumer) => {
    const pos = consumer.originalPositionFor({
      line, // Line number from JS file
      column, // Column number from JS file
    });

    consumer.destroy();

    // Optional: Display the source code snippet if needed
    const returnNullOnMissing = true;
    const sourceContent = consumer.sourceContentFor(
      pos.source ?? "",
      returnNullOnMissing,
    );

    return { ...pos, sourceContent };
  });
}",
                          "fileName": "src/lib/find-source-function/find-source-function.ts",
                          "id": "src/lib/find-source-function/find-source-function.ts@4522",
                          "line": 136,
                          "modules": {
                            "source-map": [
                              {
                                "import": "RawSourceMap",
                                "importPath": "source-map",
                                "name": "source-map",
                                "version": "0.7.4",
                              },
                              {
                                "import": "RawIndexMap",
                                "importPath": "source-map",
                                "name": "source-map",
                                "version": "0.7.4",
                              },
                              {
                                "import": "SourceMapConsumer",
                                "importPath": "source-map",
                                "name": "source-map",
                                "version": "0.7.4",
                              },
                            ],
                          },
                          "references": [],
                        },
                        {
                          "character": 0,
                          "content": "async function findOriginalSource(
  sourceMapContent: RawSourceMap | RawIndexMap,
  line: number,
  column: number,
) {
  return await SourceMapConsumer.with(sourceMapContent, null, (consumer) => {
    const pos = consumer.originalPositionFor({
      line, // Line number from JS file
      column, // Column number from JS file
    });

    consumer.destroy();

    // Optional: Display the source code snippet if needed
    const returnNullOnMissing = true;
    const sourceContent = consumer.sourceContentFor(
      pos.source ?? "",
      returnNullOnMissing,
    );

    return { ...pos, sourceContent };
  });
}",
                          "fileName": "src/lib/find-source-function/find-source-function.ts",
                          "id": "src/lib/find-source-function/find-source-function.ts@4522",
                          "line": 136,
                          "modules": {
                            "source-map": [
                              {
                                "import": "RawSourceMap",
                                "importPath": "source-map",
                                "name": "source-map",
                                "version": "0.7.4",
                              },
                              {
                                "import": "RawIndexMap",
                                "importPath": "source-map",
                                "name": "source-map",
                                "version": "0.7.4",
                              },
                              {
                                "import": "SourceMapConsumer",
                                "importPath": "source-map",
                                "name": "source-map",
                                "version": "0.7.4",
                              },
                            ],
                          },
                          "references": [],
                        },
                      ],
                    },
                  ],
                },
                {
                  "character": 0,
                  "content": "function getValueFromObject<T>(
  element: unknown,
  key: string,
  defaultValue: T,
): T {
  if (typeof element === "object" && element !== null && key in element) {
    const value = (element as Record<string, unknown>)[key];
    // Rough check to see if the type of the value is the same as the default value
    if (typeof value === typeof defaultValue || value === defaultValue) {
      return (element as Record<string, unknown>)[key] as T;
    }
  }

  return defaultValue;
}",
                  "fileName": "src/routes/source.ts",
                  "id": "src/routes/source.ts@1969",
                  "line": 73,
                  "modules": {},
                  "references": [],
                },
                {
                  "character": 0,
                  "content": "function getValueFromObject<T>(
  element: unknown,
  key: string,
  defaultValue: T,
): T {
  if (typeof element === "object" && element !== null && key in element) {
    const value = (element as Record<string, unknown>)[key];
    // Rough check to see if the type of the value is the same as the default value
    if (typeof value === typeof defaultValue || value === defaultValue) {
      return (element as Record<string, unknown>)[key] as T;
    }
  }

  return defaultValue;
}",
                  "fileName": "src/routes/source.ts",
                  "id": "src/routes/source.ts@1969",
                  "line": 73,
                  "modules": {},
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
      ],
      "fileName": "src/routes/source.ts",
      "id": "src/routes/source.ts@370",
      "name": "app",
    },
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "src/routes/traces.ts@815",
          "method": "get",
          "path": "/v1/traces",
          "sources": [
            {
              "character": 22,
              "content": "async (ctx) => {
  const db = ctx.get("db");

  const fpxWorker = await getSetting(db, "fpxWorkerProxy");
  if (fpxWorker?.enabled && fpxWorker.baseUrl) {
    const response = await fetch(\`\${fpxWorker.baseUrl}/v1/traces\`);
    const json = await response.json();
    return ctx.json(json);
  }

  const spans = await db.query.otelSpans.findMany({
    where: sql\`inner->>'scope_name' = 'fpx-tracer'\`,
    orderBy: desc(sql\`inner->>'end_time'\`),
  });

  const traceMap = new Map<string, Array<(typeof spans)[0]>>();

  for (const span of spans) {
    const traceId = span.inner.trace_id;
    if (!traceId) {
      continue;
    }
    if (!traceMap.has(traceId)) {
      traceMap.set(traceId, []);
    }
    traceMap.get(traceId)?.push(span);
  }

  const traces = Array.from(traceMap.entries()).map(([traceId, spans]) => ({
    traceId,
    spans,
  }));

  const response: TraceListResponse = traces.map(({ traceId, spans }) => ({
    traceId,
    spans: spans.map(({ inner }) => OtelSpanSchema.parse(inner)),
  }));

  return ctx.json(response);
}",
              "fileName": "src/routes/traces.ts",
              "id": "src/routes/traces.ts@837",
              "line": 24,
              "modules": {
                "@fiberplane/fpx-types": [
                  {
                    "import": "TraceListResponse",
                    "importPath": "@fiberplane/fpx-types",
                    "name": "@fiberplane/fpx-types",
                    "version": "0.0.9",
                  },
                  {
                    "import": "OtelSpanSchema",
                    "importPath": "@fiberplane/fpx-types",
                    "name": "@fiberplane/fpx-types",
                    "version": "0.0.9",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "sql",
                    "importPath": "drizzle-orm",
                    "name": "drizzle-orm",
                    "version": "0.33.0",
                  },
                  {
                    "import": "desc",
                    "importPath": "drizzle-orm",
                    "name": "drizzle-orm",
                    "version": "0.33.0",
                  },
                ],
              },
              "references": [],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/traces.ts@2035",
          "method": "get",
          "path": "/v1/traces/:traceId/spans",
          "sources": [
            {
              "character": 37,
              "content": "async (ctx) => {
  const traceId = ctx.req.param("traceId");

  const db = ctx.get("db");

  const fpxWorker = await getSetting(db, "fpxWorkerProxy");
  if (fpxWorker?.enabled && fpxWorker.baseUrl) {
    const response = await fetch(
      \`\${fpxWorker.baseUrl}/v1/traces/\${traceId}/spans\`,
    );
    const json = await response.json();
    return ctx.json(json);
  }

  const traces = await db
    .select()
    .from(otelSpans)
    .where(
      and(
        sql\`inner->>'scope_name' = 'fpx-tracer'\`,
        sql\`inner->>'trace_id' = \${traceId}\`,
      ),
    );

  const response: TraceDetailSpansResponse = traces.map(({ inner }) =>
    OtelSpanSchema.parse(inner),
  );

  return ctx.json(response);
}",
              "fileName": "src/routes/traces.ts",
              "id": "src/routes/traces.ts@2072",
              "line": 70,
              "modules": {
                "@fiberplane/fpx-types": [
                  {
                    "import": "TraceDetailSpansResponse",
                    "importPath": "@fiberplane/fpx-types",
                    "name": "@fiberplane/fpx-types",
                    "version": "0.0.9",
                  },
                  {
                    "import": "OtelSpanSchema",
                    "importPath": "@fiberplane/fpx-types",
                    "name": "@fiberplane/fpx-types",
                    "version": "0.0.9",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "and",
                    "importPath": "drizzle-orm",
                    "name": "drizzle-orm",
                    "version": "0.33.0",
                  },
                  {
                    "import": "sql",
                    "importPath": "drizzle-orm",
                    "name": "drizzle-orm",
                    "version": "0.33.0",
                  },
                ],
              },
              "references": [
                {
                  "character": 0,
                  "content": "export async function getSetting<T extends SettingsKey>(
  db: LibSQLDatabase<typeof schema>,
  key: T,
): Promise<Settings[T] | undefined> {
  const result = await db.query.settings.findFirst({
    where: eq(settings.key, String(key)),
  });

  if (!result?.value) {
    return;
  }

  return safeParseJson(result.value);
}",
                  "fileName": "src/lib/settings/index.ts",
                  "id": "src/lib/settings/index.ts@1283",
                  "line": 53,
                  "modules": {
                    "@fiberplane/fpx-types": [
                      {
                        "import": "SettingsKey",
                        "importPath": "@fiberplane/fpx-types",
                        "name": "@fiberplane/fpx-types",
                        "version": "0.0.9",
                      },
                      {
                        "import": "Settings",
                        "importPath": "@fiberplane/fpx-types",
                        "name": "@fiberplane/fpx-types",
                        "version": "0.0.9",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "LibSQLDatabase",
                        "importPath": "drizzle-orm/libsql",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 24,
                      "content": "const settings = sqliteTable("settings", {
  id: integer("id", { mode: "number" }).primaryKey({ autoIncrement: true }),
  key: text("key").notNull().unique(),
  value: text("value").notNull().default(""),
  createdAt: text("created_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  updatedAt: text("updated_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@6483",
                      "line": 172,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "sqliteTable",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "sql",
                            "importPath": "drizzle-orm",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 0,
                      "content": "export function safeParseJson(str: string | null | undefined) {
  if (!str) {
    return null;
  }
  try {
    return JSON.parse(str);
  } catch {
    return str;
  }
}",
                      "fileName": "src/lib/utils.ts",
                      "id": "src/lib/utils.ts@3106",
                      "line": 112,
                      "modules": {},
                      "references": [],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/traces.ts@2783",
          "method": "post",
          "path": "/v1/traces/delete-all-hack",
          "sources": [
            {
              "character": 39,
              "content": "async (ctx) => {
  const db = ctx.get("db");
  await db.delete(otelSpans);
  return ctx.text("OK");
}",
              "fileName": "src/routes/traces.ts",
              "id": "src/routes/traces.ts@2822",
              "line": 101,
              "modules": {},
              "references": [],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/routes/traces.ts@2982",
          "method": "post",
          "path": "/v1/traces",
          "sources": [
            {
              "character": 23,
              "content": "async (ctx) => {
  const db = ctx.get("db");
  const body: IExportTraceServiceRequest = await ctx.req.json();

  const fpxWorker = await getSetting(db, "fpxWorkerProxy");
  if (fpxWorker?.enabled && fpxWorker.baseUrl) {
    const response = await fetch(\`\${fpxWorker.baseUrl}/v1/traces\`, {
      headers: {
        "Content-Type": "application/json",
      },
      method: "POST",
      body: JSON.stringify(body),
    });
    const json = await response.json();
    return ctx.json(json);
  }

  try {
    const tracesPayload = (await fromCollectorRequest(body)).map(
      (span) =>
        ({
          inner: OtelSpanSchema.parse(span),
          spanId: span.span_id,
          traceId: span.trace_id,
        }) satisfies typeof otelSpans.$inferInsert,
    );

    try {
      await db.insert(otelSpans).values(tracesPayload);
    } catch (error) {
      logger.error("Error inserting trace", error);
      return ctx.text("Error inserting trace", 500);
    }

    const wsConnections = ctx.get("wsConnections");
    if (wsConnections) {
      for (const ws of wsConnections) {
        ws.send(
          JSON.stringify({
            event: "trace_created",
            payload: ["mizuTraces"],
          }),
        );
      }
    }

    return ctx.text("OK");
  } catch (error) {
    logger.error("Error parsing trace data", error);
    return ctx.text("Error parsing trace data", 400);
  }
}",
              "fileName": "src/routes/traces.ts",
              "id": "src/routes/traces.ts@3005",
              "line": 110,
              "modules": {
                "@fiberplane/fpx-types": [
                  {
                    "import": "OtelSpanSchema",
                    "importPath": "@fiberplane/fpx-types",
                    "name": "@fiberplane/fpx-types",
                    "version": "0.0.9",
                  },
                ],
                "@opentelemetry/otlp-transformer": [
                  {
                    "import": "IExportTraceServiceRequest",
                    "importPath": "@opentelemetry/otlp-transformer",
                    "name": "@opentelemetry/otlp-transformer",
                    "version": "0.52.1",
                  },
                ],
              },
              "references": [
                {
                  "character": 0,
                  "content": "export async function getSetting<T extends SettingsKey>(
  db: LibSQLDatabase<typeof schema>,
  key: T,
): Promise<Settings[T] | undefined> {
  const result = await db.query.settings.findFirst({
    where: eq(settings.key, String(key)),
  });

  if (!result?.value) {
    return;
  }

  return safeParseJson(result.value);
}",
                  "fileName": "src/lib/settings/index.ts",
                  "id": "src/lib/settings/index.ts@1283",
                  "line": 53,
                  "modules": {
                    "@fiberplane/fpx-types": [
                      {
                        "import": "SettingsKey",
                        "importPath": "@fiberplane/fpx-types",
                        "name": "@fiberplane/fpx-types",
                        "version": "0.0.9",
                      },
                      {
                        "import": "Settings",
                        "importPath": "@fiberplane/fpx-types",
                        "name": "@fiberplane/fpx-types",
                        "version": "0.0.9",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "LibSQLDatabase",
                        "importPath": "drizzle-orm/libsql",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.33.0",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 24,
                      "content": "const settings = sqliteTable("settings", {
  id: integer("id", { mode: "number" }).primaryKey({ autoIncrement: true }),
  key: text("key").notNull().unique(),
  value: text("value").notNull().default(""),
  createdAt: text("created_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
  updatedAt: text("updated_at").notNull().default(sql\`(CURRENT_TIMESTAMP)\`),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@6483",
                      "line": 172,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "sqliteTable",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/sqlite-core",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                          {
                            "import": "sql",
                            "importPath": "drizzle-orm",
                            "name": "drizzle-orm",
                            "version": "0.33.0",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 0,
                      "content": "export function safeParseJson(str: string | null | undefined) {
  if (!str) {
    return null;
  }
  try {
    return JSON.parse(str);
  } catch {
    return str;
  }
}",
                      "fileName": "src/lib/utils.ts",
                      "id": "src/lib/utils.ts@3106",
                      "line": 112,
                      "modules": {},
                      "references": [],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
      ],
      "fileName": "src/routes/traces.ts",
      "id": "src/routes/traces.ts@568",
      "name": "app",
    },
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "src/index.node.ts@1521",
          "path": "/*",
          "sources": [],
          "type": "MIDDLEWARE_ENTRY",
        },
        {
          "id": "src/index.node.ts@1684",
          "method": "get",
          "path": "*",
          "sources": [],
          "type": "ROUTE_ENTRY",
        },
      ],
      "fileName": "src/index.node.ts",
      "id": "src/index.node.ts@1428",
      "name": "app",
    },
  ],
}
`;

exports[`run test 'barrel files' with location './test-case/barrel-files' 1`] = `
{
  "errorCount": 0,
  "results": [
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "index.ts@407",
          "method": "get",
          "path": "/user/1",
          "sources": [
            {
              "character": 19,
              "content": "cors()",
              "fileName": "index.ts",
              "id": "index.ts@426",
              "line": 14,
              "modules": {
                "hono": [
                  {
                    "import": "cors",
                    "importPath": "hono/cors",
                    "name": "hono",
                    "version": "4.6.6",
                  },
                ],
              },
              "references": [],
            },
            {
              "character": 27,
              "content": "async (c) => {
  // await getUser();
  const user = await getUser();
  return c.json(user);
}",
              "fileName": "index.ts",
              "id": "index.ts@434",
              "line": 14,
              "modules": {},
              "references": [
                {
                  "character": 9,
                  "content": "export { getUser } from "./getUser"",
                  "fileName": "db/index.ts",
                  "id": "db/index.ts@9",
                  "line": 0,
                  "modules": {},
                  "references": [
                    {
                      "character": 23,
                      "content": "const getUser = measure("getUser", async () => {
  await sleep(100);
  const value: User = {
    name: DEFAULT_USER_NAME,
    email: DEFAULT_EMAIL,
  };
  return value;
})",
                      "fileName": "db/getUser.ts",
                      "id": "db/getUser.ts@222",
                      "line": 7,
                      "modules": {
                        "@fiberplane/hono-otel": [
                          {
                            "import": "measure",
                            "importPath": "@fiberplane/hono-otel",
                            "name": "@fiberplane/hono-otel",
                            "version": "0.3.1",
                          },
                        ],
                      },
                      "references": [
                        {
                          "character": 0,
                          "content": "export async function sleep(duration: number) {
  return new Promise((resolve) => setTimeout(resolve, duration));
}",
                          "fileName": "utils.ts",
                          "id": "utils.ts@0",
                          "line": 0,
                          "modules": {},
                          "references": [],
                        },
                        {
                          "character": 0,
                          "content": "export type User = {
  name: string;
  email: Email;
};",
                          "fileName": "types.ts",
                          "id": "types.ts@29",
                          "line": 2,
                          "modules": {},
                          "references": [
                            {
                              "character": 0,
                              "content": "export type Email = string;",
                              "fileName": "types.ts",
                              "id": "types.ts@0",
                              "line": 0,
                              "modules": {},
                              "references": [],
                            },
                          ],
                        },
                        {
                          "character": 6,
                          "content": "const DEFAULT_USER_NAME = "John Doe"",
                          "fileName": "db/getUser.ts",
                          "id": "db/getUser.ts@128",
                          "line": 4,
                          "modules": {},
                          "references": [],
                        },
                        {
                          "character": 6,
                          "content": "const DEFAULT_EMAIL = "john@doe.com"",
                          "fileName": "db/getUser.ts",
                          "id": "db/getUser.ts@166",
                          "line": 5,
                          "modules": {},
                          "references": [],
                        },
                      ],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "index.ts@531",
          "method": "get",
          "path": "/",
          "sources": [
            {
              "character": 13,
              "content": "(c) => c.text("Hello, Hono!")",
              "fileName": "index.ts",
              "id": "index.ts@544",
              "line": 20,
              "modules": {},
              "references": [],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
      ],
      "fileName": "index.ts",
      "id": "index.ts@102",
      "name": "app",
    },
  ],
}
`;

exports[`run test 'goose-quotes' with location '../../examples/goose-quotes' 1`] = `
{
  "errorCount": 0,
  "results": [
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "src/index.ts@794",
          "method": "get",
          "path": "/",
          "sources": [
            {
              "character": 13,
              "content": "(c) => {
  const honk = shouldHonk(c.req) ? "Honk honk!" : "";
  console.log(\`Home page accessed. Honk: \${honk}\`);
  return c.text(\`Hello Goose Quotes! \${honk}\`.trim());
}",
              "fileName": "src/index.ts",
              "id": "src/index.ts@807",
              "line": 33,
              "modules": {},
              "references": [
                {
                  "character": 0,
                  "content": "export function shouldHonk(r: HonoRequest) {
  const { shouldHonk } = r.query();
  return typeof shouldHonk !== "undefined";
}",
                  "fileName": "src/utils.ts",
                  "id": "src/utils.ts@42",
                  "line": 2,
                  "modules": {
                    "hono": [
                      {
                        "import": "HonoRequest",
                        "importPath": "hono",
                        "name": "hono",
                        "version": "4.5.9",
                      },
                    ],
                  },
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/index.ts@1084",
          "method": "get",
          "path": "/api/geese",
          "sources": [
            {
              "character": 22,
              "content": "async (c) => {
  const sql = neon(c.env.DATABASE_URL);
  const db = drizzle(sql);

  const name = c.req.query("name");
  console.log({ action: "search_geese", name });

  if (!name) {
    const allGeese = await measure("getAllGeese", () => getAllGeese(db))();
    console.log({ action: "get_all_geese", count: allGeese.length });
    return c.json(allGeese);
  }

  const searchResults = await measure("searchGeese", () =>
    db
      .select()
      .from(geese)
      .where(ilike(geese.name, \`%\${name}%\`))
      .orderBy(asc(geese.name)),
  )();

  console.log({
    action: "search_geese_results",
    count: searchResults.length,
    name,
  });

  return c.json(searchResults);
}",
              "fileName": "src/index.ts",
              "id": "src/index.ts@1106",
              "line": 44,
              "modules": {
                "@fiberplane/hono-otel": [
                  {
                    "import": "measure",
                    "importPath": "@fiberplane/hono-otel",
                    "name": "@fiberplane/hono-otel",
                    "version": "0.4.0-canary.0",
                  },
                ],
                "@neondatabase/serverless": [
                  {
                    "import": "neon",
                    "importPath": "@neondatabase/serverless",
                    "name": "@neondatabase/serverless",
                    "version": "0.9.4",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "drizzle",
                    "importPath": "drizzle-orm/neon-http",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                  {
                    "import": "ilike",
                    "importPath": "drizzle-orm",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                  {
                    "import": "asc",
                    "importPath": "drizzle-orm",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 27,
                  "content": "const getAllGeese = measure("getAllGeese", async (db: ReturnType<typeof drizzle>) => {
  console.log("Fetching all geese");
  return await db.select().from(geese);
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@260",
                  "line": 6,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 21,
                  "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@134",
                  "line": 10,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "pgTable",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "serial",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "boolean",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "jsonb",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "timestamp",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 21,
                  "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@134",
                  "line": 10,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "pgTable",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "serial",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "boolean",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "jsonb",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "timestamp",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 21,
                  "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@134",
                  "line": 10,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "pgTable",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "serial",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "boolean",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "jsonb",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "timestamp",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/index.ts@1837",
          "method": "get",
          "path": "/api/geese-with-avatar",
          "sources": [
            {
              "character": 34,
              "content": "async (c) => {
  const sql = neon(c.env.DATABASE_URL);
  const db = drizzle(sql);

  console.log("Fetching geese with avatars");

  const geeseWithAvatars = await measure("getGeeseWithAvatars", () =>
    db
      .select()
      .from(geese)
      .where(not(isNull(geese.avatar)))
      .orderBy(asc(geese.id)),
  )();

  console.log(\`Found \${geeseWithAvatars.length} geese with avatars\`);
  return c.json(geeseWithAvatars.map((g) => g.id));
}",
              "fileName": "src/index.ts",
              "id": "src/index.ts@1871",
              "line": 77,
              "modules": {
                "@fiberplane/hono-otel": [
                  {
                    "import": "measure",
                    "importPath": "@fiberplane/hono-otel",
                    "name": "@fiberplane/hono-otel",
                    "version": "0.4.0-canary.0",
                  },
                ],
                "@neondatabase/serverless": [
                  {
                    "import": "neon",
                    "importPath": "@neondatabase/serverless",
                    "name": "@neondatabase/serverless",
                    "version": "0.9.4",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "drizzle",
                    "importPath": "drizzle-orm/neon-http",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                  {
                    "import": "not",
                    "importPath": "drizzle-orm",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                  {
                    "import": "isNull",
                    "importPath": "drizzle-orm",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                  {
                    "import": "asc",
                    "importPath": "drizzle-orm",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 21,
                  "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@134",
                  "line": 10,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "pgTable",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "serial",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "boolean",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "jsonb",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "timestamp",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 21,
                  "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@134",
                  "line": 10,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "pgTable",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "serial",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "boolean",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "jsonb",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "timestamp",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 21,
                  "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@134",
                  "line": 10,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "pgTable",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "serial",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "boolean",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "jsonb",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "timestamp",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/index.ts@2425",
          "method": "post",
          "path": "/api/geese",
          "sources": [
            {
              "character": 23,
              "content": "async (c) => {
  const sql = neon(c.env.DATABASE_URL);
  const db = drizzle(sql);

  const { name, isFlockLeader, programmingLanguage, motivations, location } =
    await c.req.json();
  const description = \`A person named \${name} who talks like a Goose\`;

  console.log(\`Creating new goose: \${name}\`);

  const created = await measure("createGoose", () =>
    createGoose(db, {
      name,
      description,
      isFlockLeader,
      programmingLanguage,
      motivations,
      location,
    }),
  )();
  console.log({ action: "create_goose", id: created[0].id, name });
  return c.json(created);
}",
              "fileName": "src/index.ts",
              "id": "src/index.ts@2448",
              "line": 100,
              "modules": {
                "@fiberplane/hono-otel": [
                  {
                    "import": "measure",
                    "importPath": "@fiberplane/hono-otel",
                    "name": "@fiberplane/hono-otel",
                    "version": "0.4.0-canary.0",
                  },
                ],
                "@neondatabase/serverless": [
                  {
                    "import": "neon",
                    "importPath": "@neondatabase/serverless",
                    "name": "@neondatabase/serverless",
                    "version": "0.9.4",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "drizzle",
                    "importPath": "drizzle-orm/neon-http",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 27,
                  "content": "const createGoose = measure("createGoose", async (
  db: ReturnType<typeof drizzle>,
  gooseData: Partial<typeof geese.$inferInsert> & Pick<typeof geese.$inferInsert, "name">,
) => {
  const { name, isFlockLeader, programmingLanguage, motivations, location } =
    gooseData;
  const description = \`A person named \${name} who talks like a Goose\`;

  console.log({
    action: "createGoose",
    name,
    isFlockLeader,
    programmingLanguage,
  });

  return await db
    .insert(geese)
    .values({
      name,
      description,
      isFlockLeader,
      programmingLanguage,
      motivations,
      location,
    })
    .returning({
      id: geese.id,
      name: geese.name,
      description: geese.description,
      isFlockLeader: geese.isFlockLeader,
      programmingLanguage: geese.programmingLanguage,
      motivations: geese.motivations,
      location: geese.location,
    });
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@727",
                  "line": 23,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/index.ts@3088",
          "method": "post",
          "path": "/api/geese/:id/generate",
          "sources": [
            {
              "character": 36,
              "content": "async (c) => {
  const sql = neon(c.env.DATABASE_URL);
  const db = drizzle(sql);

  const id = c.req.param("id");

  const goose = await measure("getGooseById", () => getGooseById(db, +id))();

  if (!goose) {
    console.warn(\`Goose not found: \${id}\`);
    return c.json({ message: "Goose not found" }, 404);
  }

  const { name: gooseName } = goose;

  const openaiClient = new OpenAI({
    apiKey: c.env.OPENAI_API_KEY,
    // HACK - OpenAI freezes fetch when it is imported, so our monkey-patched version needs to be passed here
    fetch: globalThis.fetch,
  });

  console.log(\`Generating quotes for goose: \${gooseName}\`);

  const response = await measure("generateQuotes", () =>
    openaiClient.chat.completions.create({
      model: "gpt-4o-mini",
      messages: [
        {
          role: "system",
          content: trimPrompt(\`
              You are a goose. You are a very smart goose. You are part goose, part AI. You are a GooseAI.
              You are also influenced heavily by the work of \${gooseName}.

              Always respond without preamble. If I ask for a list, give me a newline-separated list. That's it.
              Don't number it. Don't bullet it. Just newline it.

              Never forget to Honk. A lot.
          \`),
        },
        {
          role: "user",
          content: trimPrompt(\`
              Reimagine five famous quotes by \${gooseName}, except with significant goose influence.
          \`),
        },
      ],
      temperature: 0.7,
      max_tokens: 2048,
    }),
  )();

  const quotes = response.choices[0].message.content
    ?.split("\\n")
    .filter((quote) => quote.length > 0);
  console.log({
    action: "generate_quotes",
    gooseName,
    quoteCount: quotes?.length,
  });
  return c.json({ name: goose.name, quotes });
}",
              "fileName": "src/index.ts",
              "id": "src/index.ts@3124",
              "line": 127,
              "modules": {
                "@fiberplane/hono-otel": [
                  {
                    "import": "measure",
                    "importPath": "@fiberplane/hono-otel",
                    "name": "@fiberplane/hono-otel",
                    "version": "0.4.0-canary.0",
                  },
                ],
                "@neondatabase/serverless": [
                  {
                    "import": "neon",
                    "importPath": "@neondatabase/serverless",
                    "name": "@neondatabase/serverless",
                    "version": "0.9.4",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "drizzle",
                    "importPath": "drizzle-orm/neon-http",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                ],
                "openai": [
                  {
                    "import": "OpenAI",
                    "importPath": "openai",
                    "name": "openai",
                    "version": "4.55.4",
                  },
                ],
              },
              "references": [
                {
                  "character": 28,
                  "content": "const getGooseById = measure("getGooseById", async (
  db: ReturnType<typeof drizzle>,
  id: number,
) => {
  console.log(\`Fetching goose with id: \${id}\`);
  return (await db.select().from(geese).where(eq(geese.id, id)))?.[0];
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@1637",
                  "line": 59,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
                {
                  "character": 0,
                  "content": "function trimPrompt(prompt: string) {
  return prompt
    .trim()
    .split("\\n")
    .map((l) => l.trim())
    .join("\\n");
}",
                  "fileName": "src/index.ts",
                  "id": "src/index.ts@16499",
                  "line": 615,
                  "modules": {},
                  "references": [],
                },
                {
                  "character": 0,
                  "content": "function trimPrompt(prompt: string) {
  return prompt
    .trim()
    .split("\\n")
    .map((l) => l.trim())
    .join("\\n");
}",
                  "fileName": "src/index.ts",
                  "id": "src/index.ts@16499",
                  "line": 615,
                  "modules": {},
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/index.ts@5086",
          "method": "get",
          "path": "/api/geese/flock-leaders",
          "sources": [
            {
              "character": 36,
              "content": "async (c) => {
  const sql = neon(c.env.DATABASE_URL);
  const db = drizzle(sql);

  console.log("Fetching flock leaders");

  const flockLeaders = await measure("getFlockLeaders", () =>
    db.select().from(geese).where(eq(geese.isFlockLeader, true)),
  )();

  console.log(\`Found \${flockLeaders.length} flock leaders\`);

  return c.json(flockLeaders);
}",
              "fileName": "src/index.ts",
              "id": "src/index.ts@5122",
              "line": 193,
              "modules": {
                "@fiberplane/hono-otel": [
                  {
                    "import": "measure",
                    "importPath": "@fiberplane/hono-otel",
                    "name": "@fiberplane/hono-otel",
                    "version": "0.4.0-canary.0",
                  },
                ],
                "@neondatabase/serverless": [
                  {
                    "import": "neon",
                    "importPath": "@neondatabase/serverless",
                    "name": "@neondatabase/serverless",
                    "version": "0.9.4",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "drizzle",
                    "importPath": "drizzle-orm/neon-http",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                  {
                    "import": "eq",
                    "importPath": "drizzle-orm",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 21,
                  "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@134",
                  "line": 10,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "pgTable",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "serial",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "boolean",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "jsonb",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "timestamp",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 21,
                  "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                  "fileName": "src/db/schema.ts",
                  "id": "src/db/schema.ts@134",
                  "line": 10,
                  "modules": {
                    "drizzle-orm": [
                      {
                        "import": "pgTable",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "serial",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "text",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "boolean",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "jsonb",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "integer",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "timestamp",
                        "importPath": "drizzle-orm/pg-core",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/index.ts@5510",
          "method": "get",
          "path": "/api/geese/:id",
          "sources": [
            {
              "character": 26,
              "content": "async (c) => {
  const sql = neon(c.env.DATABASE_URL);
  const db = drizzle(sql);

  const id = c.req.param("id");

  console.log(\`Fetching goose with id: \${id}\`);

  const goose = await measure("getGooseById", () => getGooseById(db, +id))();

  if (!goose) {
    console.warn(\`Goose not found: \${id}\`);
    return c.json({ message: "Goose not found" }, 404);
  }

  console.log(\`Found goose: \${goose.name}\`);
  return c.json(goose);
}",
              "fileName": "src/index.ts",
              "id": "src/index.ts@5536",
              "line": 211,
              "modules": {
                "@fiberplane/hono-otel": [
                  {
                    "import": "measure",
                    "importPath": "@fiberplane/hono-otel",
                    "name": "@fiberplane/hono-otel",
                    "version": "0.4.0-canary.0",
                  },
                ],
                "@neondatabase/serverless": [
                  {
                    "import": "neon",
                    "importPath": "@neondatabase/serverless",
                    "name": "@neondatabase/serverless",
                    "version": "0.9.4",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "drizzle",
                    "importPath": "drizzle-orm/neon-http",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 28,
                  "content": "const getGooseById = measure("getGooseById", async (
  db: ReturnType<typeof drizzle>,
  id: number,
) => {
  console.log(\`Fetching goose with id: \${id}\`);
  return (await db.select().from(geese).where(eq(geese.id, id)))?.[0];
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@1637",
                  "line": 59,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/index.ts@6005",
          "method": "post",
          "path": "/api/geese/:id/bio",
          "sources": [
            {
              "character": 31,
              "content": "async (c) => {
  const sql = neon(c.env.DATABASE_URL);
  const db = drizzle(sql);

  const id = c.req.param("id");

  const goose = await measure("getGooseById", () => getGooseById(db, +id))();

  if (!goose) {
    console.warn(\`Goose not found: \${id}\`);
    return c.json({ message: "Goose not found" }, 404);
  }

  const {
    name: gooseName,
    description,
    programmingLanguage,
    motivations,
    location,
  } = goose;

  console.log(\`Generating bio for goose: \${gooseName}\`);

  const openaiClient = new OpenAI({
    apiKey: c.env.OPENAI_API_KEY,
    fetch: globalThis.fetch,
  });

  const response = await measure("generateBio", () =>
    openaiClient.chat.completions.create({
      model: "gpt-4o",
      messages: [
        {
          role: "system",
          content: trimPrompt(\`
              You are a professional bio writer. Your task is to generate a compelling and engaging bio for a goose.
          \`),
        },
        {
          role: "user",
          content: trimPrompt(\`
              Generate a bio for a goose named \${gooseName} with the following details:
              Description: \${description}
              Programming Language: \${programmingLanguage}
              Motivations: \${motivations}
              Location: \${location}
          \`),
        },
      ],
      temperature: 0.7,
      max_tokens: 2048,
    }),
  )();

  const bio = response.choices[0].message.content;

  // Update the goose with the generated bio
  const updatedGoose = await measure("updateGoose", () =>
    updateGoose(db, +id, { bio }),
  )();

  console.log(\`Bio generated and updated for goose: \${gooseName}\`);
  return c.json(updatedGoose);
}",
              "fileName": "src/index.ts",
              "id": "src/index.ts@6036",
              "line": 233,
              "modules": {
                "@fiberplane/hono-otel": [
                  {
                    "import": "measure",
                    "importPath": "@fiberplane/hono-otel",
                    "name": "@fiberplane/hono-otel",
                    "version": "0.4.0-canary.0",
                  },
                ],
                "@neondatabase/serverless": [
                  {
                    "import": "neon",
                    "importPath": "@neondatabase/serverless",
                    "name": "@neondatabase/serverless",
                    "version": "0.9.4",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "drizzle",
                    "importPath": "drizzle-orm/neon-http",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                ],
                "openai": [
                  {
                    "import": "OpenAI",
                    "importPath": "openai",
                    "name": "openai",
                    "version": "4.55.4",
                  },
                ],
              },
              "references": [
                {
                  "character": 28,
                  "content": "const getGooseById = measure("getGooseById", async (
  db: ReturnType<typeof drizzle>,
  id: number,
) => {
  console.log(\`Fetching goose with id: \${id}\`);
  return (await db.select().from(geese).where(eq(geese.id, id)))?.[0];
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@1637",
                  "line": 59,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
                {
                  "character": 0,
                  "content": "function trimPrompt(prompt: string) {
  return prompt
    .trim()
    .split("\\n")
    .map((l) => l.trim())
    .join("\\n");
}",
                  "fileName": "src/index.ts",
                  "id": "src/index.ts@16499",
                  "line": 615,
                  "modules": {},
                  "references": [],
                },
                {
                  "character": 0,
                  "content": "function trimPrompt(prompt: string) {
  return prompt
    .trim()
    .split("\\n")
    .map((l) => l.trim())
    .join("\\n");
}",
                  "fileName": "src/index.ts",
                  "id": "src/index.ts@16499",
                  "line": 615,
                  "modules": {},
                  "references": [],
                },
                {
                  "character": 27,
                  "content": "const updateGoose = measure("updateGoose", async (
  db: ReturnType<typeof drizzle>,
  id: number,
  updateData: Partial<typeof geese.$inferInsert>,
) => {
  console.log({ action: "updateGoose", id, updateData });

  // Simulate a race condition by splitting the update into two parts
  const updatePromises = Object.entries(updateData).map(
    async ([key, value]) => {
      // Introduce a random delay to increase the chance of interleaved updates
      await new Promise((resolve) => setTimeout(resolve, Math.random() * 1000));

      return db
        .update(geese)
        .set({ [key]: value })
        .where(eq(geese.id, id))
        .returning();
    },
  );

  // Wait for all updates to complete
  const results = await Promise.all(updatePromises);

  // Return the last result, which may not contain all updates
  return results[results.length - 1][0];
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@3431",
                  "line": 124,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/index.ts@7748",
          "method": "post",
          "path": "/api/geese/:id/honk",
          "sources": [
            {
              "character": 32,
              "content": "async (c) => {
  const sql = neon(c.env.DATABASE_URL);
  const db = drizzle(sql);

  const id = c.req.param("id");
  const goose = await measure("getGooseById", () => getGooseById(db, +id))();

  if (!goose) {
    console.warn(\`Goose not found: \${id}\`);
    return c.json({ message: "Goose not found" }, 404);
  }

  const currentHonks = goose.honks || 0;

  const updatedGoose = await measure("updateGoose", () =>
    updateGoose(db, +id, { honks: currentHonks + 1 }),
  )();

  console.log(
    \`Honk received for goose: \${goose.name}. New honk count: \${updatedGoose.honks}\`,
  );
  return c.json({
    message: \`Honk honk! \${goose.name} honks back at you!\`,
    honks: updatedGoose.honks,
  });
}",
              "fileName": "src/index.ts",
              "id": "src/index.ts@7780",
              "line": 301,
              "modules": {
                "@fiberplane/hono-otel": [
                  {
                    "import": "measure",
                    "importPath": "@fiberplane/hono-otel",
                    "name": "@fiberplane/hono-otel",
                    "version": "0.4.0-canary.0",
                  },
                ],
                "@neondatabase/serverless": [
                  {
                    "import": "neon",
                    "importPath": "@neondatabase/serverless",
                    "name": "@neondatabase/serverless",
                    "version": "0.9.4",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "drizzle",
                    "importPath": "drizzle-orm/neon-http",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 28,
                  "content": "const getGooseById = measure("getGooseById", async (
  db: ReturnType<typeof drizzle>,
  id: number,
) => {
  console.log(\`Fetching goose with id: \${id}\`);
  return (await db.select().from(geese).where(eq(geese.id, id)))?.[0];
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@1637",
                  "line": 59,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
                {
                  "character": 27,
                  "content": "const updateGoose = measure("updateGoose", async (
  db: ReturnType<typeof drizzle>,
  id: number,
  updateData: Partial<typeof geese.$inferInsert>,
) => {
  console.log({ action: "updateGoose", id, updateData });

  // Simulate a race condition by splitting the update into two parts
  const updatePromises = Object.entries(updateData).map(
    async ([key, value]) => {
      // Introduce a random delay to increase the chance of interleaved updates
      await new Promise((resolve) => setTimeout(resolve, Math.random() * 1000));

      return db
        .update(geese)
        .set({ [key]: value })
        .where(eq(geese.id, id))
        .returning();
    },
  );

  // Wait for all updates to complete
  const results = await Promise.all(updatePromises);

  // Return the last result, which may not contain all updates
  return results[results.length - 1][0];
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@3431",
                  "line": 124,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/index.ts@8515",
          "method": "patch",
          "path": "/api/geese/:id",
          "sources": [
            {
              "character": 28,
              "content": "async (c) => {
  const sql = neon(c.env.DATABASE_URL);
  const db = drizzle(sql);

  const id = c.req.param("id");
  const updateData = await c.req.json();

  console.log(\`Updating goose \${id} with data:\`, updateData);

  const goose = await measure("getGooseById", () => getGooseById(db, +id))();

  if (!goose) {
    console.warn(\`Goose not found: \${id}\`);
    return c.json({ message: "Goose not found" }, 404);
  }

  // Simulate a race condition by splitting the update into multiple parts
  const updatePromises = Object.entries(updateData).map(
    async ([key, value]) => {
      await new Promise((resolve) => setTimeout(resolve, Math.random() * 1000));
      return measure("updateGoose", () =>
        updateGoose(db, +id, { [key]: value }),
      )();
    },
  );

  await Promise.all(updatePromises);

  const updatedGoose = await measure("getGooseById", () =>
    getGooseById(db, +id),
  )();

  console.log(\`Goose \${id} updated successfully\`);
  return c.json(updatedGoose);
}",
              "fileName": "src/index.ts",
              "id": "src/index.ts@8543",
              "line": 331,
              "modules": {
                "@fiberplane/hono-otel": [
                  {
                    "import": "measure",
                    "importPath": "@fiberplane/hono-otel",
                    "name": "@fiberplane/hono-otel",
                    "version": "0.4.0-canary.0",
                  },
                ],
                "@neondatabase/serverless": [
                  {
                    "import": "neon",
                    "importPath": "@neondatabase/serverless",
                    "name": "@neondatabase/serverless",
                    "version": "0.9.4",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "drizzle",
                    "importPath": "drizzle-orm/neon-http",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 28,
                  "content": "const getGooseById = measure("getGooseById", async (
  db: ReturnType<typeof drizzle>,
  id: number,
) => {
  console.log(\`Fetching goose with id: \${id}\`);
  return (await db.select().from(geese).where(eq(geese.id, id)))?.[0];
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@1637",
                  "line": 59,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
                {
                  "character": 27,
                  "content": "const updateGoose = measure("updateGoose", async (
  db: ReturnType<typeof drizzle>,
  id: number,
  updateData: Partial<typeof geese.$inferInsert>,
) => {
  console.log({ action: "updateGoose", id, updateData });

  // Simulate a race condition by splitting the update into two parts
  const updatePromises = Object.entries(updateData).map(
    async ([key, value]) => {
      // Introduce a random delay to increase the chance of interleaved updates
      await new Promise((resolve) => setTimeout(resolve, Math.random() * 1000));

      return db
        .update(geese)
        .set({ [key]: value })
        .where(eq(geese.id, id))
        .returning();
    },
  );

  // Wait for all updates to complete
  const results = await Promise.all(updatePromises);

  // Return the last result, which may not contain all updates
  return results[results.length - 1][0];
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@3431",
                  "line": 124,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
                {
                  "character": 28,
                  "content": "const getGooseById = measure("getGooseById", async (
  db: ReturnType<typeof drizzle>,
  id: number,
) => {
  console.log(\`Fetching goose with id: \${id}\`);
  return (await db.select().from(geese).where(eq(geese.id, id)))?.[0];
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@1637",
                  "line": 59,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/index.ts@9584",
          "method": "get",
          "path": "/api/geese/language/:language",
          "sources": [
            {
              "character": 41,
              "content": "async (c) => {
  const sql = neon(c.env.DATABASE_URL);
  const db = drizzle(sql);

  const language = c.req.param("language");

  console.log(\`Fetching geese with programming language: \${language}\`);

  const geeseByLanguage = await measure("getGeeseByLanguage", () =>
    getGeeseByLanguage(db, language),
  )();

  console.log(
    \`Found \${geeseByLanguage.length} geese for language: \${language}\`,
  );
  return c.json(geeseByLanguage);
}",
              "fileName": "src/index.ts",
              "id": "src/index.ts@9625",
              "line": 370,
              "modules": {
                "@fiberplane/hono-otel": [
                  {
                    "import": "measure",
                    "importPath": "@fiberplane/hono-otel",
                    "name": "@fiberplane/hono-otel",
                    "version": "0.4.0-canary.0",
                  },
                ],
                "@neondatabase/serverless": [
                  {
                    "import": "neon",
                    "importPath": "@neondatabase/serverless",
                    "name": "@neondatabase/serverless",
                    "version": "0.9.4",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "drizzle",
                    "importPath": "drizzle-orm/neon-http",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 34,
                  "content": "const getGeeseByLanguage = measure("getGeeseByLanguage", async (
  db: ReturnType<typeof drizzle>,
  language: string,
) => {
  console.log(\`Fetching geese with programming language: \${language}\`);
  return await db
    .select()
    .from(geese)
    .where(ilike(geese.programmingLanguage, \`%\${language}%\`));
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@2403",
                  "line": 83,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "ilike",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/index.ts@10116",
          "method": "patch",
          "path": "/api/geese/:id/motivations",
          "sources": [
            {
              "character": 40,
              "content": "async (c) => {
  const sql = neon(c.env.DATABASE_URL);
  const db = drizzle(sql);

  const id = c.req.param("id");
  const { motivations } = await c.req.json();

  console.log(\`Updating motivations for goose \${id}\`);

  const updatedGoose = await measure("updateGoose", () =>
    updateGoose(db, +id, { motivations }),
  )();

  if (!updatedGoose) {
    console.warn(\`Goose not found: \${id}\`);
    return c.json({ message: "Goose not found" }, 404);
  }

  console.log(\`Motivations updated for goose \${id}\`);
  return c.json(updatedGoose);
}",
              "fileName": "src/index.ts",
              "id": "src/index.ts@10156",
              "line": 391,
              "modules": {
                "@fiberplane/hono-otel": [
                  {
                    "import": "measure",
                    "importPath": "@fiberplane/hono-otel",
                    "name": "@fiberplane/hono-otel",
                    "version": "0.4.0-canary.0",
                  },
                ],
                "@neondatabase/serverless": [
                  {
                    "import": "neon",
                    "importPath": "@neondatabase/serverless",
                    "name": "@neondatabase/serverless",
                    "version": "0.9.4",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "drizzle",
                    "importPath": "drizzle-orm/neon-http",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 27,
                  "content": "const updateGoose = measure("updateGoose", async (
  db: ReturnType<typeof drizzle>,
  id: number,
  updateData: Partial<typeof geese.$inferInsert>,
) => {
  console.log({ action: "updateGoose", id, updateData });

  // Simulate a race condition by splitting the update into two parts
  const updatePromises = Object.entries(updateData).map(
    async ([key, value]) => {
      // Introduce a random delay to increase the chance of interleaved updates
      await new Promise((resolve) => setTimeout(resolve, Math.random() * 1000));

      return db
        .update(geese)
        .set({ [key]: value })
        .where(eq(geese.id, id))
        .returning();
    },
  );

  // Wait for all updates to complete
  const results = await Promise.all(updatePromises);

  // Return the last result, which may not contain all updates
  return results[results.length - 1][0];
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@3431",
                  "line": 124,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/index.ts@10701",
          "method": "post",
          "path": "/api/geese/:id/change-name-url-form",
          "sources": [
            {
              "character": 48,
              "content": "async (c) => {
  const sql = neon(c.env.DATABASE_URL);
  const db = drizzle(sql);

  const id = c.req.param("id");
  const goose = await measure("getGooseById", () => getGooseById(db, +id))();

  if (!goose) {
    console.warn(\`Goose not found: \${id}\`);
    return c.json({ message: "Goose not found" }, 404);
  }

  const form = await c.req.formData() as FormData;
  const name = form.get("name");

  if (!name) {
    console.error("Name is required for changing goose name");
    return c.json({ message: "Name is required" }, 400);
  }

  console.log(\`Changing name of goose \${id} to \${name}\`);
  const updatedGoose = await measure("updateGoose", () =>
    updateGoose(db, +id, { name }),
  )();

  console.log(\`Name changed for goose \${id}\`);
  return c.json(updatedGoose, 200);
}",
              "fileName": "src/index.ts",
              "id": "src/index.ts@10749",
              "line": 413,
              "modules": {
                "@fiberplane/hono-otel": [
                  {
                    "import": "measure",
                    "importPath": "@fiberplane/hono-otel",
                    "name": "@fiberplane/hono-otel",
                    "version": "0.4.0-canary.0",
                  },
                ],
                "@neondatabase/serverless": [
                  {
                    "import": "neon",
                    "importPath": "@neondatabase/serverless",
                    "name": "@neondatabase/serverless",
                    "version": "0.9.4",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "drizzle",
                    "importPath": "drizzle-orm/neon-http",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 28,
                  "content": "const getGooseById = measure("getGooseById", async (
  db: ReturnType<typeof drizzle>,
  id: number,
) => {
  console.log(\`Fetching goose with id: \${id}\`);
  return (await db.select().from(geese).where(eq(geese.id, id)))?.[0];
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@1637",
                  "line": 59,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
                {
                  "character": 27,
                  "content": "const updateGoose = measure("updateGoose", async (
  db: ReturnType<typeof drizzle>,
  id: number,
  updateData: Partial<typeof geese.$inferInsert>,
) => {
  console.log({ action: "updateGoose", id, updateData });

  // Simulate a race condition by splitting the update into two parts
  const updatePromises = Object.entries(updateData).map(
    async ([key, value]) => {
      // Introduce a random delay to increase the chance of interleaved updates
      await new Promise((resolve) => setTimeout(resolve, Math.random() * 1000));

      return db
        .update(geese)
        .set({ [key]: value })
        .where(eq(geese.id, id))
        .returning();
    },
  );

  // Wait for all updates to complete
  const results = await Promise.all(updatePromises);

  // Return the last result, which may not contain all updates
  return results[results.length - 1][0];
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@3431",
                  "line": 124,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/index.ts@11578",
          "method": "post",
          "path": "/api/geese/:id/avatar",
          "sources": [
            {
              "character": 34,
              "content": "async (c) => {
  const sql = neon(c.env.DATABASE_URL);
  const db = drizzle(sql);

  const id = c.req.param("id");

  const goose = await measure("getGooseById", () => getGooseById(db, +id))();

  if (!goose) {
    console.warn(\`Goose not found: \${id}\`);
    return c.json({ message: "Goose not found" }, 404);
  }

  const { avatar, avatarName } = await c.req.parseBody();
  console.log({ action: "update_avatar", gooseId: id, avatarName });
  // Validate the avatar is a file
  if (!(avatar instanceof File)) {
    console.error(\`Invalid avatar type for goose \${id}: \${typeof avatar}\`);
    return c.json(
      { message: "Avatar must be a file", actualType: typeof avatar },
      422,
    );
  }

  // Validate the avatar is a JPEG, PNG, or GIF
  const allowedTypes = ["image/jpeg", "image/png", "image/gif"];
  if (!allowedTypes.includes(avatar.type)) {
    console.error(\`Invalid avatar file type for goose \${id}: \${avatar.type}\`);
    return c.json({ message: "Avatar must be a JPEG, PNG, or GIF image" }, 422);
  }

  // Get the file extension from the avatar's type
  const fileExtension = avatar.type.split("/")[1];

  // Save the avatar to the bucket
  const bucketKey = \`goose-\${id}-avatar-\${Date.now()}.\${fileExtension}\`;
  await measure("uploadAvatar", () =>
    c.env.GOOSE_AVATARS.put(bucketKey, avatar.stream(), {
      httpMetadata: { contentType: avatar.type },
    }),
  )();

  console.log(\`Avatar uploaded for goose \${id}: \${bucketKey}\`);

  const updatedGoose = await measure("updateGoose", () =>
    updateGoose(db, +id, { avatar: bucketKey }),
  )();

  console.log(\`Avatar updated for goose \${id}\`);
  return c.json(updatedGoose);
}",
              "fileName": "src/index.ts",
              "id": "src/index.ts@11612",
              "line": 445,
              "modules": {
                "@fiberplane/hono-otel": [
                  {
                    "import": "measure",
                    "importPath": "@fiberplane/hono-otel",
                    "name": "@fiberplane/hono-otel",
                    "version": "0.4.0-canary.0",
                  },
                ],
                "@neondatabase/serverless": [
                  {
                    "import": "neon",
                    "importPath": "@neondatabase/serverless",
                    "name": "@neondatabase/serverless",
                    "version": "0.9.4",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "drizzle",
                    "importPath": "drizzle-orm/neon-http",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 28,
                  "content": "const getGooseById = measure("getGooseById", async (
  db: ReturnType<typeof drizzle>,
  id: number,
) => {
  console.log(\`Fetching goose with id: \${id}\`);
  return (await db.select().from(geese).where(eq(geese.id, id)))?.[0];
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@1637",
                  "line": 59,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
                {
                  "character": 27,
                  "content": "const updateGoose = measure("updateGoose", async (
  db: ReturnType<typeof drizzle>,
  id: number,
  updateData: Partial<typeof geese.$inferInsert>,
) => {
  console.log({ action: "updateGoose", id, updateData });

  // Simulate a race condition by splitting the update into two parts
  const updatePromises = Object.entries(updateData).map(
    async ([key, value]) => {
      // Introduce a random delay to increase the chance of interleaved updates
      await new Promise((resolve) => setTimeout(resolve, Math.random() * 1000));

      return db
        .update(geese)
        .set({ [key]: value })
        .where(eq(geese.id, id))
        .returning();
    },
  );

  // Wait for all updates to complete
  const results = await Promise.all(updatePromises);

  // Return the last result, which may not contain all updates
  return results[results.length - 1][0];
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@3431",
                  "line": 124,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/index.ts@13313",
          "method": "get",
          "path": "/api/geese/:id/avatar",
          "sources": [
            {
              "character": 33,
              "content": "async (c) => {
  const sql = neon(c.env.DATABASE_URL);
  const db = drizzle(sql);

  const id = c.req.param("id");

  const goose = await measure("getGooseById", () => getGooseById(db, +id))();

  if (!goose) {
    console.warn(\`Goose not found: \${id}\`);
    return c.json({ message: "Goose not found" }, 404);
  }

  const avatarKey = goose.avatar;

  if (!avatarKey) {
    console.warn(\`Goose \${id} has no avatar\`);
    return c.json({ message: "Goose has no avatar" }, 404);
  }

  console.log(\`Fetching avatar for goose \${id}: \${avatarKey}\`);

  const avatar = await measure("getAvatar", () =>
    c.env.GOOSE_AVATARS.get(avatarKey),
  )();

  if (!avatar) {
    console.error(\`Avatar not found for goose \${id}: \${avatarKey}\`);
    return c.json({ message: "Goose avatar not found" }, 404);
  }

  console.log(\`Avatar retrieved for goose \${id}\`);
  const responseHeaders = mapR2HttpMetadataToHeaders(avatar.httpMetadata);
  return new Response(avatar.body, {
    headers: responseHeaders,
  });
}",
              "fileName": "src/index.ts",
              "id": "src/index.ts@13346",
              "line": 500,
              "modules": {
                "@fiberplane/hono-otel": [
                  {
                    "import": "measure",
                    "importPath": "@fiberplane/hono-otel",
                    "name": "@fiberplane/hono-otel",
                    "version": "0.4.0-canary.0",
                  },
                ],
                "@neondatabase/serverless": [
                  {
                    "import": "neon",
                    "importPath": "@neondatabase/serverless",
                    "name": "@neondatabase/serverless",
                    "version": "0.9.4",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "drizzle",
                    "importPath": "drizzle-orm/neon-http",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                ],
              },
              "references": [
                {
                  "character": 28,
                  "content": "const getGooseById = measure("getGooseById", async (
  db: ReturnType<typeof drizzle>,
  id: number,
) => {
  console.log(\`Fetching goose with id: \${id}\`);
  return (await db.select().from(geese).where(eq(geese.id, id)))?.[0];
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@1637",
                  "line": 59,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                      {
                        "import": "eq",
                        "importPath": "drizzle-orm",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
                {
                  "character": 0,
                  "content": "function mapR2HttpMetadataToHeaders(metadata?: R2HTTPMetadata): Headers {
  const headers = new Headers();

  if (!metadata) {
    return headers;
  }

  if (metadata.contentType) {
    headers.set("Content-Type", metadata.contentType);
  }
  if (metadata.contentLanguage) {
    headers.set("Content-Language", metadata.contentLanguage);
  }
  if (metadata.contentDisposition) {
    headers.set("Content-Disposition", metadata.contentDisposition);
  }
  if (metadata.contentEncoding) {
    headers.set("Content-Encoding", metadata.contentEncoding);
  }
  if (metadata.cacheControl) {
    headers.set("Cache-Control", metadata.cacheControl);
  }
  if (metadata.cacheExpiry) {
    headers.set("Cache-Expiry", metadata.cacheExpiry.toUTCString());
  }

  return headers;
}",
                  "fileName": "src/index.ts",
                  "id": "src/index.ts@16628",
                  "line": 623,
                  "modules": {},
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/index.ts@14418",
          "method": undefined,
          "path": "/always-honk/:echo?",
          "sources": [
            {
              "character": 31,
              "content": "(c) => {
  const echo = c.req.param("echo");
  console.log(\`Always honk endpoint called with echo: \${echo}\`);
  return c.text(\`Honk honk! \${echo ?? ""}\`);
}",
              "fileName": "src/index.ts",
              "id": "src/index.ts@14449",
              "line": 543,
              "modules": {},
              "references": [],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "src/index.ts@14609",
          "method": "get",
          "path": "/ws",
          "sources": [
            {
              "character": 2,
              "content": "upgradeWebSocket((c) => {
    return {
      onMessage(event, ws) {
        const { type, payload } = JSON.parse(event.data);
        const sql = neon(c.env.DATABASE_URL);
        const db = drizzle(sql);

        console.log(\`WebSocket message received: \${type}\`);

        switch (type) {
          case "GET_GEESE":
            measure("getAllGeese", () => getAllGeese(db))().then((geese) => {
              console.log(\`Sending \${geese.length} geese over WebSocket\`);
              ws.send(JSON.stringify({ type: "GEESE", payload: geese }));
            });
            break;
          case "CREATE_GOOSE": {
            const {
              name,
              isFlockLeader,
              programmingLanguage,
              motivations,
              location,
            } = payload;
            const description = \`A person named \${name} who talks like a Goose\`;

            console.log(\`Creating new goose via WebSocket: \${name}\`);
            measure("createGoose", () =>
              createGoose(db, {
                name,
                description,
                isFlockLeader,
                programmingLanguage,
                motivations,
                location,
              }),
            )().then((newGoose) => {
              console.log(\`New goose created via WebSocket: \${newGoose[0].id}\`);
              ws.send(JSON.stringify({ type: "NEW_GOOSE", payload: newGoose }));
            });
            break;
          }
          // ... (handle other message types)
          default:
            console.warn(\`Unknown WebSocket message type: \${type}\`);
            break;
        }
      },
      onClose: () => {
        console.log("WebSocket connection closed");
      },
    };
  })",
              "fileName": "src/index.ts",
              "id": "src/index.ts@14629",
              "line": 551,
              "modules": {
                "@fiberplane/hono-otel": [
                  {
                    "import": "measure",
                    "importPath": "@fiberplane/hono-otel",
                    "name": "@fiberplane/hono-otel",
                    "version": "0.4.0-canary.0",
                  },
                ],
                "@neondatabase/serverless": [
                  {
                    "import": "neon",
                    "importPath": "@neondatabase/serverless",
                    "name": "@neondatabase/serverless",
                    "version": "0.9.4",
                  },
                ],
                "drizzle-orm": [
                  {
                    "import": "drizzle",
                    "importPath": "drizzle-orm/neon-http",
                    "name": "drizzle-orm",
                    "version": "0.32.2",
                  },
                ],
                "hono": [
                  {
                    "import": "upgradeWebSocket",
                    "importPath": "hono/cloudflare-workers",
                    "name": "hono",
                    "version": "4.5.9",
                  },
                ],
              },
              "references": [
                {
                  "character": 27,
                  "content": "const getAllGeese = measure("getAllGeese", async (db: ReturnType<typeof drizzle>) => {
  console.log("Fetching all geese");
  return await db.select().from(geese);
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@260",
                  "line": 6,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [],
                },
                {
                  "character": 27,
                  "content": "const createGoose = measure("createGoose", async (
  db: ReturnType<typeof drizzle>,
  gooseData: Partial<typeof geese.$inferInsert> & Pick<typeof geese.$inferInsert, "name">,
) => {
  const { name, isFlockLeader, programmingLanguage, motivations, location } =
    gooseData;
  const description = \`A person named \${name} who talks like a Goose\`;

  console.log({
    action: "createGoose",
    name,
    isFlockLeader,
    programmingLanguage,
  });

  return await db
    .insert(geese)
    .values({
      name,
      description,
      isFlockLeader,
      programmingLanguage,
      motivations,
      location,
    })
    .returning({
      id: geese.id,
      name: geese.name,
      description: geese.description,
      isFlockLeader: geese.isFlockLeader,
      programmingLanguage: geese.programmingLanguage,
      motivations: geese.motivations,
      location: geese.location,
    });
})",
                  "fileName": "src/db/client.ts",
                  "id": "src/db/client.ts@727",
                  "line": 23,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.4.0-canary.0",
                      },
                    ],
                    "drizzle-orm": [
                      {
                        "import": "drizzle",
                        "importPath": "drizzle-orm/neon-http",
                        "name": "drizzle-orm",
                        "version": "0.32.2",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                    {
                      "character": 21,
                      "content": "const geese = pgTable("geese", {
  id: serial("id").primaryKey(),
  name: text("name").notNull(),
  description: text("description"),
  isFlockLeader: boolean("is_leader"),
  programmingLanguage: text("programming_language"),
  motivations: jsonb("motivations"),
  location: text("location"),
  bio: text("bio"),
  avatar: text("avatar"),
  honks: integer("honks").default(0),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})",
                      "fileName": "src/db/schema.ts",
                      "id": "src/db/schema.ts@134",
                      "line": 10,
                      "modules": {
                        "drizzle-orm": [
                          {
                            "import": "pgTable",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "serial",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "text",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "boolean",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "jsonb",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "integer",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                          {
                            "import": "timestamp",
                            "importPath": "drizzle-orm/pg-core",
                            "name": "drizzle-orm",
                            "version": "0.32.2",
                          },
                        ],
                      },
                      "references": [],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
      ],
      "fileName": "src/index.ts",
      "id": "src/index.ts@656",
      "name": "app",
    },
  ],
}
`;

exports[`run test 'module imports' with location './test-case/module-imports' 1`] = `
{
  "errorCount": 0,
  "results": [
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "index.ts@133",
          "method": "get",
          "path": "/",
          "sources": [
            {
              "character": 2,
              "content": "() => cors()",
              "fileName": "index.ts",
              "id": "index.ts@207",
              "line": 9,
              "modules": {
                "hono": [
                  {
                    "import": "cors",
                    "importPath": "hono/cors",
                    "name": "hono",
                    "version": "4.6.6",
                  },
                ],
              },
              "references": [],
            },
            {
              "character": 2,
              "content": "(c) => c.text("Hello, Hono!")",
              "fileName": "index.ts",
              "id": "index.ts@223",
              "line": 10,
              "modules": {},
              "references": [],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "index.ts@456",
          "method": "get",
          "path": "/slow",
          "sources": [
            {
              "character": 17,
              "content": "cors()",
              "fileName": "index.ts",
              "id": "index.ts@473",
              "line": 19,
              "modules": {
                "hono": [
                  {
                    "import": "cors",
                    "importPath": "hono/cors",
                    "name": "hono",
                    "version": "4.6.6",
                  },
                ],
              },
              "references": [],
            },
            {
              "character": 25,
              "content": "async (c) => {
  await sleep(1000);
  return c.text("Hello, Hono (slow)!");
}",
              "fileName": "index.ts",
              "id": "index.ts@481",
              "line": 19,
              "modules": {},
              "references": [
                {
                  "character": 0,
                  "content": "export async function sleep(duration: number) {
  return new Promise((resolve) => setTimeout(resolve, duration));
}",
                  "fileName": "index.ts",
                  "id": "index.ts@290",
                  "line": 14,
                  "modules": {},
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "index.ts@848",
          "method": "get",
          "path": "user/1",
          "sources": [
            {
              "character": 18,
              "content": "cors()",
              "fileName": "index.ts",
              "id": "index.ts@866",
              "line": 32,
              "modules": {
                "hono": [
                  {
                    "import": "cors",
                    "importPath": "hono/cors",
                    "name": "hono",
                    "version": "4.6.6",
                  },
                ],
              },
              "references": [],
            },
            {
              "character": 26,
              "content": "async (c) => {
  // await getUser();
  const user = await getUser();
  return c.json(user);
}",
              "fileName": "index.ts",
              "id": "index.ts@874",
              "line": 32,
              "modules": {},
              "references": [
                {
                  "character": 23,
                  "content": "const getUser = measure("getUser", async () => {
  await new Promise((resolve) => setTimeout(resolve, 100));
  const value: User = {
    name: "John Doe",
    email: "john@doe.com",
  };
  return value;
})",
                  "fileName": "db.ts",
                  "id": "db.ts@137",
                  "line": 4,
                  "modules": {
                    "@fiberplane/hono-otel": [
                      {
                        "import": "measure",
                        "importPath": "@fiberplane/hono-otel",
                        "name": "@fiberplane/hono-otel",
                        "version": "0.3.1",
                      },
                    ],
                  },
                  "references": [
                    {
                      "character": 0,
                      "content": "export type User = {
  name: string;
  email: Email;
};",
                      "fileName": "types.ts",
                      "id": "types.ts@29",
                      "line": 2,
                      "modules": {},
                      "references": [
                        {
                          "character": 0,
                          "content": "export type Email = string;",
                          "fileName": "types.ts",
                          "id": "types.ts@0",
                          "line": 0,
                          "modules": {},
                          "references": [],
                        },
                      ],
                    },
                  ],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
      ],
      "fileName": "index.ts",
      "id": "index.ts@114",
      "name": "app",
    },
  ],
}
`;

exports[`run test 'multiple files' with location './test-case/multiple' 1`] = `
{
  "errorCount": 0,
  "results": [
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "index.ts@55",
          "method": "get",
          "path": "/",
          "sources": [
            {
              "character": 13,
              "content": "(c) => c.text("Hello, Hono!")",
              "fileName": "index.ts",
              "id": "index.ts@68",
              "line": 4,
              "modules": {},
              "references": [],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
      ],
      "fileName": "index.ts",
      "id": "index.ts@36",
      "name": "app",
    },
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "other.ts@53",
          "method": "get",
          "path": "/",
          "sources": [
            {
              "character": 13,
              "content": "(c) => {
  return c.json({});
}",
              "fileName": "other.ts",
              "id": "other.ts@66",
              "line": 2,
              "modules": {},
              "references": [],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "other.ts@100",
          "method": "post",
          "path": "/",
          "sources": [
            {
              "character": 14,
              "content": "(c) => c.json({ hello: "world" })",
              "fileName": "other.ts",
              "id": "other.ts@114",
              "line": 5,
              "modules": {},
              "references": [],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
      ],
      "fileName": "other.ts",
      "id": "other.ts@35",
      "name": "app",
    },
  ],
}
`;

exports[`run test 'single file' with location './test-case/single' 1`] = `
{
  "errorCount": 0,
  "results": [
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "index.ts@55",
          "method": "get",
          "path": "/",
          "sources": [
            {
              "character": 13,
              "content": "(c) => c.text("Hello, Hono!")",
              "fileName": "index.ts",
              "id": "index.ts@68",
              "line": 4,
              "modules": {},
              "references": [],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
      ],
      "fileName": "index.ts",
      "id": "index.ts@36",
      "name": "app",
    },
  ],
}
`;

exports[`run test 'split routes' with location './test-case/split-routes' 1`] = `
{
  "errorCount": 0,
  "results": [
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "users.ts@179",
          "method": "get",
          "path": "/api/v1/users",
          "sources": [
            {
              "character": 27,
              "content": "(c) => {
  return c.json(USERS);
}",
              "fileName": "users.ts",
              "id": "users.ts@206",
              "line": 17,
              "modules": {},
              "references": [
                {
                  "character": 6,
                  "content": "const USERS = [
  {
    id: 1,
    name: "Alice",
    age: 25,
  },
  {
    id: 2,
    name: "Bob",
    age: 30,
  },
]",
                  "fileName": "users.ts",
                  "id": "users.ts@63",
                  "line": 4,
                  "modules": {},
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "users.ts@244",
          "method": "get",
          "path": "/api/v1/users/:id",
          "sources": [
            {
              "character": 31,
              "content": "(c) => {
  const id = Number.parseInt(c.req.param("id"));
  const user = USERS.find((u) => u.id === id);
  return c.json(user);
}",
              "fileName": "users.ts",
              "id": "users.ts@275",
              "line": 21,
              "modules": {},
              "references": [
                {
                  "character": 6,
                  "content": "const USERS = [
  {
    id: 1,
    name: "Alice",
    age: 25,
  },
  {
    id: 2,
    name: "Bob",
    age: 30,
  },
]",
                  "fileName": "users.ts",
                  "id": "users.ts@63",
                  "line": 4,
                  "modules": {},
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
      ],
      "fileName": "users.ts",
      "id": "users.ts@36",
      "name": "users",
    },
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "index.ts@320",
          "method": "get",
          "path": "/api/v1/projects",
          "sources": [
            {
              "character": 33,
              "content": "(c) => {
  return c.json(PROJECTS);
}",
              "fileName": "index.ts",
              "id": "index.ts@353",
              "line": 19,
              "modules": {},
              "references": [
                {
                  "character": 6,
                  "content": "const PROJECTS = [
  {
    id: 1,
    name: "Project A",
    description: "Project A description",
  },
  {
    id: 2,
    name: "Project B",
    description: "Project B description",
  },
]",
                  "fileName": "index.ts",
                  "id": "index.ts@133",
                  "line": 6,
                  "modules": {},
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "index.ts@394",
          "method": "get",
          "path": "/api/v1/projects/:id",
          "sources": [
            {
              "character": 37,
              "content": "(c) => {
  const id = Number.parseInt(c.req.param("id"));
  const project = PROJECTS.find((p) => p.id === id);
  return c.json(project);
}",
              "fileName": "index.ts",
              "id": "index.ts@431",
              "line": 23,
              "modules": {},
              "references": [
                {
                  "character": 6,
                  "content": "const PROJECTS = [
  {
    id: 1,
    name: "Project A",
    description: "Project A description",
  },
  {
    id: 2,
    name: "Project B",
    description: "Project B description",
  },
]",
                  "fileName": "index.ts",
                  "id": "index.ts@133",
                  "line": 6,
                  "modules": {},
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
      ],
      "fileName": "index.ts",
      "id": "index.ts@103",
      "name": "projects",
    },
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "index.ts@619",
          "path": "/",
          "sources": [
            {
              "character": 8,
              "content": "cors()",
              "fileName": "index.ts",
              "id": "index.ts@627",
              "line": 32,
              "modules": {
                "hono": [
                  {
                    "import": "cors",
                    "importPath": "hono/cors",
                    "name": "hono",
                    "version": "4.6.6",
                  },
                ],
              },
              "references": [],
            },
          ],
          "type": "MIDDLEWARE_ENTRY",
        },
      ],
      "fileName": "index.ts",
      "id": "index.ts@601",
      "name": "app",
    },
    {
      "baseUrl": "",
      "entries": [
        {
          "id": "projects.ts@253",
          "method": "get",
          "path": "/api/v1/projects",
          "sources": [
            {
              "character": 33,
              "content": "(c) => {
  return c.json(PROJECTS);
}",
              "fileName": "projects.ts",
              "id": "projects.ts@286",
              "line": 17,
              "modules": {},
              "references": [
                {
                  "character": 6,
                  "content": "const PROJECTS = [
  {
    id: 1,
    name: "Project A",
    description: "Project A description",
  },
  {
    id: 2,
    name: "Project B",
    description: "Project B description",
  },
]",
                  "fileName": "projects.ts",
                  "id": "projects.ts@66",
                  "line": 4,
                  "modules": {},
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
        {
          "id": "projects.ts@327",
          "method": "get",
          "path": "/api/v1/projects/:id",
          "sources": [
            {
              "character": 37,
              "content": "(c) => {
  const id = Number.parseInt(c.req.param("id"));
  const project = PROJECTS.find((p) => p.id === id);
  return c.json(project);
}",
              "fileName": "projects.ts",
              "id": "projects.ts@364",
              "line": 21,
              "modules": {},
              "references": [
                {
                  "character": 6,
                  "content": "const PROJECTS = [
  {
    id: 1,
    name: "Project A",
    description: "Project A description",
  },
  {
    id: 2,
    name: "Project B",
    description: "Project B description",
  },
]",
                  "fileName": "projects.ts",
                  "id": "projects.ts@66",
                  "line": 4,
                  "modules": {},
                  "references": [],
                },
              ],
            },
          ],
          "type": "ROUTE_ENTRY",
        },
      ],
      "fileName": "projects.ts",
      "id": "projects.ts@36",
      "name": "projects",
    },
  ],
}
`;
